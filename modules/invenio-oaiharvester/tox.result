GLOB sdist-make: /code/modules/invenio-oaiharvester/setup.py
c1 inst-nodeps: /code/modules/invenio-oaiharvester/.tox/.tmp/package/1/invenio-oaiharvester-1.0.0a4.dev20171205.zip
c1 installed: alabaster==0.7.13,alembic==0.9.6,amqp==2.6.1,angular-gettext-babel==0.3,aniso8601==8.0.0,arrow==0.12.1,asn1crypto==0.23.0,attrs==17.4.0,b2handle==1.1.2,Babel==2.5.1,bagit==1.7.0,beautifulsoup4==4.9.3,bibtexparser==1.0.1,billiard==3.6.3.0,binaryornot==0.4.4,bleach==3.1.0,blinker==1.4,boto3==1.7.84,botocore==1.10.84,cachelib==0.1,cachetools==4.2.4,cchardet==2.1.1,celery==4.4.7,certifi==2017.11.5,cffi==1.11.2,chardet==3.0.4,citeproc-py==0.5.1,citeproc-py-styles==0.1.2,click==8.0.4,cookiecutter==1.6.0,counter-robots==2018.6,coverage==6.2,cryptography==2.1.4,datacite==1.0.1,DateTime==4.9,decorator==4.1.2,defusedxml==0.5.0,dictdiffer==0.7.0,dnspython==2.2.1,docutils==0.18.1,dojson==1.3.2,elasticsearch==6.1.1,elasticsearch-dsl==6.4.0,elementpath==1.0.6,email-validator==1.0.5,entrypoints==0.2.3,feedgen==0.7.0,Flask==1.0.4,Flask-Admin==1.5.3,Flask-Alembic==2.0.1,Flask-Assets==0.12,Flask-BabelEx==0.9.4,Flask-Breadcrumbs==0.5.0,Flask-Caching==1.3.3,Flask-CeleryExt==0.3.4,Flask-Collect==1.2.2,Flask-Cors==3.0.3,Flask-DebugToolbar==0.11.0,Flask-IIIF==0.6.1,Flask-KVSession==0.6.2,Flask-Limiter==1.1.0,Flask-Login==0.4.1,Flask-Mail==0.9.1,flask-marshmallow==0.14.0,Flask-Menu==0.6.0,Flask-OAuthlib==0.9.5,Flask-Plugins==1.6.1,Flask-Principal==0.4.0,Flask-RESTful==0.3.8,Flask-Security==3.0.0,flask-shell-ipython==0.4.1,Flask-Sitemap==0.1.0,Flask-SQLAlchemy==2.3.2,flask-talisman==0.4.1,Flask-WTF==0.14.3,-e git+https://github.com/RCOSDP/pyfpdf.git@f9b032148283d535cabc7789858081c80de36fef#egg=fpdf,frozendict==2.3.8,fs==0.5.4,ftfy==4.4.3,future==0.16.0,github3.py==1.1.0,html5lib==1.0.1,idna==2.6,iiif-prezi==0.3.0,imagesize==1.4.1,importlib-metadata==4.8.3,importlib-resources==5.4.0,infinity==1.4,iniconfig==1.1.1,intervals==0.8.0,invenio-access==1.1.0,-e git+https://mhaya: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@github.com/RCOSDP/weko.git@9681d8d89512eb9df7e6eb70c311342468e65c50#egg=invenio_accounts&subdirectory=modules/invenio-accounts,invenio-admin==1.1.2,invenio-app==1.1.0,invenio-assets==1.0.0,invenio-base==1.0.2,invenio-cache==1.0.0,invenio-celery==1.1.3,-e git+https://mhaya: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@github.com/RCOSDP/weko.git@9681d8d89512eb9df7e6eb70c311342468e65c50#egg=invenio_communities&subdirectory=modules/invenio-communities,invenio-config==1.0.0,invenio-csl-rest==1.0.0a1,-e git+https://mhaya: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@github.com/RCOSDP/weko.git@9681d8d89512eb9df7e6eb70c311342468e65c50#egg=invenio_db&subdirectory=modules/invenio-db,-e git+https://mhaya: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@github.com/RCOSDP/weko.git@9681d8d89512eb9df7e6eb70c311342468e65c50#egg=invenio_deposit&subdirectory=modules/invenio-deposit,-e git+https://mhaya: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@github.com/RCOSDP/weko.git@9681d8d89512eb9df7e6eb70c311342468e65c50#egg=invenio_files_rest&subdirectory=modules/invenio-files-rest,invenio-formatter==1.0.0b3,invenio-i18n==1.0.0,-e git+https://mhaya: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@github.com/RCOSDP/weko.git@9681d8d89512eb9df7e6eb70c311342468e65c50#egg=invenio_iiif&subdirectory=modules/invenio-iiif,-e git+https://mhaya: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@github.com/RCOSDP/weko.git@9681d8d89512eb9df7e6eb70c311342468e65c50#egg=invenio_indexer&subdirectory=modules/invenio-indexer,invenio-jsonschemas==1.0.0,invenio-logging==1.0.0b3,-e git+https://mhaya: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@github.com/RCOSDP/weko.git@9681d8d89512eb9df7e6eb70c311342468e65c50#egg=invenio_mail&subdirectory=modules/invenio-mail,invenio-marc21==1.0.0a8,invenio-oaiharvester @ file:///code/modules/invenio-oaiharvester/.tox/.tmp/package/1/invenio-oaiharvester-1.0.0a4.dev20171205.zip,-e git+https://mhaya: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@github.com/RCOSDP/weko.git@9681d8d89512eb9df7e6eb70c311342468e65c50#egg=invenio_oaiserver&subdirectory=modules/invenio-oaiserver,-e git+https://mhaya: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@github.com/RCOSDP/weko.git@9681d8d89512eb9df7e6eb70c311342468e65c50#egg=invenio_oauth2server&subdirectory=modules/invenio-oauth2server,invenio-oauthclient==1.0.0,invenio-pidrelations==1.0.0a4,invenio-pidstore==1.0.0,-e git+https://mhaya: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@github.com/RCOSDP/weko.git@9681d8d89512eb9df7e6eb70c311342468e65c50#egg=invenio_previewer&subdirectory=modules/invenio-previewer,invenio-query-parser==0.6.0,-e git+https://mhaya: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@github.com/RCOSDP/weko.git@9681d8d89512eb9df7e6eb70c311342468e65c50#egg=invenio_queues&subdirectory=modules/invenio-queues,-e git+https://mhaya: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@github.com/RCOSDP/weko.git@9681d8d89512eb9df7e6eb70c311342468e65c50#egg=invenio_records&subdirectory=modules/invenio-records,invenio-records-files==1.0.0a10,-e git+https://mhaya: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@github.com/RCOSDP/weko.git@9681d8d89512eb9df7e6eb70c311342468e65c50#egg=invenio_records_rest&subdirectory=modules/invenio-records-rest,invenio-records-ui==1.0.0,-e git+https://mhaya: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@github.com/RCOSDP/weko.git@9681d8d89512eb9df7e6eb70c311342468e65c50#egg=invenio_resourcesyncclient&subdirectory=modules/invenio-resourcesyncclient,-e git+https://mhaya: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@github.com/RCOSDP/weko.git@9681d8d89512eb9df7e6eb70c311342468e65c50#egg=invenio_resourcesyncserver&subdirectory=modules/invenio-resourcesyncserver,invenio-rest==1.1.2,-e git+https://mhaya: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@github.com/RCOSDP/weko.git@9681d8d89512eb9df7e6eb70c311342468e65c50#egg=invenio_s3&subdirectory=modules/invenio-s3,invenio-search==1.1.0,invenio-search-ui==1.0.0a9,-e git+https://mhaya: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@github.com/RCOSDP/weko.git@9681d8d89512eb9df7e6eb70c311342468e65c50#egg=invenio_stats&subdirectory=modules/invenio-stats,invenio-theme==1.0.0b4,ipaddress==1.0.19,ipython==6.2.1,ipython-genutils==0.2.0,itsdangerous==0.24,jedi==0.11.0,Jinja2==2.10,jinja2-cli==0.6.0,jinja2-time==0.2.0,jmespath==0.10.0,jsmin==2.2.2,jsonpatch==1.21,jsonpath-ng==1.5.2,jsonpointer==1.14,jsonref==0.1,jsonresolver==0.2.1,jsonschema==2.6.0,jupyter-client==5.2.2,jupyter-core==4.4.0,-e git+https://github.com/RCOSDP/kombu.git@f204fdf078d5e94393c86693f545e2d011f620f5#egg=kombu,limits==1.2.1,lxml==4.1.1,Mako==1.0.7,MarkupSafe==1.1.1,marshmallow==2.20.1,marshmallow-sqlalchemy==0.23.1,maxminddb==1.5.2,maxminddb-geolite2==2017.803,mistune==0.8.3,mock==3.0.5,more-itertools==8.10.0,msgpack==0.6.2,nbconvert==5.3.1,nbformat==4.4.0,netaddr==0.8.0,node-semver==0.1.1,numpy==1.16.1,oauthlib==2.1.0,ordereddict==1.1,packaging==21.3,pandocfilters==1.4.2,parso==0.1.0,passlib==1.7.1,pexpect==4.3.0,pickleshare==0.7.4,Pillow==5.4.1,pluggy==0.13.1,ply==3.11,poyo==0.4.1,prompt-toolkit==1.0.15,psycopg2==2.7.3.2,ptyprocess==0.5.2,py==1.11.0,pycparser==2.18,Pygments==2.2.0,PyJWT==1.5.3,PyLD==2.0.3,pyparsing==3.1.1,-e git+https://github.com/RCOSDP/PyPDF2.git@fefc684a3a74aff6f99e5dff24f9b4dd1c95169d#egg=PyPDF2,pyPEG2==2.15.2,pytest==6.1.2,pytest-cov==4.0.0,pytest-mock==3.6.1,python-dateutil==2.6.1,python-editor==1.0.3,python-geoip==1.2,pytz==2017.3,pyzmq==17.0.0,redis==2.10.6,requests==2.18.4,requests-oauthlib==1.1.0,responses==0.10.15,resync==1.0.9,s3fs==0.1.6,s3transfer==0.1.13,Sickle==0.6.4,simplegeneric==0.8.1,simplejson==3.12.0,simplekv==0.11.2,six==1.12.0,snowballstemmer==2.2.0,soupsieve==2.3.2.post1,speaklater==1.3,Sphinx==1.8.4,sphinxcontrib-serializinghtml==1.1.5,sphinxcontrib-websupport==1.2.4,SQLAlchemy==1.2.19,SQLAlchemy-Continuum==1.3.6,SQLAlchemy-Utils==0.35.0,testpath==0.3.1,toml==0.10.2,tomli==1.2.3,tornado==4.5.3,traitlets==4.3.2,typing_extensions==4.1.1,ua-parser==0.7.3,uritemplate==4.1.1,uritools==2.1.0,urllib3==1.22,validators==0.12.0,vine==1.3.0,Wand==0.6.1,wcwidth==0.1.7,webargs==5.5.2,webassets==0.12.1,webencodings==0.5.1,-e git+https://mhaya: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@github.com/RCOSDP/weko.git@9681d8d89512eb9df7e6eb70c311342468e65c50#egg=weko_accounts&subdirectory=modules/weko-accounts,-e git+https://mhaya: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@github.com/RCOSDP/weko.git@9681d8d89512eb9df7e6eb70c311342468e65c50#egg=weko_admin&subdirectory=modules/weko-admin,-e git+https://mhaya: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@github.com/RCOSDP/weko.git@9681d8d89512eb9df7e6eb70c311342468e65c50#egg=weko_authors&subdirectory=modules/weko-authors,-e git+https://mhaya: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@github.com/RCOSDP/weko.git@9681d8d89512eb9df7e6eb70c311342468e65c50#egg=weko_bulkupdate&subdirectory=modules/weko-bulkupdate,-e git+https://mhaya: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@github.com/RCOSDP/weko.git@9681d8d89512eb9df7e6eb70c311342468e65c50#egg=weko_deposit&subdirectory=modules/weko-deposit,-e git+https://mhaya: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@github.com/RCOSDP/weko.git@9681d8d89512eb9df7e6eb70c311342468e65c50#egg=weko_gridlayout&subdirectory=modules/weko-gridlayout,-e git+https://mhaya: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@github.com/RCOSDP/weko.git@9681d8d89512eb9df7e6eb70c311342468e65c50#egg=weko_groups&subdirectory=modules/weko-groups,-e git+https://mhaya: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@github.com/RCOSDP/weko.git@9681d8d89512eb9df7e6eb70c311342468e65c50#egg=weko_handle&subdirectory=modules/weko-handle,-e git+https://mhaya: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@github.com/RCOSDP/weko.git@9681d8d89512eb9df7e6eb70c311342468e65c50#egg=weko_index_tree&subdirectory=modules/weko-index-tree,-e git+https://mhaya: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@github.com/RCOSDP/weko.git@9681d8d89512eb9df7e6eb70c311342468e65c50#egg=weko_indextree_journal&subdirectory=modules/weko-indextree-journal,-e git+https://mhaya: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@github.com/RCOSDP/weko.git@9681d8d89512eb9df7e6eb70c311342468e65c50#egg=weko_items_autofill&subdirectory=modules/weko-items-autofill,-e git+https://mhaya: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@github.com/RCOSDP/weko.git@9681d8d89512eb9df7e6eb70c311342468e65c50#egg=weko_items_ui&subdirectory=modules/weko-items-ui,-e git+https://mhaya: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@github.com/RCOSDP/weko.git@9681d8d89512eb9df7e6eb70c311342468e65c50#egg=weko_itemtypes_ui&subdirectory=modules/weko-itemtypes-ui,-e git+https://mhaya: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@github.com/RCOSDP/weko.git@9681d8d89512eb9df7e6eb70c311342468e65c50#egg=weko_logging&subdirectory=modules/weko-logging,-e git+https://mhaya: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@github.com/RCOSDP/weko.git@9681d8d89512eb9df7e6eb70c311342468e65c50#egg=weko_records&subdirectory=modules/weko-records,-e git+https://mhaya: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@github.com/RCOSDP/weko.git@9681d8d89512eb9df7e6eb70c311342468e65c50#egg=weko_records_ui&subdirectory=modules/weko-records-ui,-e git+https://mhaya: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@github.com/RCOSDP/weko.git@9681d8d89512eb9df7e6eb70c311342468e65c50#egg=weko_redis&subdirectory=modules/weko-redis,-e git+https://mhaya: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@github.com/RCOSDP/weko.git@9681d8d89512eb9df7e6eb70c311342468e65c50#egg=weko_schema_ui&subdirectory=modules/weko-schema-ui,-e git+https://mhaya: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@github.com/RCOSDP/weko.git@9681d8d89512eb9df7e6eb70c311342468e65c50#egg=weko_search_ui&subdirectory=modules/weko-search-ui,-e git+https://mhaya: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@github.com/RCOSDP/weko.git@9681d8d89512eb9df7e6eb70c311342468e65c50#egg=weko_sitemap&subdirectory=modules/weko-sitemap,-e git+https://mhaya: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@github.com/RCOSDP/weko.git@9681d8d89512eb9df7e6eb70c311342468e65c50#egg=weko_theme&subdirectory=modules/weko-theme,-e git+https://mhaya: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@github.com/RCOSDP/weko.git@9681d8d89512eb9df7e6eb70c311342468e65c50#egg=weko_user_profiles&subdirectory=modules/weko-user-profiles,-e git+https://mhaya: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@github.com/RCOSDP/weko.git@9681d8d89512eb9df7e6eb70c311342468e65c50#egg=weko_workflow&subdirectory=modules/weko-workflow,Werkzeug==0.15.2,whichcraft==0.4.1,WTForms==2.1,WTForms-Alchemy==0.16.5,WTForms-Components==0.10.3,xmlschema==0.9.30,xmltodict==0.12.0,zipp==3.6.0,zope.interface==5.5.2
c1 run-test-pre: PYTHONHASHSEED='177389535'
c1 run-test: commands[0] | pytest --cov=invenio_oaiharvester tests -v --cov-branch --cov-report=term --cov-report=xml --cov-report=html --basetemp=/code/modules/invenio-oaiharvester/.tox/c1/tmp
============================= test session starts ==============================
platform linux -- Python 3.6.15, pytest-6.1.2, py-1.11.0, pluggy-0.13.1 -- /code/modules/invenio-oaiharvester/.tox/c1/bin/python
cachedir: .tox/c1/.pytest_cache
rootdir: /code/modules/invenio-oaiharvester
plugins: celery-4.4.7, mock-3.6.1, cov-4.0.0
collecting ... collected 120 items

tests/test_admin.py::test_admin PASSED                                   [  0%]
tests/test_admin.py::test_run_stats PASSED                               [  1%]
tests/test_admin.py::test_control_btns PASSED                            [  2%]
tests/test_admin.py::TestHarvestSettingView::test_run PASSED             [  3%]
tests/test_admin.py::TestHarvestSettingView::test_pause PASSED           [  4%]
tests/test_admin.py::TestHarvestSettingView::test_clear PASSED           [  5%]
tests/test_admin.py::TestHarvestSettingView::test_get_logs PASSED        [  5%]
tests/test_admin.py::TestHarvestSettingView::test_get_log_detail PASSED  [  6%]
tests/test_admin.py::TestHarvestSettingView::test_set_schedule PASSED    [  7%]
tests/test_api.py::test_list_records PASSED                              [  8%]
tests/test_api.py::test_get_records PASSED                               [  9%]
tests/test_api.py::test_get_info_by_oai_name PASSED                      [ 10%]
tests/test_api.py::test_send_run_status_mail PASSED                      [ 10%]
tests/test_cli.py::test_cli_harvest_idents PASSED                        [ 11%]
tests/test_cli.py::test_cli_harvest_list PASSED                          [ 12%]
tests/test_harvester.py::test_list_sets PASSED                           [ 13%]
tests/test_harvester.py::test_list_records PASSED                        [ 14%]
tests/test_harvester.py::test_map_field PASSED                           [ 15%]
tests/test_harvester.py::test_subitem_recs PASSED                        [ 15%]
tests/test_harvester.py::test_parsing_metadata PASSED                    [ 16%]
tests/test_harvester.py::test_add_title PASSED                           [ 17%]
tests/test_harvester.py::test_add_alternative PASSED                     [ 18%]
tests/test_harvester.py::test_add_creator_jpcoar PASSED                  [ 19%]
tests/test_harvester.py::test_add_contributor_jpcoar FAILED              [ 20%]
tests/test_harvester.py::test_add_access_right PASSED                    [ 20%]
tests/test_harvester.py::test_add_apc FAILED                             [ 21%]
tests/test_harvester.py::test_add_right PASSED                           [ 22%]
tests/test_harvester.py::test_add_subject PASSED                         [ 23%]
tests/test_harvester.py::test_add_description PASSED                     [ 24%]
tests/test_harvester.py::test_add_publisher PASSED                       [ 25%]
tests/test_harvester.py::test_add_date PASSED                            [ 25%]
tests/test_harvester.py::test_add_language PASSED                        [ 26%]
tests/test_harvester.py::test_add_version PASSED                         [ 27%]
tests/test_harvester.py::test_add_version_type PASSED                    [ 28%]
tests/test_harvester.py::test_add_identifier_registration PASSED         [ 29%]
tests/test_harvester.py::test_add_temporal PASSED                        [ 30%]
tests/test_harvester.py::test_add_source_identifier PASSED               [ 30%]
tests/test_harvester.py::test_add_file PASSED                            [ 31%]
tests/test_harvester.py::test_add_identifier PASSED                      [ 32%]
tests/test_harvester.py::test_add_source_title PASSED                    [ 33%]
tests/test_harvester.py::test_add_volume PASSED                          [ 34%]
tests/test_harvester.py::test_add_issue PASSED                           [ 35%]
tests/test_harvester.py::test_add_num_page PASSED                        [ 35%]
tests/test_harvester.py::test_add_page_start PASSED                      [ 36%]
tests/test_harvester.py::test_add_page_end PASSED                        [ 37%]
tests/test_harvester.py::test_add_dissertation_number PASSED             [ 38%]
tests/test_harvester.py::test_add_date_granted PASSED                    [ 39%]
tests/test_harvester.py::test_add_conference PASSED                      [ 40%]
tests/test_harvester.py::test_add_degree_grantor PASSED                  [ 40%]
tests/test_harvester.py::test_add_degree_name PASSED                     [ 41%]
tests/test_harvester.py::test_add_funding_reference FAILED               [ 42%]
tests/test_harvester.py::test_add_geo_location PASSED                    [ 43%]
tests/test_harvester.py::test_add_relation PASSED                        [ 44%]
tests/test_harvester.py::test_add_rights_holder PASSED                   [ 45%]
tests/test_harvester.py::test_add_resource_type PASSED                   [ 45%]
tests/test_harvester.py::test_add_creator_dc PASSED                      [ 46%]
tests/test_harvester.py::test_add_data_by_key PASSED                     [ 47%]
tests/test_harvester.py::test_add_source_dc PASSED                       [ 48%]
tests/test_harvester.py::test_add_coverage_dc PASSED                     [ 49%]
tests/test_harvester.py::test_add_format_dc PASSED                       [ 50%]
tests/test_harvester.py::test_add_contributor_dc PASSED                  [ 50%]
tests/test_harvester.py::test_add_relation_dc PASSED                     [ 51%]
tests/test_harvester.py::test_add_rights_dc PASSED                       [ 52%]
tests/test_harvester.py::test_add_identifier_dc PASSED                   [ 53%]
tests/test_harvester.py::test_add_description_dc PASSED                  [ 54%]
tests/test_harvester.py::test_add_subject_dc PASSED                      [ 55%]
tests/test_harvester.py::test_add_title_dc PASSED                        [ 55%]
tests/test_harvester.py::test_add_language_dc PASSED                     [ 56%]
tests/test_harvester.py::test_add_date_dc PASSED                         [ 57%]
tests/test_harvester.py::test_add_publisher_dc PASSED                    [ 58%]
tests/test_harvester.py::test_add_resource_type_dc PASSED                [ 59%]
tests/test_harvester.py::test_to_dict PASSED                             [ 60%]
tests/test_harvester.py::test_map_sets PASSED                            [ 60%]
tests/test_harvester.py::TestBaseMapper::test_init PASSED                [ 61%]
tests/test_harvester.py::TestBaseMapper::test_map_itemtype PASSED        [ 62%]
tests/test_harvester.py::TestDCMapper::test_init PASSED                  [ 63%]
tests/test_harvester.py::TestDCMapper::test_map PASSED                   [ 64%]
tests/test_harvester.py::TestJPCOARMapper::test_init PASSED              [ 65%]
tests/test_harvester.py::TestJPCOARMapper::test_map FAILED               [ 65%]
tests/test_harvester.py::TestJPCOARMapper::test_map_2 PASSED             [ 66%]
tests/test_harvester.py::TestJPCOARMapper::test_map_3 PASSED             [ 67%]
tests/test_harvester.py::TestDDIMapper::test_init PASSED                 [ 68%]
tests/test_harvester.py::TestDDIMapper::test_ddi_harvest_processing FAILED [ 69%]
tests/test_harvester.py::TestDDIMapper::test_map PASSED                  [ 70%]
tests/test_harvesting.py::test_model_based_harvesting PASSED             [ 70%]
tests/test_harvesting.py::test_model_based_utf8_harvesting PASSED        [ 71%]
tests/test_harvesting.py::test_model_based_harvesting_list PASSED        [ 72%]
tests/test_harvesting.py::test_raise_missing_info PASSED                 [ 73%]
tests/test_harvesting.py::test_raise_wrong_date PASSED                   [ 74%]
tests/test_harvesting.py::test_list_records PASSED                       [ 75%]
tests/test_harvesting.py::test_list_no_records PASSED                    [ 75%]
tests/test_harvesting.py::test_get_from_identifiers PASSED               [ 76%]
tests/test_harvesting.py::test_get_from_identifiers_with_prefix PASSED   [ 77%]
tests/test_harvesting.py::test_harvester_list_sets SKIPPED               [ 78%]
tests/test_harvesting.py::test_harvester_list_records SKIPPED            [ 79%]
tests/test_invenio_oaiharvester.py::test_version PASSED                  [ 80%]
tests/test_invenio_oaiharvester.py::test_init PASSED                     [ 80%]
tests/test_tasks.py::test_get_specific_records PASSED                    [ 81%]
tests/test_tasks.py::test_list_records_from_dates PASSED                 [ 82%]
tests/test_tasks.py::test_create_indexes PASSED                          [ 83%]
tests/test_tasks.py::test_map_indexes PASSED                             [ 84%]
tests/test_tasks.py::test_event_counter PASSED                           [ 85%]
tests/test_tasks.py::test_process_item FAILED                            [ 85%]
tests/test_tasks.py::test_process_item_for_jpcoar2_coverage_and_no_errors PASSED [ 86%]
tests/test_tasks.py::test_link_success_handler PASSED                    [ 87%]
tests/test_tasks.py::test_link_error_handler PASSED                      [ 88%]
tests/test_tasks.py::test_is_harvest_running PASSED                      [ 89%]
tests/test_tasks.py::test_run_harvesting FAILED                          [ 90%]
tests/test_tasks.py::test_check_schedules_and_run PASSED                 [ 90%]
tests/test_utils.py::test_identifier_extraction_from_string PASSED       [ 91%]
tests/test_utils.py::test_records_extraction_without_namespace PASSED    [ 92%]
tests/test_utils.py::test_records_extraction_with_namespace_getrecord PASSED [ 93%]
tests/test_utils.py::test_records_extraction_with_namespace_listrecords PASSED [ 94%]
tests/test_utils.py::test_records_extraction_from_file PASSED            [ 95%]
tests/test_utils.py::test_identifier_filter PASSED                       [ 95%]
tests/test_utils.py::test_get_oaiharvest_object PASSED                   [ 96%]
tests/test_utils.py::test_check_or_create_dir PASSED                     [ 97%]
tests/test_utils.py::test_write_to_dir PASSED                            [ 98%]
tests/test_utils.py::test_create_file_name PASSED                        [ 99%]
tests/test_views.py::test_dbsession_clean PASSED                         [100%]

=================================== FAILURES ===================================
_________________________ test_add_contributor_jpcoar __________________________

mapper_jpcoar = <function mapper_jpcoar.<locals>.factory at 0x7f68118f0268>

    def test_add_contributor_jpcoar(mapper_jpcoar):
        schema, mapping, res, metadata = mapper_jpcoar("jpcoar:contributor")
        res1 = copy.deepcopy(res)
        add_contributor_jpcoar(schema, mapping, res1, metadata)
    
        assert "item_1551264418667" in res1
>       assert res1["item_1551264418667"] == [{'subitem_1551257036415': 'ContactPerson', 'subitem_1551257339190': [{'subitem_1551257342360': '', 'subitem_1551257343979': 'en'}], 'subitem_1551257272214': [{'subitem_1551257314588': 'test', 'subitem_1551257316910': 'en'}], 'subitem_1551257245638': [{'subitem_1551257276108': 'test, smith', 'subitem_1551257279831': 'en'}], 'subitem_1551257372442': [{'subitem_1551257374288': 'other smith', 'subitem_1551257375939': 'en'}]}]
E       AssertionError: assert [{'subitem_15... 'en'}], ...}] == [{'subitem_15... 'en'}], ...}]
E         At index 0 diff: {'subitem_1551257036415': 'ContactPerson', 'subitem_1551257150927': [{'subitem_1551257152742': '5678', 'subitem_1551257228080': 'https://orcid.org/5678', 'subitem_1551257172531': 'ORCID'}], 'subitem_1551257339190': [{'subitem_1551257342360': '', 'subitem_1551257343979': 'en'}], 'subitem_1551257272214': [{'subitem_1551257314588': 'test', 'subitem_1551257316910': 'en'}], 'subitem_1551257245638': [{'subitem_1551257276108': 'test, smith', 'subitem_1551257279831': 'en'}], 'subitem_1551257372442': [{'subitem_1551257374288': 'other smith', 'subitem_15512573759...
E         
E         ...Full output truncated (16 lines hidden), use '-vv' to show

tests/test_harvester.py:504: AssertionError
------------------------------ Captured log setup ------------------------------
WARNING  flask.app:ext.py:255 JSONSCHEMAS_HOST is set to localhost
_________________________________ test_add_apc _________________________________

mapper_jpcoar = <function mapper_jpcoar.<locals>.factory at 0x7f680fe28158>

    def test_add_apc(mapper_jpcoar):
        schema, mapping, res, metadata = mapper_jpcoar("rioxxterms:apc")
        res1 = copy.deepcopy(res)
>       add_apc(schema, mapping, res1, metadata)
E       NameError: name 'add_apc' is not defined

tests/test_harvester.py:521: NameError
------------------------------ Captured log setup ------------------------------
WARNING  flask.app:ext.py:255 JSONSCHEMAS_HOST is set to localhost
__________________________ test_add_funding_reference __________________________

mapper_jpcoar = <function mapper_jpcoar.<locals>.factory at 0x7f6810da5488>

    def test_add_funding_reference(mapper_jpcoar):
        schema, mapping, res, metadata = mapper_jpcoar("jpcoar:fundingReference")
        add_funding_reference(schema, mapping, res, metadata)
        assert "item_1551265385290" in res
>       assert res["item_1551265385290"] == [{'subitem_1551256462220': [{'subitem_1551256653656': 'テスト助成機関', 'subitem_1551256657859': 'ja'}], 'subitem_1551256454316': [{'subitem_1551256614960': '22222', 'subitem_1551256619706': 'Crossref Funder'}], 'subitem_1551256688098': [{'subitem_1551256691232': 'テスト研究', 'subitem_1551256694883': 'ja'}], 'subitem_1551256665850': [{'subitem_1551256671920': '1111', 'subitem_1551256679403': 'https://test.research.com'}]}]
E       AssertionError: assert [{'subitem_15...883': 'ja'}]}] == [{'subitem_15...883': 'ja'}]}]
E         At index 0 diff: {'subitem_1551256462220': [{'subitem_1551256653656': 'テスト助成機関', 'subitem_1551256657859': 'ja'}], 'subitem_1551256688098': [{'subitem_1551256691232': 'テスト研究', 'subitem_1551256694883': 'ja'}]} != {'subitem_1551256462220': [{'subitem_1551256653656': 'テスト助成機関', 'subitem_1551256657859': 'ja'}], 'subitem_1551256454316': [{'subitem_1551256614960': '22222', 'subitem_1551256619706': 'Crossref Funder'}], 'subitem_1551256688098': [{'subitem_1551256691232': 'テスト研究', 'subitem_1551256694883': 'ja'}], 'subitem_1551256665850': [{'subitem_1551256671920': '1111', 'subite...
E         
E         ...Full output truncated (15 lines hidden), use '-vv' to show

tests/test_harvester.py:741: AssertionError
------------------------------ Captured log setup ------------------------------
WARNING  flask.app:ext.py:255 JSONSCHEMAS_HOST is set to localhost
__________________________ TestJPCOARMapper.test_map ___________________________

self = <tests.test_harvester.TestJPCOARMapper object at 0x7f680e6f5d30>
db_itemtype = {'item_type_ddi': <ItemType 11>, 'item_type_ddi_mapping': <ItemTypeMapping 11>, 'item_type_ddi_name': <ItemTypeName 11>, 'item_type_multiple': <ItemType 10>, ...}

    def test_map(self,db_itemtype):
    
        deleted_xml = '<OAI-PMH xmlns="http://www.openarchives.org/OAI/2.0/" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://www.openarchives.org/OAI/2.0/ http://www.openarchives.org/OAI/2.0/OAI-PMH.xsd"><responseDate>2023-03-01T02:07:10Z</responseDate><request metadataPrefix="jpcoar_1.0" identifier="oai:weko3.example.org:00000001" verb="GetRecord">https://192.168.56.103/oai</request><GetRecord><record><header status="deleted"><identifier>oai:weko3.example.org:00000001</identifier><datestamp>2023-02-20T06:24:47Z</datestamp></header></record></GetRecord></OAI-PMH>'
        tree = etree.fromstring(deleted_xml)
        record = tree.findall("./GetRecord/record",namespaces=tree.nsmap)[0]
        xml = etree.tostring(record,encoding="utf-8").decode()
        mapper = JPCOARMapper(xml)
        mapper.itemtype = ItemType.query.filter_by(id=12).one()
    
        result = mapper.map()
        assert result == {}
    
        xml_str = '<OAI-PMH xmlns="http://www.openarchives.org/OAI/2.0/" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://www.openarchives.org/OAI/2.0/ http://www.openarchives.org/OAI/2.0/OAI-PMH.xsd"><GetRecord><record><header><identifier>oai:weko3.example.org:00000001</identifier><datestamp>2023-02-20T06:24:47Z</datestamp><setSpec>1557819692844:1557819733276</setSpec><setSpec>1557820086539</setSpec></header><metadata><jpcoar:jpcoar xmlns:datacite="https://schema.datacite.org/meta/kernel-4/" xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:dcndl="http://ndl.go.jp/dcndl/terms/" xmlns:dcterms="http://purl.org/dc/terms/" xmlns:jpcoar="https://github.com/JPCOAR/schema/blob/master/1.0/" xmlns:oaire="http://namespace.openaire.eu/schema/oaire/" xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#" xmlns:rioxxterms="http://www.rioxx.net/schema/v2.0/rioxxterms/" xmlns:xs="http://www.w3.org/2001/XMLSchema" xmlns="https://github.com/JPCOAR/schema/blob/master/1.0/" xsi:schemaLocation="https://github.com/JPCOAR/schema/blob/master/1.0/jpcoar_scm.xsd"><dc:title xml:lang="ja">test full item</dc:title><dcterms:alternative xml:lang="en">other title</dcterms:alternative><jpcoar:creator><jpcoar:nameIdentifier nameIdentifierURI="https://orcid.org/1234" nameIdentifierScheme="ORCID">1234</jpcoar:nameIdentifier><jpcoar:creatorName xml:lang="ja">テスト, 太郎</jpcoar:creatorName><jpcoar:familyName xml:lang="ja">テスト</jpcoar:familyName><jpcoar:givenName xml:lang="ja">太郎</jpcoar:givenName><jpcoar:creatorAlternative xml:lang="ja">テスト　別郎</jpcoar:creatorAlternative><jpcoar:affiliation><jpcoar:nameIdentifier nameIdentifierURI="http://www.isni.org/isni/5678" nameIdentifierScheme="ISNI">5678</jpcoar:nameIdentifier></jpcoar:affiliation></jpcoar:creator><jpcoar:contributor contributorType="ContactPerson"><jpcoar:nameIdentifier nameIdentifierURI="https://orcid.org/5678" nameIdentifierScheme="ORCID">5678</jpcoar:nameIdentifier><jpcoar:contributorName xml:lang="en">test, smith</jpcoar:contributorName><jpcoar:familyName xml:lang="en">test</jpcoar:familyName><jpcoar:givenName xml:lang="en">smith</jpcoar:givenName><jpcoar:contributorAlternative xml:lang="en">other smith</jpcoar:contributorAlternative><jpcoar:affiliation><jpcoar:nameIdentifier nameIdentifierURI="http://www.isni.org/isni/1234" nameIdentifierScheme="ISNI">1234</jpcoar:nameIdentifier></jpcoar:affiliation></jpcoar:contributor><dcterms:accessRights rdf:resource="http://purl.org/coar/access_right/c_14cb">metadata only access</dcterms:accessRights><rioxxterms:apc>Paid</rioxxterms:apc><dc:rights xml:lang="ja" rdf:resource="テスト権利情報Resource">テスト権利情報</dc:rights><jpcoar:rightsHolder><jpcoar:rightsHolderName xml:lang="ja">テスト　太郎</jpcoar:rightsHolderName></jpcoar:rightsHolder><jpcoar:subject xml:lang="ja" subjectURI="http://bsh.com" subjectScheme="BSH">テスト主題</jpcoar:subject><datacite:description xml:lang="en" descriptionType="Abstract">this is test abstract.</datacite:description><dc:publisher xml:lang="ja">test publisher</dc:publisher><datacite:date dateType="Accepted">2022-10-20</datacite:date><datacite:date dateType="Issued">2022-10-19</datacite:date><dc:language>jpn</dc:language><dc:type rdf:resource="http://purl.org/coar/resource_type/c_2fe3">newspaper</dc:type><datacite:version>1.1</datacite:version><oaire:version rdf:resource="http://purl.org/coar/version/c_b1a7d7d4d402bcce">AO</oaire:version><jpcoar:identifier identifierType="DOI">1111</jpcoar:identifier><jpcoar:identifier identifierType="DOI">https://doi.org/1234/0000000001</jpcoar:identifier><jpcoar:identifier identifierType="URI">https://192.168.56.103/records/1</jpcoar:identifier><jpcoar:identifierRegistration identifierType="JaLC">1234/0000000001</jpcoar:identifierRegistration><jpcoar:relation relationType="isVersionOf"><jpcoar:relatedIdentifier identifierType="ARK">1111111</jpcoar:relatedIdentifier><jpcoar:relatedTitle xml:lang="ja">関連情報テスト</jpcoar:relatedTitle></jpcoar:relation><jpcoar:relation relationType="isVersionOf"><jpcoar:relatedIdentifier identifierType="URI">https://192.168.56.103/records/3</jpcoar:relatedIdentifier></jpcoar:relation><dcterms:temporal xml:lang="ja">1 to 2</dcterms:temporal><datacite:geoLocation><datacite:geoLocationPoint><datacite:pointLongitude>12345</datacite:pointLongitude><datacite:pointLatitude>67890</datacite:pointLatitude></datacite:geoLocationPoint><datacite:geoLocationBox><datacite:westBoundLongitude>123</datacite:westBoundLongitude><datacite:eastBoundLongitude>456</datacite:eastBoundLongitude><datacite:southBoundLatitude>789</datacite:southBoundLatitude><datacite:northBoundLatitude>1112</datacite:northBoundLatitude></datacite:geoLocationBox><datacite:geoLocationPlace>テスト位置情報</datacite:geoLocationPlace></datacite:geoLocation><jpcoar:fundingReference><datacite:funderIdentifier funderIdentifierType="Crossref Funder">22222</datacite:funderIdentifier><jpcoar:funderName xml:lang="ja">テスト助成機関</jpcoar:funderName><datacite:awardNumber awardURI="https://test.research.com">1111</datacite:awardNumber><jpcoar:awardTitle xml:lang="ja">テスト研究</jpcoar:awardTitle></jpcoar:fundingReference><jpcoar:sourceIdentifier identifierType="PISSN">test source Identifier</jpcoar:sourceIdentifier><jpcoar:sourceTitle xml:lang="ja">test collectibles</jpcoar:sourceTitle><jpcoar:sourceTitle xml:lang="ja">test title book</jpcoar:sourceTitle><jpcoar:volume>5</jpcoar:volume><jpcoar:volume>1</jpcoar:volume><jpcoar:issue>2</jpcoar:issue><jpcoar:issue>2</jpcoar:issue><jpcoar:numPages>333</jpcoar:numPages><jpcoar:numPages>555</jpcoar:numPages><jpcoar:pageStart>123</jpcoar:pageStart><jpcoar:pageStart>789</jpcoar:pageStart><jpcoar:pageEnd>456</jpcoar:pageEnd><jpcoar:pageEnd>234</jpcoar:pageEnd><dcndl:dissertationNumber>9999</dcndl:dissertationNumber><dcndl:degreeName xml:lang="ja">テスト学位</dcndl:degreeName><dcndl:dateGranted>2022-10-19</dcndl:dateGranted><jpcoar:degreeGrantor><jpcoar:nameIdentifier nameIdentifierScheme="kakenhi">学位授与機関識別子テスト</jpcoar:nameIdentifier><jpcoar:degreeGrantorName xml:lang="ja">学位授与機関</jpcoar:degreeGrantorName></jpcoar:degreeGrantor><jpcoar:conference><jpcoar:conferenceName xml:lang="ja">テスト会議</jpcoar:conferenceName><jpcoar:conferenceSequence>12345</jpcoar:conferenceSequence><jpcoar:conferenceSponsor xml:lang="ja">テスト機関</jpcoar:conferenceSponsor><jpcoar:conferenceDate endDay="1" endYear="2005" endMonth="12" startDay="11" xml:lang="ja" startYear="2000" startMonth="4">12</jpcoar:conferenceDate><jpcoar:conferenceVenue xml:lang="ja">テスト会場</jpcoar:conferenceVenue><jpcoar:conferenceCountry>JPN</jpcoar:conferenceCountry></jpcoar:conference><jpcoar:file><jpcoar:URI>https://weko3.example.org/record/1/files/test1.txt</jpcoar:URI><jpcoar:mimeType>text/plain</jpcoar:mimeType><jpcoar:extent>18 B</jpcoar:extent><datacite:date dateType="Accepted">2022-10-20</datacite:date><datacite:version>1.0</datacite:version></jpcoar:file><jpcoar:file><jpcoar:URI>https://weko3.example.org/record/1/files/test2</jpcoar:URI><jpcoar:mimeType>application/octet-stream</jpcoar:mimeType><jpcoar:extent>18 B</jpcoar:extent><datacite:version>1.2</datacite:version></jpcoar:file><jpcoar:file><jpcoar:URI>https://weko3.example.org/record/1/files/test3.png</jpcoar:URI><jpcoar:mimeType>image/png</jpcoar:mimeType><jpcoar:extent>18 B</jpcoar:extent><datacite:version>2.1</datacite:version></jpcoar:file></jpcoar:jpcoar></metadata></record></GetRecord></OAI-PMH>'
        tree = etree.fromstring(xml_str)
        record = tree.findall("./GetRecord/record",namespaces=tree.nsmap)[0]
        xml = etree.tostring(record,encoding="utf-8").decode()
        mapper = JPCOARMapper(xml)
        mapper.itemtype = ItemType.query.filter_by(id=10).one()
    
        test = {'$schema': 10, 'pubdate': '2023-02-20', 'item_1551264308487': [{'subitem_1551255647225': 'test full item', 'subitem_1551255648112': 'ja'}], 'title': 'test full item', 'item_1551264326373': [{'subitem_1551255720400': 'other title', 'subitem_1551255721061': 'en'}], 'item_1551264340087': [{'subitem_1551255991424': [{'subitem_1551256006332': '太郎', 'subitem_1551256007414': 'ja'}], 'subitem_1551255929209': [{'subitem_1551255938498': 'テスト', 'subitem_1551255964991': 'ja'}], 'subitem_1551255898956': [{'subitem_1551255905565': 'テスト, 太郎', 'subitem_1551255907416': 'ja'}], 'subitem_1551256025394': [{'subitem_1551256035730': 'テスト\u3000別郎', 'subitem_1551256055588': 'ja'}]}], 'item_1551264418667': [{'subitem_1551257036415': 'ContactPerson', 'subitem_1551257339190': [{'subitem_1551257342360': '', 'subitem_1551257343979': 'en'}], 'subitem_1551257272214': [{'subitem_1551257314588': 'test', 'subitem_1551257316910': 'en'}], 'subitem_1551257245638': [{'subitem_1551257276108': 'test, smith', 'subitem_1551257279831': 'en'}], 'subitem_1551257372442': [{'subitem_1551257374288': 'other smith', 'subitem_1551257375939': 'en'}]}], 'item_1551264447183': [{'subitem_1551257553743': 'metadata only access', 'subitem_1551257578398': 'http://purl.org/coar/access_right/c_14cb'}], 'item_1551264605515': [{'subitem_1551257776901': 'Paid'}], 'item_1551264629907': [{'subitem_1551257025236': [{'subitem_1551257043769': 'テスト権利情報', 'subitem_1551257047388': 'ja'}], 'subitem_1551257030435': 'テスト権利情報Resource'}], 'item_1551264767789': [{'subitem_1551257249371': [{'subitem_1551257255641': 'テスト\u3000太郎', 'subitem_1551257257683': 'ja'}]}], 'item_1551264822581': [{'subitem_1551257315453': 'テスト主題', 'subitem_1551257323812': 'ja', 'subitem_1551257343002': 'http://bsh.com', 'subitem_1551257329877': 'BSH'}], 'item_1551264846237': [{'subitem_1551255577890': 'this is test abstract.', 'subitem_1551255592625': 'en', 'subitem_1551255637472': 'Abstract'}], 'item_1551264917614': [{'subitem_1551255702686': 'test publisher', 'subitem_1551255710277': 'ja'}], 'item_1551264974654': [{'subitem_1551255753471': '2022-10-20', 'subitem_1551255775519': 'Accepted'}, {'subitem_1551255753471': '2022-10-19', 'subitem_1551255775519': 'Issued'}], 'item_1551265002099': [{'subitem_1551255818386': 'jpn'}], 'item_1551265032053': [{'resourcetype': 'newspaper', 'resourceuri': 'http://purl.org/coar/resource_type/c_2fe3'}], 'item_1551265075370': [{'subitem_1551255975405': '1.1'}], 'item_1551265118680': [{'subitem_1551256025676': 'AO'}], 'system_identifier_doi': [{'subitem_systemidt_identifier': '1111', 'subitem_systemidt_identifier_type': 'DOI'}, {'subitem_systemidt_identifier': 'https://doi.org/1234/0000000001', 'subitem_systemidt_identifier_type': 'DOI'}, {'subitem_systemidt_identifier': 'https://192.168.56.103/records/1', 'subitem_systemidt_identifier_type': 'URI'}], 'item_1581495499605': [{'subitem_1551256250276': '1234/0000000001', 'subitem_1551256259586': 'JaLC'}], 'item_1551265227803': [{'subitem_1551256388439': 'isVersionOf', 'subitem_1551256480278': [{'subitem_1551256498531': '関連情報テスト', 'subitem_1551256513476': 'ja'}], 'subitem_1551256465077': [{'subitem_1551256478339': '1111111', 'subitem_1551256629524': 'ARK'}]}, {'subitem_1551256388439': 'isVersionOf', 'subitem_1551256465077': [{'subitem_1551256478339': 'https://192.168.56.103/records/3', 'subitem_1551256629524': 'URI'}]}], 'item_1551265302120': [{'subitem_1551256918211': '1 to 2', 'subitem_1551256920086': 'ja'}], 'item_1551265385290': [{'subitem_1551256462220': [{'subitem_1551256653656': 'テスト助成機関', 'subitem_1551256657859': 'ja'}], 'subitem_1551256454316': [{'subitem_1551256614960': '22222', 'subitem_1551256619706': 'Crossref Funder'}], 'subitem_1551256688098': [{'subitem_1551256691232': 'テスト研究', 'subitem_1551256694883': 'ja'}], 'subitem_1551256665850': [{'subitem_1551256671920': '1111', 'subitem_1551256679403': 'https://test.research.com'}]}], 'item_1551265409089': [{'subitem_1551256405981': 'test source Identifier', 'subitem_1551256409644': 'PISSN'}], 'item_1551265438256': [{'subitem_1551256349044': 'test collectibles', 'subitem_1551256350188': 'ja'}, {'subitem_1551256349044': 'test title book', 'subitem_1551256350188': 'ja'}], 'item_1551265463411': [{'subitem_1551256328147': '5'}, {'subitem_1551256328147': '1'}], 'item_1551265520160': [{'subitem_1551256294723': '2'}, {'subitem_1551256294723': '2'}], 'item_1551265553273': [{'subitem_1551256248092': '333'}, {'subitem_1551256248092': '555'}], 'item_1551265569218': [{'subitem_1551256198917': '123'}, {'subitem_1551256198917': '789'}, {'subitem_1551256198917': '456'}, {'subitem_1551256198917': '234'}], 'item_1551265738931': [{'subitem_1551256171004': '9999'}], 'item_1551265790591': [{'subitem_1551256126428': 'テスト学位', 'subitem_1551256129013': 'ja'}], 'item_1551265811989': [{'subitem_1551256096004': '2022-10-19'}], 'item_1551265903092': [{'subitem_1551256015892': [{'subitem_1551256027296': '学位授与機関識別子テスト', 'subitem_1551256029891': 'kakenhi'}], 'subitem_1551256037922': [{'subitem_1551256042287': '学位授与機関', 'subitem_1551256047619': 'ja'}]}], 'item_1551265973055': [{'subitem_1599711813532': 'JPN', 'subitem_1599711655652': '12345', 'subitem_1599711633003': [{'subitem_1599711636923': 'テスト会議', 'subitem_1599711645590': 'ja'}]}], 'item_1570069138259': [{'subitem_1551255854908': '1.0', 'subitem_1551255750794': 'text/plain', 'subitem_1551255788530': [{'subitem_1570068579439': '18 B'}], 'subitem_1551255820788': [{'subitem_1551255828320': '2022-10-20', 'subitem_1551255833133': 'Accepted'}], 'subitem_1551255558587': [{'subitem_1551255570271': 'https://weko3.example.org/record/1/files/test1.txt'}]}, {'subitem_1551255854908': '1.2', 'subitem_1551255750794': 'application/octet-stream', 'subitem_1551255788530': [{'subitem_1570068579439': '18 B'}], 'subitem_1551255558587': [{'subitem_1551255570271': 'https://weko3.example.org/record/1/files/test2'}]}, {'subitem_1551255854908': '2.1', 'subitem_1551255750794': 'image/png', 'subitem_1551255788530': [{'subitem_1570068579439': '18 B'}], 'subitem_1551255558587': [{'subitem_1551255570271': 'https://weko3.example.org/record/1/files/test3.png'}]}]}
        result = mapper.map()
>       assert result == test
E       AssertionError: assert {'$schema': 1...'ja'}]}], ...} == {'$schema': 1...'ja'}]}], ...}
E         Omitting 34 identical items, use -vv to show
E         Differing items:
E         {'item_1551265385290': [{'subitem_1551256462220': [{'subitem_1551256653656': 'テスト助成機関', 'subitem_1551256657859': 'ja'}], 'subitem_1551256688098': [{'subitem_1551256691232': 'テスト研究', 'subitem_1551256694883': 'ja'}]}]} != {'item_1551265385290': [{'subitem_1551256454316': [{'subitem_1551256614960': '22222', 'subitem_1551256619706': 'Crossr...//test.research.com'}], 'subitem_1551256688098': [{'subitem_1551256691232': 'テスト研究', 'subitem_1551256694883': 'ja'}]}]}
E         {'item_1551264418667': [{'subitem_1551257036415': 'Conta...
E         
E         ...Full output truncated (137 lines hidden), use '-vv' to show

tests/test_harvester.py:1168: AssertionError
------------------------------ Captured log setup ------------------------------
WARNING  flask.app:ext.py:255 JSONSCHEMAS_HOST is set to localhost
__________________ TestDDIMapper.test_ddi_harvest_processing ___________________

self = <tests.test_harvester.TestDDIMapper object at 0x7f680e3f87b8>
db_itemtype = {'item_type_ddi': <ItemType 11>, 'item_type_ddi_mapping': <ItemTypeMapping 11>, 'item_type_ddi_name': <ItemTypeName 11>, 'item_type_multiple': <ItemType 10>, ...}

    def test_ddi_harvest_processing(self,db_itemtype):
        data = OrderedDict([
            ('@xmlns:dc', 'http://purl.org/dc/terms/'),
            ('@xmlns:fn', 'http://www.w3.org/2005/xpath-functions'),
            ('@xmlns:saxon', 'http://xml.apache.org/xslt'),
            ('@xmlns:xhtml', 'http://www.w3.org/1999/xhtml'),
            ('@xmlns:xs', 'http://www.w3.org/2001/XMLSchema'),
            ('@xmlns', 'ddi:codebook:2_5'),
            ('@xsi:schemaLocation', 'https://ddialliance.org/Specification/DDI-Codebook/2.5/XMLSchema/codebook.xsd'),
            ('stdyDscr', OrderedDict([
                ('citation', OrderedDict([
                    ('@xml:lang', 'ja'),
                    ('titlStmt', [
                        'titlSmt_top1',
                        'titlSmt_top2',
                        OrderedDict([
                        ('titl', OrderedDict([
                            ('@xml:lang', 'ja'),
                            ('#text', 'test ddi full item'),
                        ])),
                        ('altTitl', OrderedDict([
                            ('@xml:lang', 'ja'),
                            ('#text', 'other ddi title')
                        ])),
                        ('IDNo', OrderedDict([
                            ('@agency', 'test_id_agency'),
                            ('@xml:lang', 'ja'),
                            ('#text', 'test_study_id')
                        ]))
                    ])]),
                    ('rspStmt', OrderedDict([
                        ('AuthEnty', OrderedDict([
                            ('@ID', '4'),
                            ('@xml:lang', 'ja'),
                            ('@affiliation', 'author.affiliation'),
                            ('#text', 'テスト, 太郎')
                        ]))
                    ])),
                    ('rspStmt', OrderedDict([
                        ('AuthEnty', OrderedDict([
                            ('@ID', '4'),
                            ('@xml:lang', 'ja'),
                            ('@affiliation', 'author.affiliation'),
                            ('#text', 'テスト, 太郎')
                        ]))
                    ])),
                    ('prodStmt', OrderedDict([
                        ('producer', OrderedDict([
                            ('@xml:lang', 'ja'),
                            ('#text', 'test_publisher')
                        ])),
                        ('copyright', OrderedDict([
                            ('@xml:lang', 'ja'),
                            ('@description','this is rights description.'),
                            ('@from','today'),
                            ('#text', 'test_rights')
                        ])),
                        ('fundAg', OrderedDict([
                            ('@ID', 'test_found_ageny'),
                            ('@xml:lang', 'ja'),
                            ('#text', 'test_founder_name')
                        ])),
                        ('grantNo', 'test_grant_no')
                    ])),
                    ('distStmt', OrderedDict([
                        ('distrbtr', OrderedDict([
                            ('@URI', 'https://test.distributor.affiliation'),
                            ('@abbr', 'TDN'),
                            ('@xml:lang', 'ja'),
                            ('@affiliation', 'Test Distributor Affiliation'),
                            ('#text', 'Test Distributor Name')
                        ]))
                    ])),
                    ('serStmt', OrderedDict([
                        ('serName', OrderedDict([
                            ('@xml:lang', 'ja'),
                            ('#text', 'test_series')
                        ]))
                    ])),
                    ('notes', OrderedDict([
                        ('#text','test_text'),
                        ('@sub_text','sub_test_text')
                    ])),
                    ('verStmt', OrderedDict([
                        ('version', OrderedDict([
                            ('@date', '2023-03-07'),
                            ('@xml:lang', 'ja'),
                            ('#text', '1.2')
                        ]))
                    ])),
                    ('biblCit', OrderedDict([
                        ('@xml:lang', 'ja'),
                        ('#text', 'test.input.content')
                    ])),
                    ('holdings', [
                        OrderedDict([
                            ('@URI', 'https://192.168.56.103/records/75')
                        ]),
                        OrderedDict([
                            ('#text','http://doi.org/test_doi')
                        ]),
                        OrderedDict([
                            ('#text','http://hdl.handle.net/test_doi')
                        ]),
                        OrderedDict([
                            ('#text','http://other_prefix')
                        ])
                    ])
                ])),
                ('stdyInfo', [
                    OrderedDict([
                        ('@xml:lang', 'ja'),
                        ('subject', OrderedDict([
                            ('topcClas', [
                                OrderedDict([
                                    ('@vocab', 'test_topic_vocab'),
                                    ('@vocabURI', 'http://test.topic.vocab'),
                                    ('@xml:lang', 'ja'),
                                    ('#text', 'Test Topic')
                                ]),
                                OrderedDict([
                                    ('@vocab', 'CESSDA Topic Classification'),
                                    ('@vocabURI', 'https://vocabularies.cessda.eu/urn/urn:ddi:int.cessda.cv:TopicClassification'),
                                    ('@xml:lang', 'ja'),
                                    ('#text', '人口')
                                ]),
                                "test_str_value"
                            ])
                        ])),
                        ('sumDscr', OrderedDict([
                            ('timePrd', [
                                OrderedDict([
                                    ('@event', 'start'),
                                    ('#text', '2023-03-01')
                                ]),
                                OrderedDict([
                                    ('@event', 'end'),
                                    ('#text', '2023-03-03')
                                ])
                            ]),
                            ('collDate', [
                                OrderedDict([
                                    ('@event', 'start'),
                                    ('#text', '2023-03-01')
                                ]),
                                OrderedDict([
                                    ('@event', 'end'),
                                    ('#text', '2023-03-06')
                                ])
                            ]),
                            ('geogCover', OrderedDict([
                                ('@xml:lang', 'ja'),
                                ('#text', 'test_geographic_coverage')
                            ])),
                            ('anlyUnit', OrderedDict([
                                ('@xml:lang', 'ja'),
                                ('#text', '個人')
                            ])),
                            ('universe', OrderedDict([
                                ('@xml:lang', 'ja'),
                                ('#text', 'test parent set')
                            ])),
                            ('dataKind', OrderedDict([
                                ('@xml:lang', 'ja'),
                                ('#text', '量的調査')
                            ]))
                        ]))
                    ]),
                    OrderedDict([
                        ('@xml:lang', 'en'),
                        ('subject', OrderedDict([
                            ('topcClas', OrderedDict([
                                ('@vocab', 'CESSDA Topic Classification'),
                                ('@vocabURI', 'https://vocabularies.cessda.eu/urn/urn:ddi:int.cessda.cv:TopicClassification'),
                                ('@xml:lang', 'en'),
                                ('#text', 'Demography')
                            ]))
                        ])),
                        ('abstract', [
                            OrderedDict([
                                ('@xml:lang', 'en'),
                                ('@subvalue','this is description for ddi item.\nthis is description for ddi item.'),
                                ('#text', '<p>this is description for ddi item.</p> \n<p>this is description for ddi item.</p>')
                            ]),
                            ]),
                        ('sumDscr', OrderedDict([
                            ('timePrd', [
                                OrderedDict([
                                    ('@event', 'start'),
                                    ('#text', '2023-03-01')
                                ]),
                                OrderedDict([
                                    ('@event', 'end'),
                                    ('#text', '2023-03-03')
                                ])
                            ]),
                            ('collDate', [
                                OrderedDict([
                                    ('@event', 'start'),
                                    ('#text', '2023-03-01')
                                ]),
                                OrderedDict([
                                    ('@event', 'end'),
                                    ('#text', '2023-03-06')
                                ])
                            ]),
                            ('anlyUnit', [
                                OrderedDict([
                                    ('@xml:lang', 'en'),
                                    ('#text', 'test_unit_of_analysis')
                                ]),
                                OrderedDict([
                                    ('@xml:lang', 'en'),
                                    ('#text', 'Individual')
                                ])
                            ]),
                            ('dataKind', OrderedDict([
                                ('@xml:lang', 'en'),
                                ('#text', 'quantatitive research')
                            ]))
                        ]))
                    ])
                ]),
                ('method', [
                    OrderedDict([
                        ('@xml:lang', 'ja'),
                        ('dataColl', OrderedDict([
                            ('sampProc', [
                                OrderedDict([
                                    ('@xml:lang', 'ja'),
                                    ('#text', 'test sampling procedure')
                                ]),
                                OrderedDict([
                                    ('@xml:lang', 'ja'),
                                    ('#text', '母集団/ 全数調査')
                                ])
                            ]),
                            ('collMode', [
                                OrderedDict([
                                    ('@xml:lang', 'ja'),
                                    ('#text', 'test collection method')
                                ]),
                                OrderedDict([
                                    ('@xml:lang', 'ja'),
                                    ('#text', 'インタビュー')
                                ])
                            ])
                        ])),
                        ('anlyInfo', OrderedDict([
                            ('respRate', OrderedDict([
                                ('@xml:lang', 'ja'),
                                ('#text', 'test sampling procedure_sampling_rate')
                            ]))
                        ]))
                    ]),
                    OrderedDict([
                        ('@xml:lang', 'en'),
                        ('dataColl', OrderedDict([
                            ('sampProc', OrderedDict([
                                ('@xml:lang', 'en'),
                                ('#text', 'Total universe/Complete enumeration')
                            ])),
                            ('collMode', OrderedDict([
                                ('@xml:lang', 'en'),
                                ('#text', 'Interview')
                            ]))
                        ])),
                        ('anlyInfo', None)
                    ])
                ]),
                ('dataAccs', [
                    OrderedDict([
                        ('@xml:lang', 'jp'),
                        ('setAvail', OrderedDict([
                            ('avlStatus', OrderedDict([
                                ('@xml:lang', 'jp'),
                                ('#text', 'オープンアクセス')
                            ]))
                        ])),
                        ('notes', 'jpn')
                    ]),
                    OrderedDict([
                        ('@xml:lang', 'en'),
                        ('setAvail', OrderedDict([
                            ('avlStatus', OrderedDict([
                                ('@xml:lang', 'en'),
                                ('#text', 'open access')
                            ]))
                        ])),
                        ('notes', 'jpn')
                    ])
                ]),
                ('othrStdyMat', OrderedDict([
                    ('@xml:lang', 'ja'),
                    ('relStdy', OrderedDict([
                        ('@ID', 'test_related_study_identifier'),
                        ('@xml:lang', 'ja'),
                        ('#text', 'test_related_study_title')
                    ]))
                    #('relPubl', OrderedDict([
                    #    ('@ID', 'test_related_publication_identifier'),
                    #    ('@xml:lang', 'ja'),
                    #    ('#text', 'test_related_publication_title')
                    #]))
                ]))
            ])),
            ('stdyDscr.othrStdyMat.relStdy',OrderedDict([
                ('@ID', 'test_related_study_identifier_out1'),
                ('@xml:lang', 'ja'),
                ('#text', 'test_related_study_title')
            ])),
            ('stdyDscr.othrStdyMat.relPubl',OrderedDict([
                        ('@ID', 'test_related_publication_identifier_out1'),
                        ('@xml:lang', 'ja'),
                        ('#text', 'test_related_publication_title_out')])),
            ('stdyDscr.citation.holdings',[OrderedDict([
                            ('#text', 'test_url')
                        ])])
    
        ])
        xml_str = '<OAI-PMH xmlns="http://www.openarchives.org/OAI/2.0/" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://www.openarchives.org/OAI/2.0/ http://www.openarchives.org/OAI/2.0/OAI-PMH.xsd"><responseDate>2023-03-02T04:08:53Z</responseDate><request metadataPrefix="ddi" verb="GetRecord" identifier="oai:weko3.example.org:00000075">https://192.168.56.103/oai</request><GetRecord><record><header><identifier>oai:weko3.example.org:00000075</identifier><datestamp>2023-03-02T04:06:46Z</datestamp><setSpec>1557820086539</setSpec></header><metadata><codeBook xmlns:dc="http://purl.org/dc/terms/" xmlns:fn="http://www.w3.org/2005/xpath-functions" xmlns:saxon="http://xml.apache.org/xslt" xmlns:xhtml="http://www.w3.org/1999/xhtml" xmlns:xs="http://www.w3.org/2001/XMLSchema" xmlns="ddi:codebook:2_5" xsi:schemaLocation="https://ddialliance.org/Specification/DDI-Codebook/2.5/XMLSchema/codebook.xsd"><stdyDscr><citation xml:lang="ja"><titlStmt><titl xml:lang="ja">test ddi full item</titl><altTitl xml:lang="ja">other ddi title</altTitl><IDNo agency="test_id_agency" xml:lang="ja">test_study_id</IDNo></titlStmt><rspStmt><AuthEnty ID="4" xml:lang="ja" affiliation="author.affiliation">テスト, 太郎</AuthEnty><AuthEnty ID="4" xml:lang="ja" affiliation="author.affiliation">テスト, 太郎</AuthEnty></rspStmt><prodStmt><producer xml:lang="ja">test_publisher</producer><copyright xml:lang="ja" description="this is rights description." from="today">test_rights</copyright><fundAg ID="test_found_ageny" xml:lang="ja">test_founder_name</fundAg><grantNo>test_grant_no</grantNo></prodStmt><distStmt><distrbtr URI="https://test.distributor.affiliation" abbr="TDN" xml:lang="ja" affiliation="Test Distributor Affiliation">Test Distributor Name</distrbtr></distStmt><serStmt><serName xml:lang="ja">test_series</serName></serStmt><notes sub_text="sub_test_text">test_text</notes><verStmt><version date="2023-03-07" xml:lang="ja">1.2</version></verStmt><biblCit xml:lang="ja">test.input.content</biblCit><holdings URI="https://192.168.56.103/records/75" /><holdings>http://doi.org/test_doi</holdings><holdings>http://hdl.handle.net/test_doi</holdings><holdings>http://other_prefix</holdings></citation><stdyInfo xml:lang="ja"><subject><topcClas vocab="test_topic_vocab" vocabURI="http://test.topic.vocab" xml:lang="ja">Test Topic</topcClas><topcClas vocab="CESSDA Topic Classification" vocabURI="https://vocabularies.cessda.eu/urn/urn:ddi:int.cessda.cv:TopicClassification" xml:lang="ja">人口</topcClas></subject><sumDscr><timePrd event="start">2023-03-01</timePrd><timePrd event="end">2023-03-03</timePrd><collDate event="start">2023-03-01</collDate><collDate event="end">2023-03-06</collDate><geogCover xml:lang="ja">test_geographic_coverage</geogCover><anlyUnit xml:lang="ja">個人</anlyUnit><universe xml:lang="ja">test parent set</universe><dataKind xml:lang="ja">量的調査</dataKind></sumDscr></stdyInfo><stdyInfo xml:lang="en"><subject><topcClas vocab="CESSDA Topic Classification" vocabURI="https://vocabularies.cessda.eu/urn/urn:ddi:int.cessda.cv:TopicClassification" xml:lang="en">Demography</topcClas></subject><abstract xml:lang="en" subvalue="this is description for ddi item.\nthis is description for ddi item.">this is description for ddi item. this is description for ddi item.</abstract><sumDscr><timePrd event="start">2023-03-01</timePrd><timePrd event="end">2023-03-03</timePrd><collDate event="start">2023-03-01</collDate><collDate event="end">2023-03-06</collDate><anlyUnit xml:lang="en">test_unit_of_analysis</anlyUnit><anlyUnit xml:lang="en">Individual</anlyUnit><dataKind xml:lang="en">quantatitive research</dataKind></sumDscr></stdyInfo><method xml:lang="ja"><dataColl><sampProc xml:lang="ja">test sampling procedure</sampProc><sampProc xml:lang="ja">母集団/ 全数調査</sampProc><collMode xml:lang="ja">test collection method</collMode><collMode xml:lang="ja">インタビュー</collMode></dataColl><anlyInfo><respRate xml:lang="ja">test sampling procedure_sampling_rate</respRate></anlyInfo></method><method xml:lang="en"><dataColl><sampProc xml:lang="en">Total universe/Complete enumeration</sampProc><collMode xml:lang="en">Interview</collMode></dataColl><anlyInfo /></method><dataAccs xml:lang="jp"><setAvail><avlStatus xml:lang="jp">オープンアクセス</avlStatus></setAvail><notes>jpn</notes></dataAccs><dataAccs xml:lang="en"><setAvail><avlStatus xml:lang="en">open access</avlStatus></setAvail><notes>jpn</notes></dataAccs><othrStdyMat xml:lang="ja"><relStdy ID="test_related_study_identifier" xml:lang="ja">test_related_study_title</relStdy><relPubl ID="test_related_publication_identifier" xml:lang="ja">test_related_publication_title</relPubl></othrStdyMat></stdyDscr></codeBook></metadata></record></GetRecord></OAI-PMH>'
        tree = etree.fromstring(xml_str)
        record = tree.findall("./GetRecord/record",namespaces=tree.nsmap)[0]
        xml = etree.tostring(record,encoding="utf-8").decode()
        mapper = DDIMapper(xml)
        mapper.map_itemtype('codeBook')
        test = {'$schema': 11, 'pubdate': str(mapper.datestamp()), 'item_1586157591881': [{'subitem_1586156939407': 'titlSmt_top1'}, {'subitem_1586156939407': 'titlSmt_top2'}, {'subitem_1586156939407': 'test_study_id', 'subitem_1591256665864': 'test_id_agency', 'subitem_1586311767281': 'ja'}], 'item_1551264308487': [{'subitem_1551255647225': 'test ddi full item', 'subitem_1551255648112': 'ja'}], 'item_1551264326373': [{'subitem_1551255720400': 'other ddi title', 'subitem_1551255721061': 'ja'}], 'item_1593074267803': [{'creatorNames': [{'creatorName': 'テスト, 太郎', 'creatorNameLang': 'ja'}], 'nameIdentifiers': [{'nameIdentifier': '4'}], 'creatorAffiliations': [{'affiliationNames': [{'affiliationName': 'author.affiliation'}]}]}], 'item_1551264917614': [{'subitem_1551255702686': 'test_publisher', 'subitem_1551255710277': 'ja'}], 'item_1551264629907': [{'subitem_1602213569986': {'subitem_1602213569987': 'test_rights'}, 'subitem_1602213570623': 'ja', 'subitem_1602213569989': {'subitem_1602213569990': {'subitem_1602213569988': 'this is rights description.'}}, 'subitem_1602213569991': {'subitem_1602213569992': 'today'}}], 'item_1602145817646': [{'subitem_1602142814330': 'test_founder_name', 'subitem_1602142815328': 'ja'}], 'item_1602145850035': [{'subitem_1602142123771': 'test_grant_no'}], 'item_1592405734122': [{'subitem_1592369405220': 'Test Distributor Name', 'subitem_1591320914113': 'https://test.distributor.affiliation', 'subitem_1591320889728': 'TDN', 'subitem_1592369407829': 'ja', 'subitem_1591320890384': 'Test Distributor Affiliation'}], 'item_1588254290498': [{'subitem_1587462181884': 'test_series', 'subitem_1587462183075': 'ja'}], 'item_1645678901234': [{'interim': 'test_text', 'subitem_165678901234567': 'sub_test_text'}], 'item_1551265075370': [{'subitem_1591254914934': '1.2', 'subitem_1591254915862': '2023-03-07', 'subitem_1591254915406': 'ja'}], 'item_1592880868902': [{'subitem_1586228465211': 'test.input.content', 'subitem_1586228490356': 'ja'}], 'item_1612345678910': [{'subitem_1623456789123': 'http://doi.org/test_doi'}, {'subitem_1623456789123': 'http://hdl.handle.net/test_doi'}, {'subitem_1623456789123': 'http://other_prefix'}], 'item_1551264822581': [{'subitem_1592472785169': 'Test Topic', 'subitem_1592472786088': 'test_topic_vocab', 'subitem_1592472786560': 'http://test.topic.vocab', 'subitem_1592472785698': 'ja'}, {'subitem_1592472785169': '人口', 'subitem_1592472786088': 'CESSDA Topic Classification', 'subitem_1592472786560': 'https://vocabularies.cessda.eu/urn/urn:ddi:int.cessda.cv:TopicClassification', 'subitem_1592472785698': 'ja'}, {'subitem_1592472785169': 'test_str_value'}, {'subitem_1592472785169': 'Demography', 'subitem_1592472786088': 'CESSDA Topic Classification', 'subitem_1592472786560': 'https://vocabularies.cessda.eu/urn/urn:ddi:int.cessda.cv:TopicClassification', 'subitem_1592472785698': 'en'}], 'item_1602145192334': [{'subitem_1602144573160': '2023-03-01', 'subitem_1602144587621': 'start'}, {'subitem_1602144573160': '2023-03-03', 'subitem_1602144587621': 'end'}], 'item_1586253152753': [{'subitem_1602144573160': '2023-03-01', 'subitem_1602144587621': 'start'}, {'subitem_1602144573160': '2023-03-06', 'subitem_1602144587621': 'end'}], 'item_1570068313185': [{'subitem_1586419454219': 'test_geographic_coverage', 'subitem_1586419462229': 'ja'}], 'item_1586253224033': [{'subitem_1596608607860': '個人', 'subitem_1596608609366': 'ja'}, {'subitem_1596608607860': 'test_unit_of_analysis', 'subitem_1596608609366': 'en'}, {'subitem_1596608607860': 'Individual', 'subitem_1596608609366': 'en'}], 'item_1586253249552': [{'subitem_1596608974429': 'test parent set', 'subitem_1596608975087': 'ja'}], 'item_1588260046718': [{'subitem_1591178807921': '量的調査', 'subitem_1591178808409': 'ja'}, {'subitem_1591178807921': 'quantatitive research', 'subitem_1591178808409': 'en'}], 'item_1551264846237': [{'subitem_1551255577890': 'this is description for ddi item.\nthis is description for ddi item.', 'subitem_1551255592625': 'en'}], 'item_1586253334588': [{'subitem_1596609826487': 'test sampling procedure', 'subitem_1596609827068': 'ja'}, {'subitem_1596609826487': '母集団/ 全数調査', 'subitem_1596609827068': 'ja'}, {'subitem_1596609826487': 'Total universe/Complete enumeration', 'subitem_1596609827068': 'en'}], 'item_1586253349308': [{'subitem_1596610500817': 'test collection method', 'subitem_1596610501381': 'ja'}, {'subitem_1596610500817': 'インタビュー', 'subitem_1596610501381': 'ja'}, {'subitem_1596610500817': 'Interview', 'subitem_1596610501381': 'en'}], 'item_1586253589529': [{'subitem_1596609826487': 'test sampling procedure_sampling_rate', 'subitem_1596609827068': 'ja'}], 'item_1588260178185': [{'subitem_1522650727486': 'オープンアクセス', 'subitem_1522650717957': 'jp'}, {'subitem_1522650727486': 'open access', 'subitem_1522650717957': 'en'}], 'item_1551265002099': [{'subitem_1551255818386': 'jpn'}], 'item_1592405736602': [{'subitem_1602215239359': 'test_related_study_title', 'subitem_1602215240520': 'test_related_study_identifier', 'subitem_1602215239925': 'ja'}, {'subitem_1602215239359': 'test_related_study_title', 'subitem_1602215240520': 'test_related_study_identifier_out1', 'subitem_1602215239925': 'ja'}], 'item_1592405735401': [{'subitem_1602214558730': 'test_related_publication_title_out', 'subitem_1602214560358': 'test_related_publication_identifier_out1', 'subitem_1602214559588': 'ja'}]}
        res = {"$schema":mapper.itemtype.id,"pubdate":str(mapper.datestamp())}
        mapper.ddi_harvest_processing(data,res)
>       assert res == test
E       AssertionError: assert {'$schema': 1...: 'ja'}], ...} == {'$schema': 1...: 'ja'}], ...}
E         Omitting 27 identical items, use -vv to show
E         Differing items:
E         {'item_1551264326373': [{'subitem_1551255720400': 'titlSmt_top1'}, {'subitem_1551255720400': 'titlSmt_top2'}, {'subitem_1551255720400': 'other ddi title', 'subitem_1551255721061': 'ja'}]} != {'item_1551264326373': [{'subitem_1551255720400': 'other ddi title', 'subitem_1551255721061': 'ja'}]}
E         {'item_1586157591881': [{'subitem_1586156939407': 'test_study_id', 'subitem_1586311767281': 'ja', 'subitem_1591256665864': 'test_id_agency'}]} != {'item_1586157591881': [{'subitem_1586156939407': 'titlSmt_top1'}, {'subitem_1...
E         
E         ...Full output truncated (140 lines hidden), use '-vv' to show

tests/test_harvester.py:2281: AssertionError
------------------------------ Captured log setup ------------------------------
WARNING  flask.app:ext.py:255 JSONSCHEMAS_HOST is set to localhost
______________________________ test_process_item _______________________________

app = <Flask 'testapp'>
db = <SQLAlchemy engine=postgresql+psycopg2://invenio:***@postgresql:5432/wekotest>
esindex = <Elasticsearch([{'host': 'elasticsearch'}])>, location = local
db_itemtype = {'item_type_ddi': <ItemType 11>, 'item_type_ddi_mapping': <ItemTypeMapping 11>, 'item_type_ddi_name': <ItemTypeName 11>, 'item_type_multiple': <ItemType 10>, ...}
harvest_setting = [<HarvestSettings 1>, <HarvestSettings 2>, <HarvestSettings 3>, <HarvestSettings 4>]
db_records = None
mocker = <pytest_mock.plugin.MockerFixture object at 0x7f680d3bab00>

    def test_process_item(app, db, esindex, location, db_itemtype,harvest_setting,db_records,mocker):
        mocker.patch("weko_search_ui.utils.send_item_created_event_to_es")
        mock_resource_type_map={
            'conference paper':'Harvesting dc'
        }
        mocker.patch("invenio_oaiharvester.harvester.RESOURCE_TYPE_MAP",mock_resource_type_map)
        # jpcoar
        # mapper.is_deleted is true
        _etree = etree.fromstring('<OAI-PMH xmlns="http://www.openarchives.org/OAI/2.0/" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://www.openarchives.org/OAI/2.0/ http://www.openarchives.org/OAI/2.0/OAI-PMH.xsd"><responseDate>2023-03-01T02:07:10Z</responseDate><request metadataPrefix="oai_dc" identifier="oai:weko3.example.org:00000001" verb="GetRecord">https://192.168.56.103/oai</request><GetRecord><record><header status="deleted"><identifier>oai:weko3.example.org:00000005</identifier><datestamp>2023-02-20T06:24:47Z</datestamp></header></record></GetRecord></OAI-PMH>')
        _records = _etree.findall('./GetRecord/record', namespaces=_etree.nsmap)
        _counter = {}
        res = process_item(_records[0], harvest_setting[0], _counter, None)
        assert res==None
    
        ## pubdate > mapper.datestamp, update_style=1
        _etree = etree.fromstring('<OAI-PMH xmlns="http://www.openarchives.org/OAI/2.0/" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://www.openarchives.org/OAI/2.0/ http://www.openarchives.org/OAI/2.0/OAI-PMH.xsd"><GetRecord><record><header><identifier>oai:weko3.example.org:00000001</identifier><datestamp>2020-02-20T06:24:47Z</datestamp><setSpec>1557819692844:1557819733276</setSpec><setSpec>1557820086539</setSpec></header><metadata><jpcoar:jpcoar xmlns:datacite="https://schema.datacite.org/meta/kernel-4/" xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:dcndl="http://ndl.go.jp/dcndl/terms/" xmlns:dcterms="http://purl.org/dc/terms/" xmlns:jpcoar="https://github.com/JPCOAR/schema/blob/master/1.0/" xmlns:oaire="http://namespace.openaire.eu/schema/oaire/" xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#" xmlns:rioxxterms="http://www.rioxx.net/schema/v2.0/rioxxterms/" xmlns:xs="http://www.w3.org/2001/XMLSchema" xmlns="https://github.com/JPCOAR/schema/blob/master/1.0/" xsi:schemaLocation="https://github.com/JPCOAR/schema/blob/master/1.0/jpcoar_scm.xsd"><dc:title xml:lang="ja">test full item</dc:title><dcterms:alternative xml:lang="en">other title</dcterms:alternative><jpcoar:creator><jpcoar:nameIdentifier nameIdentifierURI="https://orcid.org/1234" nameIdentifierScheme="ORCID">1234</jpcoar:nameIdentifier><jpcoar:creatorName xml:lang="ja">テスト, 太郎</jpcoar:creatorName><jpcoar:familyName xml:lang="ja">テスト</jpcoar:familyName><jpcoar:givenName xml:lang="ja">太郎</jpcoar:givenName><jpcoar:creatorAlternative xml:lang="ja">テスト　別郎</jpcoar:creatorAlternative><jpcoar:affiliation><jpcoar:nameIdentifier nameIdentifierURI="http://www.isni.org/isni/5678" nameIdentifierScheme="ISNI">5678</jpcoar:nameIdentifier></jpcoar:affiliation></jpcoar:creator><jpcoar:contributor contributorType="ContactPerson"><jpcoar:nameIdentifier nameIdentifierURI="https://orcid.org/5678" nameIdentifierScheme="ORCID">5678</jpcoar:nameIdentifier><jpcoar:contributorName xml:lang="en">test, smith</jpcoar:contributorName><jpcoar:familyName xml:lang="en">test</jpcoar:familyName><jpcoar:givenName xml:lang="en">smith</jpcoar:givenName><jpcoar:contributorAlternative xml:lang="en">other smith</jpcoar:contributorAlternative><jpcoar:affiliation><jpcoar:nameIdentifier nameIdentifierURI="http://www.isni.org/isni/1234" nameIdentifierScheme="ISNI">1234</jpcoar:nameIdentifier></jpcoar:affiliation></jpcoar:contributor><dcterms:accessRights rdf:resource="http://purl.org/coar/access_right/c_14cb">metadata only access</dcterms:accessRights><rioxxterms:apc>Paid</rioxxterms:apc><dc:rights xml:lang="ja" rdf:resource="テスト権利情報Resource">テスト権利情報</dc:rights><jpcoar:rightsHolder><jpcoar:rightsHolderName xml:lang="ja">テスト　太郎</jpcoar:rightsHolderName></jpcoar:rightsHolder><jpcoar:subject xml:lang="ja" subjectURI="http://bsh.com" subjectScheme="BSH">テスト主題</jpcoar:subject><datacite:description xml:lang="en" descriptionType="Abstract">this is test abstract.</datacite:description><dc:publisher xml:lang="ja">test publisher</dc:publisher><datacite:date dateType="Accepted">2022-10-20</datacite:date><datacite:date dateType="Issued">2022-10-19</datacite:date><dc:language>jpn</dc:language><dc:type rdf:resource="http://purl.org/coar/resource_type/c_2fe3">newspaper</dc:type><datacite:version>1.1</datacite:version><oaire:version rdf:resource="http://purl.org/coar/version/c_b1a7d7d4d402bcce">AO</oaire:version><jpcoar:identifier identifierType="DOI">1111</jpcoar:identifier><jpcoar:identifier identifierType="DOI">https://doi.org/1234/0000000001</jpcoar:identifier><jpcoar:identifier identifierType="URI">https://192.168.56.103/records/1</jpcoar:identifier><jpcoar:identifierRegistration identifierType="JaLC">1234/0000000001</jpcoar:identifierRegistration><jpcoar:relation relationType="isVersionOf"><jpcoar:relatedIdentifier identifierType="ARK">1111111</jpcoar:relatedIdentifier><jpcoar:relatedTitle xml:lang="ja">関連情報テスト</jpcoar:relatedTitle></jpcoar:relation><jpcoar:relation relationType="isVersionOf"><jpcoar:relatedIdentifier identifierType="URI">https://192.168.56.103/records/3</jpcoar:relatedIdentifier></jpcoar:relation><dcterms:temporal xml:lang="ja">1 to 2</dcterms:temporal><datacite:geoLocation><datacite:geoLocationPoint><datacite:pointLongitude>12345</datacite:pointLongitude><datacite:pointLatitude>67890</datacite:pointLatitude></datacite:geoLocationPoint><datacite:geoLocationBox><datacite:westBoundLongitude>123</datacite:westBoundLongitude><datacite:eastBoundLongitude>456</datacite:eastBoundLongitude><datacite:southBoundLatitude>789</datacite:southBoundLatitude><datacite:northBoundLatitude>1112</datacite:northBoundLatitude></datacite:geoLocationBox><datacite:geoLocationPlace>テスト位置情報</datacite:geoLocationPlace></datacite:geoLocation><jpcoar:fundingReference><datacite:funderIdentifier funderIdentifierType="Crossref Funder">22222</datacite:funderIdentifier><jpcoar:funderName xml:lang="ja">テスト助成機関</jpcoar:funderName><datacite:awardNumber awardURI="https://test.research.com">1111</datacite:awardNumber><jpcoar:awardTitle xml:lang="ja">テスト研究</jpcoar:awardTitle></jpcoar:fundingReference><jpcoar:sourceIdentifier identifierType="PISSN">test source Identifier</jpcoar:sourceIdentifier><jpcoar:sourceTitle xml:lang="ja">test collectibles</jpcoar:sourceTitle><jpcoar:sourceTitle xml:lang="ja">test title book</jpcoar:sourceTitle><jpcoar:volume>5</jpcoar:volume><jpcoar:volume>1</jpcoar:volume><jpcoar:issue>2</jpcoar:issue><jpcoar:issue>2</jpcoar:issue><jpcoar:numPages>333</jpcoar:numPages><jpcoar:numPages>555</jpcoar:numPages><jpcoar:pageStart>123</jpcoar:pageStart><jpcoar:pageStart>789</jpcoar:pageStart><jpcoar:pageEnd>456</jpcoar:pageEnd><jpcoar:pageEnd>234</jpcoar:pageEnd><dcndl:dissertationNumber>9999</dcndl:dissertationNumber><dcndl:degreeName xml:lang="ja">テスト学位</dcndl:degreeName><dcndl:dateGranted>2022-10-19</dcndl:dateGranted><jpcoar:degreeGrantor><jpcoar:nameIdentifier nameIdentifierScheme="kakenhi">学位授与機関識別子テスト</jpcoar:nameIdentifier><jpcoar:degreeGrantorName xml:lang="ja">学位授与機関</jpcoar:degreeGrantorName></jpcoar:degreeGrantor><jpcoar:conference><jpcoar:conferenceName xml:lang="ja">テスト会議</jpcoar:conferenceName><jpcoar:conferenceSequence>12345</jpcoar:conferenceSequence><jpcoar:conferenceSponsor xml:lang="ja">テスト機関</jpcoar:conferenceSponsor><jpcoar:conferenceDate endDay="1" endYear="2005" endMonth="12" startDay="11" xml:lang="ja" startYear="2000" startMonth="4">12</jpcoar:conferenceDate><jpcoar:conferenceVenue xml:lang="ja">テスト会場</jpcoar:conferenceVenue><jpcoar:conferenceCountry>JPN</jpcoar:conferenceCountry></jpcoar:conference><jpcoar:file><jpcoar:URI>https://weko3.example.org/record/1/files/test1.txt</jpcoar:URI><jpcoar:mimeType>text/plain</jpcoar:mimeType><jpcoar:extent>18 B</jpcoar:extent><datacite:date dateType="Accepted">2022-10-20</datacite:date><datacite:version>1.0</datacite:version></jpcoar:file><jpcoar:file><jpcoar:URI>https://weko3.example.org/record/1/files/test2</jpcoar:URI><jpcoar:mimeType>application/octet-stream</jpcoar:mimeType><jpcoar:extent>18 B</jpcoar:extent><datacite:version>1.2</datacite:version></jpcoar:file><jpcoar:file><jpcoar:URI>https://weko3.example.org/record/1/files/test3.png</jpcoar:URI><jpcoar:mimeType>image/png</jpcoar:mimeType><jpcoar:extent>18 B</jpcoar:extent><datacite:version>2.1</datacite:version></jpcoar:file></jpcoar:jpcoar></metadata></record></GetRecord></OAI-PMH>')
        _records = _etree.findall('./GetRecord/record', namespaces=_etree.nsmap)
        _counter = {}
        jpcoar_setting2 = HarvestSettings(
            id=10,
            repository_name="jpcoar_test2",
            base_url="http://export.arxiv.org/oai2",
            from_date=datetime(2022, 10, 1),
            until_date=datetime(2022, 10, 2),
            metadata_prefix="jpcoar_1.0",
            index_id=2,
            update_style="1",
            auto_distribution="0"
        )
        with db.session.begin_nested():
            db.session.add(jpcoar_setting2)
        db.session.commit()
        res = process_item(_records[0], jpcoar_setting2, _counter, None)
        assert res==None
    
        ## json_data is none
        _etree = etree.fromstring('<OAI-PMH xmlns="http://www.openarchives.org/OAI/2.0/" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://www.openarchives.org/OAI/2.0/ http://www.openarchives.org/OAI/2.0/OAI-PMH.xsd"><GetRecord><record><header><identifier>oai:weko3.example.org:00000001</identifier><datestamp>2023-02-20T06:24:47Z</datestamp><setSpec>1557819692844:1557819733276</setSpec><setSpec>11</setSpec></header><metadata><jpcoar:jpcoar xmlns:datacite="https://schema.datacite.org/meta/kernel-4/" xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:dcndl="http://ndl.go.jp/dcndl/terms/" xmlns:dcterms="http://purl.org/dc/terms/" xmlns:jpcoar="https://github.com/JPCOAR/schema/blob/master/1.0/" xmlns:oaire="http://namespace.openaire.eu/schema/oaire/" xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#" xmlns:rioxxterms="http://www.rioxx.net/schema/v2.0/rioxxterms/" xmlns:xs="http://www.w3.org/2001/XMLSchema" xmlns="https://github.com/JPCOAR/schema/blob/master/1.0/" xsi:schemaLocation="https://github.com/JPCOAR/schema/blob/master/1.0/jpcoar_scm.xsd"><dc:title xml:lang="ja">test full item</dc:title><dcterms:alternative xml:lang="en">other title</dcterms:alternative><jpcoar:creator><jpcoar:nameIdentifier nameIdentifierURI="https://orcid.org/1234" nameIdentifierScheme="ORCID">1234</jpcoar:nameIdentifier><jpcoar:creatorName xml:lang="ja">テスト, 太郎</jpcoar:creatorName><jpcoar:familyName xml:lang="ja">テスト</jpcoar:familyName><jpcoar:givenName xml:lang="ja">太郎</jpcoar:givenName><jpcoar:creatorAlternative xml:lang="ja">テスト　別郎</jpcoar:creatorAlternative><jpcoar:affiliation><jpcoar:nameIdentifier nameIdentifierURI="http://www.isni.org/isni/5678" nameIdentifierScheme="ISNI">5678</jpcoar:nameIdentifier></jpcoar:affiliation></jpcoar:creator><jpcoar:contributor contributorType="ContactPerson"><jpcoar:nameIdentifier nameIdentifierURI="https://orcid.org/5678" nameIdentifierScheme="ORCID">5678</jpcoar:nameIdentifier><jpcoar:contributorName xml:lang="en">test, smith</jpcoar:contributorName><jpcoar:familyName xml:lang="en">test</jpcoar:familyName><jpcoar:givenName xml:lang="en">smith</jpcoar:givenName><jpcoar:contributorAlternative xml:lang="en">other smith</jpcoar:contributorAlternative><jpcoar:affiliation><jpcoar:nameIdentifier nameIdentifierURI="http://www.isni.org/isni/1234" nameIdentifierScheme="ISNI">1234</jpcoar:nameIdentifier></jpcoar:affiliation></jpcoar:contributor><dcterms:accessRights rdf:resource="http://purl.org/coar/access_right/c_14cb">metadata only access</dcterms:accessRights><rioxxterms:apc>Paid</rioxxterms:apc><dc:rights xml:lang="ja" rdf:resource="テスト権利情報Resource">テスト権利情報</dc:rights><jpcoar:rightsHolder><jpcoar:rightsHolderName xml:lang="ja">テスト　太郎</jpcoar:rightsHolderName></jpcoar:rightsHolder><jpcoar:subject xml:lang="ja" subjectURI="http://bsh.com" subjectScheme="BSH">テスト主題</jpcoar:subject><datacite:description xml:lang="en" descriptionType="Abstract">this is test abstract.</datacite:description><dc:publisher xml:lang="ja">test publisher</dc:publisher><datacite:date dateType="Accepted">2022-10-20</datacite:date><datacite:date dateType="Issued">2022-10-19</datacite:date><dc:language>jpn</dc:language><dc:type rdf:resource="http://purl.org/coar/resource_type/c_2fe3">newspaper</dc:type><datacite:version>1.1</datacite:version><oaire:version rdf:resource="http://purl.org/coar/version/c_b1a7d7d4d402bcce">AO</oaire:version><jpcoar:identifier identifierType="DOI">1111</jpcoar:identifier><jpcoar:identifier identifierType="DOI">https://doi.org/1234/0000000001</jpcoar:identifier><jpcoar:identifier identifierType="URI">https://192.168.56.103/records/1</jpcoar:identifier><jpcoar:identifierRegistration identifierType="JaLC">1234/0000000001</jpcoar:identifierRegistration><jpcoar:relation relationType="isVersionOf"><jpcoar:relatedIdentifier identifierType="ARK">1111111</jpcoar:relatedIdentifier><jpcoar:relatedTitle xml:lang="ja">関連情報テスト</jpcoar:relatedTitle></jpcoar:relation><jpcoar:relation relationType="isVersionOf"><jpcoar:relatedIdentifier identifierType="URI">https://192.168.56.103/records/3</jpcoar:relatedIdentifier></jpcoar:relation><dcterms:temporal xml:lang="ja">1 to 2</dcterms:temporal><datacite:geoLocation><datacite:geoLocationPoint><datacite:pointLongitude>12345</datacite:pointLongitude><datacite:pointLatitude>67890</datacite:pointLatitude></datacite:geoLocationPoint><datacite:geoLocationBox><datacite:westBoundLongitude>123</datacite:westBoundLongitude><datacite:eastBoundLongitude>456</datacite:eastBoundLongitude><datacite:southBoundLatitude>789</datacite:southBoundLatitude><datacite:northBoundLatitude>1112</datacite:northBoundLatitude></datacite:geoLocationBox><datacite:geoLocationPlace>テスト位置情報</datacite:geoLocationPlace></datacite:geoLocation><jpcoar:fundingReference><datacite:funderIdentifier funderIdentifierType="Crossref Funder">22222</datacite:funderIdentifier><jpcoar:funderName xml:lang="ja">テスト助成機関</jpcoar:funderName><datacite:awardNumber awardURI="https://test.research.com">1111</datacite:awardNumber><jpcoar:awardTitle xml:lang="ja">テスト研究</jpcoar:awardTitle></jpcoar:fundingReference><jpcoar:sourceIdentifier identifierType="PISSN">test source Identifier</jpcoar:sourceIdentifier><jpcoar:sourceTitle xml:lang="ja">test collectibles</jpcoar:sourceTitle><jpcoar:sourceTitle xml:lang="ja">test title book</jpcoar:sourceTitle><jpcoar:volume>5</jpcoar:volume><jpcoar:volume>1</jpcoar:volume><jpcoar:issue>2</jpcoar:issue><jpcoar:issue>2</jpcoar:issue><jpcoar:numPages>333</jpcoar:numPages><jpcoar:numPages>555</jpcoar:numPages><jpcoar:pageStart>123</jpcoar:pageStart><jpcoar:pageStart>789</jpcoar:pageStart><jpcoar:pageEnd>456</jpcoar:pageEnd><jpcoar:pageEnd>234</jpcoar:pageEnd><dcndl:dissertationNumber>9999</dcndl:dissertationNumber><dcndl:degreeName xml:lang="ja">テスト学位</dcndl:degreeName><dcndl:dateGranted>2022-10-19</dcndl:dateGranted><jpcoar:degreeGrantor><jpcoar:nameIdentifier nameIdentifierScheme="kakenhi">学位授与機関識別子テスト</jpcoar:nameIdentifier><jpcoar:degreeGrantorName xml:lang="ja">学位授与機関</jpcoar:degreeGrantorName></jpcoar:degreeGrantor><jpcoar:conference><jpcoar:conferenceName xml:lang="ja">テスト会議</jpcoar:conferenceName><jpcoar:conferenceSequence>12345</jpcoar:conferenceSequence><jpcoar:conferenceSponsor xml:lang="ja">テスト機関</jpcoar:conferenceSponsor><jpcoar:conferenceDate endDay="1" endYear="2005" endMonth="12" startDay="11" xml:lang="ja" startYear="2000" startMonth="4">12</jpcoar:conferenceDate><jpcoar:conferenceVenue xml:lang="ja">テスト会場</jpcoar:conferenceVenue><jpcoar:conferenceCountry>JPN</jpcoar:conferenceCountry></jpcoar:conference><jpcoar:file><jpcoar:URI>https://weko3.example.org/record/1/files/test1.txt</jpcoar:URI><jpcoar:mimeType>text/plain</jpcoar:mimeType><jpcoar:extent>18 B</jpcoar:extent><datacite:date dateType="Accepted">2022-10-20</datacite:date><datacite:version>1.0</datacite:version></jpcoar:file><jpcoar:file><jpcoar:URI>https://weko3.example.org/record/1/files/test2</jpcoar:URI><jpcoar:mimeType>application/octet-stream</jpcoar:mimeType><jpcoar:extent>18 B</jpcoar:extent><datacite:version>1.2</datacite:version></jpcoar:file><jpcoar:file><jpcoar:URI>https://weko3.example.org/record/1/files/test3.png</jpcoar:URI><jpcoar:mimeType>image/png</jpcoar:mimeType><jpcoar:extent>18 B</jpcoar:extent><datacite:version>2.1</datacite:version></jpcoar:file></jpcoar:jpcoar></metadata></record></GetRecord></OAI-PMH>')
        _records = _etree.findall('./GetRecord/record', namespaces=_etree.nsmap)
        _counter = {}
        with patch('invenio_oaiharvester.tasks.JPCOARMapper.map', return_value=[]):
            res = process_item(_records[0], harvest_setting[0], _counter, None)
            assert res == None
    
        _etree = etree.fromstring('<OAI-PMH xmlns="http://www.openarchives.org/OAI/2.0/" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://www.openarchives.org/OAI/2.0/ http://www.openarchives.org/OAI/2.0/OAI-PMH.xsd"><GetRecord><record><header><identifier>oai:weko3.example.org:00000001</identifier><datestamp>2023-02-20T06:24:47Z</datestamp><setSpec>1557819692844:1557819733276</setSpec><setSpec>1557820086539</setSpec></header><metadata><jpcoar:jpcoar xmlns:datacite="https://schema.datacite.org/meta/kernel-4/" xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:dcndl="http://ndl.go.jp/dcndl/terms/" xmlns:dcterms="http://purl.org/dc/terms/" xmlns:jpcoar="https://github.com/JPCOAR/schema/blob/master/1.0/" xmlns:oaire="http://namespace.openaire.eu/schema/oaire/" xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#" xmlns:rioxxterms="http://www.rioxx.net/schema/v2.0/rioxxterms/" xmlns:xs="http://www.w3.org/2001/XMLSchema" xmlns="https://github.com/JPCOAR/schema/blob/master/1.0/" xsi:schemaLocation="https://github.com/JPCOAR/schema/blob/master/1.0/jpcoar_scm.xsd"><dc:title xml:lang="ja">test full item</dc:title><dcterms:alternative xml:lang="en">other title</dcterms:alternative><jpcoar:creator><jpcoar:nameIdentifier nameIdentifierURI="https://orcid.org/1234" nameIdentifierScheme="ORCID">1234</jpcoar:nameIdentifier><jpcoar:creatorName xml:lang="ja">テスト, 太郎</jpcoar:creatorName><jpcoar:familyName xml:lang="ja">テスト</jpcoar:familyName><jpcoar:givenName xml:lang="ja">太郎</jpcoar:givenName><jpcoar:creatorAlternative xml:lang="ja">テスト　別郎</jpcoar:creatorAlternative><jpcoar:affiliation><jpcoar:nameIdentifier nameIdentifierURI="http://www.isni.org/isni/5678" nameIdentifierScheme="ISNI">5678</jpcoar:nameIdentifier></jpcoar:affiliation></jpcoar:creator><jpcoar:contributor contributorType="ContactPerson"><jpcoar:nameIdentifier nameIdentifierURI="https://orcid.org/5678" nameIdentifierScheme="ORCID">5678</jpcoar:nameIdentifier><jpcoar:contributorName xml:lang="en">test, smith</jpcoar:contributorName><jpcoar:familyName xml:lang="en">test</jpcoar:familyName><jpcoar:givenName xml:lang="en">smith</jpcoar:givenName><jpcoar:contributorAlternative xml:lang="en">other smith</jpcoar:contributorAlternative><jpcoar:affiliation><jpcoar:nameIdentifier nameIdentifierURI="http://www.isni.org/isni/1234" nameIdentifierScheme="ISNI">1234</jpcoar:nameIdentifier></jpcoar:affiliation></jpcoar:contributor><dcterms:accessRights rdf:resource="http://purl.org/coar/access_right/c_14cb">metadata only access</dcterms:accessRights><rioxxterms:apc>Paid</rioxxterms:apc><dc:rights xml:lang="ja" rdf:resource="テスト権利情報Resource">テスト権利情報</dc:rights><jpcoar:rightsHolder><jpcoar:rightsHolderName xml:lang="ja">テスト　太郎</jpcoar:rightsHolderName></jpcoar:rightsHolder><jpcoar:subject xml:lang="ja" subjectURI="http://bsh.com" subjectScheme="BSH">テスト主題</jpcoar:subject><datacite:description xml:lang="en" descriptionType="Abstract">this is test abstract.</datacite:description><dc:publisher xml:lang="ja">test publisher</dc:publisher><datacite:date dateType="Accepted">2022-10-20</datacite:date><datacite:date dateType="Issued">2022-10-19</datacite:date><dc:language>jpn</dc:language><dc:type rdf:resource="http://purl.org/coar/resource_type/c_2fe3">newspaper</dc:type><datacite:version>1.1</datacite:version><oaire:version rdf:resource="http://purl.org/coar/version/c_b1a7d7d4d402bcce">AO</oaire:version><jpcoar:identifier identifierType="DOI">1111</jpcoar:identifier><jpcoar:identifier identifierType="DOI">https://doi.org/1234/0000000001</jpcoar:identifier><jpcoar:identifier identifierType="URI">https://192.168.56.103/records/1</jpcoar:identifier><jpcoar:identifierRegistration identifierType="JaLC">1234/0000000001</jpcoar:identifierRegistration><jpcoar:relation relationType="isVersionOf"><jpcoar:relatedIdentifier identifierType="ARK">1111111</jpcoar:relatedIdentifier><jpcoar:relatedTitle xml:lang="ja">関連情報テスト</jpcoar:relatedTitle></jpcoar:relation><jpcoar:relation relationType="isVersionOf"><jpcoar:relatedIdentifier identifierType="URI">https://192.168.56.103/records/3</jpcoar:relatedIdentifier></jpcoar:relation><dcterms:temporal xml:lang="ja">1 to 2</dcterms:temporal><datacite:geoLocation><datacite:geoLocationPoint><datacite:pointLongitude>12345</datacite:pointLongitude><datacite:pointLatitude>67890</datacite:pointLatitude></datacite:geoLocationPoint><datacite:geoLocationBox><datacite:westBoundLongitude>123</datacite:westBoundLongitude><datacite:eastBoundLongitude>456</datacite:eastBoundLongitude><datacite:southBoundLatitude>789</datacite:southBoundLatitude><datacite:northBoundLatitude>1112</datacite:northBoundLatitude></datacite:geoLocationBox><datacite:geoLocationPlace>テスト位置情報</datacite:geoLocationPlace></datacite:geoLocation><jpcoar:fundingReference><datacite:funderIdentifier funderIdentifierType="Crossref Funder">22222</datacite:funderIdentifier><jpcoar:funderName xml:lang="ja">テスト助成機関</jpcoar:funderName><datacite:awardNumber awardURI="https://test.research.com">1111</datacite:awardNumber><jpcoar:awardTitle xml:lang="ja">テスト研究</jpcoar:awardTitle></jpcoar:fundingReference><jpcoar:sourceIdentifier identifierType="PISSN">test source Identifier</jpcoar:sourceIdentifier><jpcoar:sourceTitle xml:lang="ja">test collectibles</jpcoar:sourceTitle><jpcoar:sourceTitle xml:lang="ja">test title book</jpcoar:sourceTitle><jpcoar:volume>5</jpcoar:volume><jpcoar:volume>1</jpcoar:volume><jpcoar:issue>2</jpcoar:issue><jpcoar:issue>2</jpcoar:issue><jpcoar:numPages>333</jpcoar:numPages><jpcoar:numPages>555</jpcoar:numPages><jpcoar:pageStart>123</jpcoar:pageStart><jpcoar:pageStart>789</jpcoar:pageStart><jpcoar:pageEnd>456</jpcoar:pageEnd><jpcoar:pageEnd>234</jpcoar:pageEnd><dcndl:dissertationNumber>9999</dcndl:dissertationNumber><dcndl:degreeName xml:lang="ja">テスト学位</dcndl:degreeName><dcndl:dateGranted>2022-10-19</dcndl:dateGranted><jpcoar:degreeGrantor><jpcoar:nameIdentifier nameIdentifierScheme="kakenhi">学位授与機関識別子テスト</jpcoar:nameIdentifier><jpcoar:degreeGrantorName xml:lang="ja">学位授与機関</jpcoar:degreeGrantorName></jpcoar:degreeGrantor><jpcoar:conference><jpcoar:conferenceName xml:lang="ja">テスト会議</jpcoar:conferenceName><jpcoar:conferenceSequence>12345</jpcoar:conferenceSequence><jpcoar:conferenceSponsor xml:lang="ja">テスト機関</jpcoar:conferenceSponsor><jpcoar:conferenceDate endDay="1" endYear="2005" endMonth="12" startDay="11" xml:lang="ja" startYear="2000" startMonth="4">12</jpcoar:conferenceDate><jpcoar:conferenceVenue xml:lang="ja">テスト会場</jpcoar:conferenceVenue><jpcoar:conferenceCountry>JPN</jpcoar:conferenceCountry></jpcoar:conference><jpcoar:file><jpcoar:URI>https://weko3.example.org/record/1/files/test1.txt</jpcoar:URI><jpcoar:mimeType>text/plain</jpcoar:mimeType><jpcoar:extent>18 B</jpcoar:extent><datacite:date dateType="Accepted">2022-10-20</datacite:date><datacite:version>1.0</datacite:version></jpcoar:file><jpcoar:file><jpcoar:URI>https://weko3.example.org/record/1/files/test2</jpcoar:URI><jpcoar:mimeType>application/octet-stream</jpcoar:mimeType><jpcoar:extent>18 B</jpcoar:extent><datacite:version>1.2</datacite:version></jpcoar:file><jpcoar:file><jpcoar:URI>https://weko3.example.org/record/1/files/test3.png</jpcoar:URI><jpcoar:mimeType>image/png</jpcoar:mimeType><jpcoar:extent>18 B</jpcoar:extent><datacite:version>2.1</datacite:version></jpcoar:file></jpcoar:jpcoar></metadata></record></GetRecord></OAI-PMH>')
        _records = _etree.findall('./GetRecord/record', namespaces=_etree.nsmap)
        _counter = {}
        res = process_item(_records[0], harvest_setting[0], _counter, None)
        assert res == None
    
        ## dep.pid.status == deleted
        dep_pid = PersistentIdentifier.query.filter_by(pid_type="depid",pid_value='1').one()
        dep_pid.status = PIDStatus.DELETED
        db.session.merge(dep_pid)
        db.session.commit()
        _etree = etree.fromstring('<OAI-PMH xmlns="http://www.openarchives.org/OAI/2.0/" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://www.openarchives.org/OAI/2.0/ http://www.openarchives.org/OAI/2.0/OAI-PMH.xsd"><GetRecord><record><header><identifier>oai:weko3.example.org:00000001</identifier><datestamp>2023-02-20T06:24:47Z</datestamp><setSpec>1557819692844:1557819733276</setSpec><setSpec>1557820086539</setSpec></header><metadata><jpcoar:jpcoar xmlns:datacite="https://schema.datacite.org/meta/kernel-4/" xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:dcndl="http://ndl.go.jp/dcndl/terms/" xmlns:dcterms="http://purl.org/dc/terms/" xmlns:jpcoar="https://github.com/JPCOAR/schema/blob/master/1.0/" xmlns:oaire="http://namespace.openaire.eu/schema/oaire/" xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#" xmlns:rioxxterms="http://www.rioxx.net/schema/v2.0/rioxxterms/" xmlns:xs="http://www.w3.org/2001/XMLSchema" xmlns="https://github.com/JPCOAR/schema/blob/master/1.0/" xsi:schemaLocation="https://github.com/JPCOAR/schema/blob/master/1.0/jpcoar_scm.xsd"><dc:title xml:lang="ja">test full item</dc:title><dcterms:alternative xml:lang="en">other title</dcterms:alternative><jpcoar:creator><jpcoar:nameIdentifier nameIdentifierURI="https://orcid.org/1234" nameIdentifierScheme="ORCID">1234</jpcoar:nameIdentifier><jpcoar:creatorName xml:lang="ja">テスト, 太郎</jpcoar:creatorName><jpcoar:familyName xml:lang="ja">テスト</jpcoar:familyName><jpcoar:givenName xml:lang="ja">太郎</jpcoar:givenName><jpcoar:creatorAlternative xml:lang="ja">テスト　別郎</jpcoar:creatorAlternative><jpcoar:affiliation><jpcoar:nameIdentifier nameIdentifierURI="http://www.isni.org/isni/5678" nameIdentifierScheme="ISNI">5678</jpcoar:nameIdentifier></jpcoar:affiliation></jpcoar:creator><jpcoar:contributor contributorType="ContactPerson"><jpcoar:nameIdentifier nameIdentifierURI="https://orcid.org/5678" nameIdentifierScheme="ORCID">5678</jpcoar:nameIdentifier><jpcoar:contributorName xml:lang="en">test, smith</jpcoar:contributorName><jpcoar:familyName xml:lang="en">test</jpcoar:familyName><jpcoar:givenName xml:lang="en">smith</jpcoar:givenName><jpcoar:contributorAlternative xml:lang="en">other smith</jpcoar:contributorAlternative><jpcoar:affiliation><jpcoar:nameIdentifier nameIdentifierURI="http://www.isni.org/isni/1234" nameIdentifierScheme="ISNI">1234</jpcoar:nameIdentifier></jpcoar:affiliation></jpcoar:contributor><dcterms:accessRights rdf:resource="http://purl.org/coar/access_right/c_14cb">metadata only access</dcterms:accessRights><rioxxterms:apc>Paid</rioxxterms:apc><dc:rights xml:lang="ja" rdf:resource="テスト権利情報Resource">テスト権利情報</dc:rights><jpcoar:rightsHolder><jpcoar:rightsHolderName xml:lang="ja">テスト　太郎</jpcoar:rightsHolderName></jpcoar:rightsHolder><jpcoar:subject xml:lang="ja" subjectURI="http://bsh.com" subjectScheme="BSH">テスト主題</jpcoar:subject><datacite:description xml:lang="en" descriptionType="Abstract">this is test abstract.</datacite:description><dc:publisher xml:lang="ja">test publisher</dc:publisher><datacite:date dateType="Accepted">2022-10-20</datacite:date><datacite:date dateType="Issued">2022-10-19</datacite:date><dc:language>jpn</dc:language><dc:type rdf:resource="http://purl.org/coar/resource_type/c_2fe3">newspaper</dc:type><datacite:version>1.1</datacite:version><oaire:version rdf:resource="http://purl.org/coar/version/c_b1a7d7d4d402bcce">AO</oaire:version><jpcoar:identifier identifierType="DOI">1111</jpcoar:identifier><jpcoar:identifier identifierType="DOI">https://doi.org/1234/0000000001</jpcoar:identifier><jpcoar:identifier identifierType="URI">https://192.168.56.103/records/1</jpcoar:identifier><jpcoar:identifierRegistration identifierType="JaLC">1234/0000000001</jpcoar:identifierRegistration><jpcoar:relation relationType="isVersionOf"><jpcoar:relatedIdentifier identifierType="ARK">1111111</jpcoar:relatedIdentifier><jpcoar:relatedTitle xml:lang="ja">関連情報テスト</jpcoar:relatedTitle></jpcoar:relation><jpcoar:relation relationType="isVersionOf"><jpcoar:relatedIdentifier identifierType="URI">https://192.168.56.103/records/3</jpcoar:relatedIdentifier></jpcoar:relation><dcterms:temporal xml:lang="ja">1 to 2</dcterms:temporal><datacite:geoLocation><datacite:geoLocationPoint><datacite:pointLongitude>12345</datacite:pointLongitude><datacite:pointLatitude>67890</datacite:pointLatitude></datacite:geoLocationPoint><datacite:geoLocationBox><datacite:westBoundLongitude>123</datacite:westBoundLongitude><datacite:eastBoundLongitude>456</datacite:eastBoundLongitude><datacite:southBoundLatitude>789</datacite:southBoundLatitude><datacite:northBoundLatitude>1112</datacite:northBoundLatitude></datacite:geoLocationBox><datacite:geoLocationPlace>テスト位置情報</datacite:geoLocationPlace></datacite:geoLocation><jpcoar:fundingReference><datacite:funderIdentifier funderIdentifierType="Crossref Funder">22222</datacite:funderIdentifier><jpcoar:funderName xml:lang="ja">テスト助成機関</jpcoar:funderName><datacite:awardNumber awardURI="https://test.research.com">1111</datacite:awardNumber><jpcoar:awardTitle xml:lang="ja">テスト研究</jpcoar:awardTitle></jpcoar:fundingReference><jpcoar:sourceIdentifier identifierType="PISSN">test source Identifier</jpcoar:sourceIdentifier><jpcoar:sourceTitle xml:lang="ja">test collectibles</jpcoar:sourceTitle><jpcoar:sourceTitle xml:lang="ja">test title book</jpcoar:sourceTitle><jpcoar:volume>5</jpcoar:volume><jpcoar:volume>1</jpcoar:volume><jpcoar:issue>2</jpcoar:issue><jpcoar:issue>2</jpcoar:issue><jpcoar:numPages>333</jpcoar:numPages><jpcoar:numPages>555</jpcoar:numPages><jpcoar:pageStart>123</jpcoar:pageStart><jpcoar:pageStart>789</jpcoar:pageStart><jpcoar:pageEnd>456</jpcoar:pageEnd><jpcoar:pageEnd>234</jpcoar:pageEnd><dcndl:dissertationNumber>9999</dcndl:dissertationNumber><dcndl:degreeName xml:lang="ja">テスト学位</dcndl:degreeName><dcndl:dateGranted>2022-10-19</dcndl:dateGranted><jpcoar:degreeGrantor><jpcoar:nameIdentifier nameIdentifierScheme="kakenhi">学位授与機関識別子テスト</jpcoar:nameIdentifier><jpcoar:degreeGrantorName xml:lang="ja">学位授与機関</jpcoar:degreeGrantorName></jpcoar:degreeGrantor><jpcoar:conference><jpcoar:conferenceName xml:lang="ja">テスト会議</jpcoar:conferenceName><jpcoar:conferenceSequence>12345</jpcoar:conferenceSequence><jpcoar:conferenceSponsor xml:lang="ja">テスト機関</jpcoar:conferenceSponsor><jpcoar:conferenceDate endDay="1" endYear="2005" endMonth="12" startDay="11" xml:lang="ja" startYear="2000" startMonth="4">12</jpcoar:conferenceDate><jpcoar:conferenceVenue xml:lang="ja">テスト会場</jpcoar:conferenceVenue><jpcoar:conferenceCountry>JPN</jpcoar:conferenceCountry></jpcoar:conference><jpcoar:file><jpcoar:URI>https://weko3.example.org/record/1/files/test1.txt</jpcoar:URI><jpcoar:mimeType>text/plain</jpcoar:mimeType><jpcoar:extent>18 B</jpcoar:extent><datacite:date dateType="Accepted">2022-10-20</datacite:date><datacite:version>1.0</datacite:version></jpcoar:file><jpcoar:file><jpcoar:URI>https://weko3.example.org/record/1/files/test2</jpcoar:URI><jpcoar:mimeType>application/octet-stream</jpcoar:mimeType><jpcoar:extent>18 B</jpcoar:extent><datacite:version>1.2</datacite:version></jpcoar:file><jpcoar:file><jpcoar:URI>https://weko3.example.org/record/1/files/test3.png</jpcoar:URI><jpcoar:mimeType>image/png</jpcoar:mimeType><jpcoar:extent>18 B</jpcoar:extent><datacite:version>2.1</datacite:version></jpcoar:file></jpcoar:jpcoar></metadata></record></GetRecord></OAI-PMH>')
        _records = _etree.findall('./GetRecord/record', namespaces=_etree.nsmap)
        _counter = {}
        res = process_item(_records[0], harvest_setting[0], _counter, None)
        assert res == None
    
        ## new harvest
        _etree = etree.fromstring('<OAI-PMH xmlns="http://www.openarchives.org/OAI/2.0/" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://www.openarchives.org/OAI/2.0/ http://www.openarchives.org/OAI/2.0/OAI-PMH.xsd"><GetRecord><record><header><identifier>oai:weko3.example.org:00000002</identifier><datestamp>2023-02-20T06:24:47Z</datestamp><setSpec>1557819692844:1557819733276</setSpec><setSpec>1557820086539</setSpec></header><metadata><jpcoar:jpcoar xmlns:datacite="https://schema.datacite.org/meta/kernel-4/" xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:dcndl="http://ndl.go.jp/dcndl/terms/" xmlns:dcterms="http://purl.org/dc/terms/" xmlns:jpcoar="https://github.com/JPCOAR/schema/blob/master/1.0/" xmlns:oaire="http://namespace.openaire.eu/schema/oaire/" xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#" xmlns:rioxxterms="http://www.rioxx.net/schema/v2.0/rioxxterms/" xmlns:xs="http://www.w3.org/2001/XMLSchema" xmlns="https://github.com/JPCOAR/schema/blob/master/1.0/" xsi:schemaLocation="https://github.com/JPCOAR/schema/blob/master/1.0/jpcoar_scm.xsd"><dc:title xml:lang="ja">test full item</dc:title><dcterms:alternative xml:lang="en">other title</dcterms:alternative><jpcoar:creator><jpcoar:nameIdentifier nameIdentifierURI="https://orcid.org/1234" nameIdentifierScheme="ORCID">1234</jpcoar:nameIdentifier><jpcoar:creatorName xml:lang="ja">テスト, 太郎</jpcoar:creatorName><jpcoar:familyName xml:lang="ja">テスト</jpcoar:familyName><jpcoar:givenName xml:lang="ja">太郎</jpcoar:givenName><jpcoar:creatorAlternative xml:lang="ja">テスト　別郎</jpcoar:creatorAlternative><jpcoar:affiliation><jpcoar:nameIdentifier nameIdentifierURI="http://www.isni.org/isni/5678" nameIdentifierScheme="ISNI">5678</jpcoar:nameIdentifier></jpcoar:affiliation></jpcoar:creator><jpcoar:contributor contributorType="ContactPerson"><jpcoar:nameIdentifier nameIdentifierURI="https://orcid.org/5678" nameIdentifierScheme="ORCID">5678</jpcoar:nameIdentifier><jpcoar:contributorName xml:lang="en">test, smith</jpcoar:contributorName><jpcoar:familyName xml:lang="en">test</jpcoar:familyName><jpcoar:givenName xml:lang="en">smith</jpcoar:givenName><jpcoar:contributorAlternative xml:lang="en">other smith</jpcoar:contributorAlternative><jpcoar:affiliation><jpcoar:nameIdentifier nameIdentifierURI="http://www.isni.org/isni/1234" nameIdentifierScheme="ISNI">1234</jpcoar:nameIdentifier></jpcoar:affiliation></jpcoar:contributor><dcterms:accessRights rdf:resource="http://purl.org/coar/access_right/c_14cb">metadata only access</dcterms:accessRights><rioxxterms:apc>Paid</rioxxterms:apc><dc:rights xml:lang="ja" rdf:resource="テスト権利情報Resource">テスト権利情報</dc:rights><jpcoar:rightsHolder><jpcoar:rightsHolderName xml:lang="ja">テスト　太郎</jpcoar:rightsHolderName></jpcoar:rightsHolder><jpcoar:subject xml:lang="ja" subjectURI="http://bsh.com" subjectScheme="BSH">テスト主題</jpcoar:subject><datacite:description xml:lang="en" descriptionType="Abstract">this is test abstract.</datacite:description><dc:publisher xml:lang="ja">test publisher</dc:publisher><datacite:date dateType="Accepted">2022-10-20</datacite:date><datacite:date dateType="Issued">2022-10-19</datacite:date><dc:language>jpn</dc:language><dc:type rdf:resource="http://purl.org/coar/resource_type/c_2fe3">newspaper</dc:type><datacite:version>1.1</datacite:version><oaire:version rdf:resource="http://purl.org/coar/version/c_b1a7d7d4d402bcce">AO</oaire:version><jpcoar:identifier identifierType="DOI">1111</jpcoar:identifier><jpcoar:identifier identifierType="DOI">https://doi.org/1234/0000000001</jpcoar:identifier><jpcoar:identifier identifierType="URI">https://192.168.56.103/records/1</jpcoar:identifier><jpcoar:identifierRegistration identifierType="JaLC">1234/0000000001</jpcoar:identifierRegistration><jpcoar:relation relationType="isVersionOf"><jpcoar:relatedIdentifier identifierType="ARK">1111111</jpcoar:relatedIdentifier><jpcoar:relatedTitle xml:lang="ja">関連情報テスト</jpcoar:relatedTitle></jpcoar:relation><jpcoar:relation relationType="isVersionOf"><jpcoar:relatedIdentifier identifierType="URI">https://192.168.56.103/records/3</jpcoar:relatedIdentifier></jpcoar:relation><dcterms:temporal xml:lang="ja">1 to 2</dcterms:temporal><datacite:geoLocation><datacite:geoLocationPoint><datacite:pointLongitude>12345</datacite:pointLongitude><datacite:pointLatitude>67890</datacite:pointLatitude></datacite:geoLocationPoint><datacite:geoLocationBox><datacite:westBoundLongitude>123</datacite:westBoundLongitude><datacite:eastBoundLongitude>456</datacite:eastBoundLongitude><datacite:southBoundLatitude>789</datacite:southBoundLatitude><datacite:northBoundLatitude>1112</datacite:northBoundLatitude></datacite:geoLocationBox><datacite:geoLocationPlace>テスト位置情報</datacite:geoLocationPlace></datacite:geoLocation><jpcoar:fundingReference><datacite:funderIdentifier funderIdentifierType="Crossref Funder">22222</datacite:funderIdentifier><jpcoar:funderName xml:lang="ja">テスト助成機関</jpcoar:funderName><datacite:awardNumber awardURI="https://test.research.com">1111</datacite:awardNumber><jpcoar:awardTitle xml:lang="ja">テスト研究</jpcoar:awardTitle></jpcoar:fundingReference><jpcoar:sourceIdentifier identifierType="PISSN">test source Identifier</jpcoar:sourceIdentifier><jpcoar:sourceTitle xml:lang="ja">test collectibles</jpcoar:sourceTitle><jpcoar:sourceTitle xml:lang="ja">test title book</jpcoar:sourceTitle><jpcoar:volume>5</jpcoar:volume><jpcoar:volume>1</jpcoar:volume><jpcoar:issue>2</jpcoar:issue><jpcoar:issue>2</jpcoar:issue><jpcoar:numPages>333</jpcoar:numPages><jpcoar:numPages>555</jpcoar:numPages><jpcoar:pageStart>123</jpcoar:pageStart><jpcoar:pageStart>789</jpcoar:pageStart><jpcoar:pageEnd>456</jpcoar:pageEnd><jpcoar:pageEnd>234</jpcoar:pageEnd><dcndl:dissertationNumber>9999</dcndl:dissertationNumber><dcndl:degreeName xml:lang="ja">テスト学位</dcndl:degreeName><dcndl:dateGranted>2022-10-19</dcndl:dateGranted><jpcoar:degreeGrantor><jpcoar:nameIdentifier nameIdentifierScheme="kakenhi">学位授与機関識別子テスト</jpcoar:nameIdentifier><jpcoar:degreeGrantorName xml:lang="ja">学位授与機関</jpcoar:degreeGrantorName></jpcoar:degreeGrantor><jpcoar:conference><jpcoar:conferenceName xml:lang="ja">テスト会議</jpcoar:conferenceName><jpcoar:conferenceSequence>12345</jpcoar:conferenceSequence><jpcoar:conferenceSponsor xml:lang="ja">テスト機関</jpcoar:conferenceSponsor><jpcoar:conferenceDate endDay="1" endYear="2005" endMonth="12" startDay="11" xml:lang="ja" startYear="2000" startMonth="4">12</jpcoar:conferenceDate><jpcoar:conferenceVenue xml:lang="ja">テスト会場</jpcoar:conferenceVenue><jpcoar:conferenceCountry>JPN</jpcoar:conferenceCountry></jpcoar:conference><jpcoar:file><jpcoar:URI>https://weko3.example.org/record/1/files/test1.txt</jpcoar:URI><jpcoar:mimeType>text/plain</jpcoar:mimeType><jpcoar:extent>18 B</jpcoar:extent><datacite:date dateType="Accepted">2022-10-20</datacite:date><datacite:version>1.0</datacite:version></jpcoar:file><jpcoar:file><jpcoar:URI>https://weko3.example.org/record/1/files/test2</jpcoar:URI><jpcoar:mimeType>application/octet-stream</jpcoar:mimeType><jpcoar:extent>18 B</jpcoar:extent><datacite:version>1.2</datacite:version></jpcoar:file><jpcoar:file><jpcoar:URI>https://weko3.example.org/record/1/files/test3.png</jpcoar:URI><jpcoar:mimeType>image/png</jpcoar:mimeType><jpcoar:extent>18 B</jpcoar:extent><datacite:version>2.1</datacite:version></jpcoar:file></jpcoar:jpcoar></metadata></record></GetRecord></OAI-PMH>')
        _records = _etree.findall('./GetRecord/record', namespaces=_etree.nsmap)
        _counter = {}
        res = process_item(_records[0], harvest_setting[0], _counter, None)
        assert res == None
    
    
        # ddi
        ## item_1593074267803 not in json_data
        ##_etree = etree.fromstring('<OAI-PMH xmlns="http://www.openarchives.org/OAI/2.0/" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://www.openarchives.org/OAI/2.0/ http://www.openarchives.org/OAI/2.0/OAI-PMH.xsd"><responseDate>2022-11-01T07:24:43Z</responseDate><request verb="GetRecord" metadataPrefix="ddi" identifier="oai:invenio:00000002">https://data.lib.keio.ac.jp/oai</request><GetRecord><record><header><identifier>oai:invenio:00000002</identifier><datestamp>2021-06-24T14:23:51Z</datestamp></header><metadata><codeBook xmlns:dc="http://purl.org/dc/terms/" xmlns:fn="http://www.w3.org/2005/xpath-functions" xmlns:saxon="http://xml.apache.org/xslt" xmlns:xhtml="http://www.w3.org/1999/xhtml" xmlns:xs="http://www.w3.org/2001/XMLSchema" xmlns="ddi:codebook:2_5" xsi:schemaLocation="https://ddialliance.org/Specification/DDI-Codebook/2.5/XMLSchema/codebook.xsd"><stdyDscr><citation xml:lang="en"><titlStmt><titl xml:lang="en">Japanese Panel Survey of Consumers: 1994</titl><altTitl xml:lang="en">JPSC</altTitl><IDNo>JPSC2</IDNo></titlStmt><rspStmt><AuthEnty xml:lang="en">Institute for Research on Household ECONOMICS</AuthEnty></rspStmt><prodStmt><producer xml:lang="en">Panel Data Research Center at Keio University</producer><copyright xml:lang="en">Before your application, you need to agree with our written pledge (e.g. the data will be only use for research purpose, will not be provided any third party etc).</copyright></prodStmt><distStmt><distrbtr xml:lang="en">Panel Data Research Center at Keio University</distrbtr></distStmt><serStmt><serName xml:lang="en">Japanese Panel Survey of Consumers(JPSC) Series</serName></serStmt><verStmt><notes>jpn</notes><notes>eng</notes></verStmt><biblCit xml:lang="en">Publications in academic journals, academic societies, and media articles based on analysis of data provided by the PDRC must be credited to the Panel Data Research Center at Keio University.\n\n(Example)\nThe data for this analysis, Japanese Panel Survey of Consumers (JPSC), was provided by the Keio University Panel Data Research Center.</biblCit><holdings URI="https://data.lib.keio.ac.jp/records/2"/></citation><citation xml:lang="ja"><titlStmt><titl xml:lang="ja">消費生活に関するパネル調査 (JPSC) 1994</titl><altTitl xml:lang="ja">JPSC</altTitl><IDNo>JPSC2</IDNo></titlStmt><rspStmt><AuthEnty xml:lang="ja">家計経済研究所</AuthEnty></rspStmt><prodStmt><producer xml:lang="ja">慶應義塾大学パネルデータ設計・解析センター</producer><copyright xml:lang="ja">詳しくは、データ申請時に表示される誓約書を確認してください。</copyright></prodStmt><distStmt><distrbtr xml:lang="ja">慶應義塾大学パネルデータ設計・解析センター</distrbtr></distStmt><serStmt><serName xml:lang="ja">消費生活に関するパネル調査(JPSC)シリーズ</serName></serStmt><verStmt><notes>jpn</notes><notes>eng</notes></verStmt><biblCit xml:lang="ja">学術誌あるいは学会等で分析結果を発表する際は、慶應義塾大学パネルデータ設計・解析センターから各データの個票データの提供を受けた旨を必ず明記して下さい。\n\n例: 本稿の分析に際しては、慶應義塾大学パネルデータ設計・解析センターによる「消費生活に関するパネル調査(JPSC)」の個票データの提供を受けた。\n\nThe data for this analysis, Japanese Panel Survey of Consumers (JPSC), was provided by the Keio University Panel Data Research Center.</biblCit><holdings URI="https://data.lib.keio.ac.jp/records/2"/></citation><stdyInfo xml:lang="en"><subject><topcClas vocab="CESSDA Topic Classification" vocabURI="https://vocabularies.cessda.eu/urn/urn:ddi:int.cessda.cv:TopicClassification" xml:lang="en">ECONOMICS</topcClas><topcClas vocab="CESSDA Topic Classification" vocabURI="https://vocabularies.cessda.eu/urn/urn:ddi:int.cessda.cv:TopicClassification" xml:lang="en">Income, property and investment/saving</topcClas><topcClas vocab="CESSDA Topic Classification" vocabURI="https://vocabularies.cessda.eu/urn/urn:ddi:int.cessda.cv:TopicClassification" xml:lang="en">HEALTH</topcClas><topcClas vocab="CESSDA Topic Classification" vocabURI="https://vocabularies.cessda.eu/urn/urn:ddi:int.cessda.cv:TopicClassification" xml:lang="en">Drug abuse, alcohol and smoking</topcClas><topcClas vocab="CESSDA Topic Classification" vocabURI="https://vocabularies.cessda.eu/urn/urn:ddi:int.cessda.cv:TopicClassification" xml:lang="en">General health and well-being</topcClas><topcClas vocab="CESSDA Topic Classification" vocabURI="https://vocabularies.cessda.eu/urn/urn:ddi:int.cessda.cv:TopicClassification" xml:lang="en">Reproductive health</topcClas><topcClas vocab="CESSDA Topic Classification" vocabURI="https://vocabularies.cessda.eu/urn/urn:ddi:int.cessda.cv:TopicClassification" xml:lang="en">HOUSING AND LAND USE</topcClas><topcClas vocab="CESSDA Topic Classification" vocabURI="https://vocabularies.cessda.eu/urn/urn:ddi:int.cessda.cv:TopicClassification" xml:lang="en">Housing</topcClas><topcClas vocab="CESSDA Topic Classification" vocabURI="https://vocabularies.cessda.eu/urn/urn:ddi:int.cessda.cv:TopicClassification" xml:lang="en">LABOUR AND EMPLOYMENT</topcClas><topcClas vocab="CESSDA Topic Classification" vocabURI="https://vocabularies.cessda.eu/urn/urn:ddi:int.cessda.cv:TopicClassification" xml:lang="en">Employment</topcClas><topcClas vocab="CESSDA Topic Classification" vocabURI="https://vocabularies.cessda.eu/urn/urn:ddi:int.cessda.cv:TopicClassification" xml:lang="en">Working conditions</topcClas><topcClas vocab="CESSDA Topic Classification" vocabURI="https://vocabularies.cessda.eu/urn/urn:ddi:int.cessda.cv:TopicClassification" xml:lang="en">SOCIAL STRATIFICATION AND GROUPINGS</topcClas><topcClas vocab="CESSDA Topic Classification" vocabURI="https://vocabularies.cessda.eu/urn/urn:ddi:int.cessda.cv:TopicClassification" xml:lang="en">Family life and marriage</topcClas><topcClas vocab="CESSDA Topic Classification" vocabURI="https://vocabularies.cessda.eu/urn/urn:ddi:int.cessda.cv:TopicClassification" xml:lang="en">Gender and gender roles</topcClas><topcClas vocab="CESSDA Topic Classification" vocabURI="https://vocabularies.cessda.eu/urn/urn:ddi:int.cessda.cv:TopicClassification" xml:lang="en">Social and occupational mobility</topcClas><topcClas vocab="CESSDA Topic Classification" vocabURI="https://vocabularies.cessda.eu/urn/urn:ddi:int.cessda.cv:TopicClassification" xml:lang="en">SOCIETY AND CULTURE</topcClas><topcClas vocab="CESSDA Topic Classification" vocabURI="https://vocabularies.cessda.eu/urn/urn:ddi:int.cessda.cv:TopicClassification" xml:lang="en">Time use</topcClas></subject><abstract xml:lang="en">The JPSC started in 1993 with a sample of 1,500 young woman (aged from 24 to 34 years) and their spouses. The objective was to examine the lifestyles of relatively young woman from a wide spectrum of factors, including income, expenditure, savings, work patterns, and family relationships. Since then, the survey has been conducted annually and expanded to include new cohorts in 1997 (500 respondents), 2003 (836 respondents), 2008 (636 respondents), and 2013 (672 respondents).</abstract><sumDscr><timePrd event="start">1993</timePrd><timePrd event="end">1994</timePrd><collDate>1994</collDate><geogCover xml:lang="en">Japan</geogCover><anlyUnit xml:lang="en">Individual</anlyUnit><anlyUnit xml:lang="en">Family</anlyUnit><anlyUnit xml:lang="en">Family: Household family</anlyUnit><anlyUnit xml:lang="en">Household</anlyUnit><universe xml:lang="en">Japanese female over 24</universe><dataKind xml:lang="en">quantitative research: micro data</dataKind></sumDscr></stdyInfo><stdyInfo xml:lang="ja"><subject><topcClas vocab="CESSDA Topic Classification" vocabURI="https://vocabularies.cessda.eu/urn/urn:ddi:int.cessda.cv:TopicClassification" xml:lang="ja">経済</topcClas><topcClas vocab="CESSDA Topic Classification" vocabURI="https://vocabularies.cessda.eu/urn/urn:ddi:int.cessda.cv:TopicClassification" xml:lang="ja">所得、財産、投資・貯蓄</topcClas><topcClas vocab="CESSDA Topic Classification" vocabURI="https://vocabularies.cessda.eu/urn/urn:ddi:int.cessda.cv:TopicClassification" xml:lang="ja">健康</topcClas><topcClas vocab="CESSDA Topic Classification" vocabURI="https://vocabularies.cessda.eu/urn/urn:ddi:int.cessda.cv:TopicClassification" xml:lang="ja">薬物乱用、アルコール、喫煙</topcClas><topcClas vocab="CESSDA Topic Classification" vocabURI="https://vocabularies.cessda.eu/urn/urn:ddi:int.cessda.cv:TopicClassification" xml:lang="ja">健康一般とウェルビーイング</topcClas><topcClas vocab="CESSDA Topic Classification" vocabURI="https://vocabularies.cessda.eu/urn/urn:ddi:int.cessda.cv:TopicClassification" xml:lang="ja">リプロダクティブヘルス</topcClas><topcClas vocab="CESSDA Topic Classification" vocabURI="https://vocabularies.cessda.eu/urn/urn:ddi:int.cessda.cv:TopicClassification" xml:lang="ja">住宅と土地利用</topcClas><topcClas vocab="CESSDA Topic Classification" vocabURI="https://vocabularies.cessda.eu/urn/urn:ddi:int.cessda.cv:TopicClassification" xml:lang="ja">住宅</topcClas><topcClas vocab="CESSDA Topic Classification" vocabURI="https://vocabularies.cessda.eu/urn/urn:ddi:int.cessda.cv:TopicClassification" xml:lang="ja">労働と雇用</topcClas><topcClas vocab="CESSDA Topic Classification" vocabURI="https://vocabularies.cessda.eu/urn/urn:ddi:int.cessda.cv:TopicClassification" xml:lang="ja">雇用</topcClas><topcClas vocab="CESSDA Topic Classification" vocabURI="https://vocabularies.cessda.eu/urn/urn:ddi:int.cessda.cv:TopicClassification" xml:lang="ja">労働条件</topcClas><topcClas vocab="CESSDA Topic Classification" vocabURI="https://vocabularies.cessda.eu/urn/urn:ddi:int.cessda.cv:TopicClassification" xml:lang="ja">社会階層と社会集団</topcClas><topcClas vocab="CESSDA Topic Classification" vocabURI="https://vocabularies.cessda.eu/urn/urn:ddi:int.cessda.cv:TopicClassification" xml:lang="ja">家族生活と結婚</topcClas><topcClas vocab="CESSDA Topic Classification" vocabURI="https://vocabularies.cessda.eu/urn/urn:ddi:int.cessda.cv:TopicClassification" xml:lang="ja">ジェンダーと性別役割</topcClas><topcClas vocab="CESSDA Topic Classification" vocabURI="https://vocabularies.cessda.eu/urn/urn:ddi:int.cessda.cv:TopicClassification" xml:lang="ja">社会移動と職業移動</topcClas><topcClas vocab="CESSDA Topic Classification" vocabURI="https://vocabularies.cessda.eu/urn/urn:ddi:int.cessda.cv:TopicClassification" xml:lang="ja">社会と文化</topcClas><topcClas vocab="CESSDA Topic Classification" vocabURI="https://vocabularies.cessda.eu/urn/urn:ddi:int.cessda.cv:TopicClassification" xml:lang="ja">生活時間</topcClas></subject><abstract xml:lang="ja">1993年に当時24歳から34歳の女性1,500名とその配偶者を対象に、若年女性の生活実態を、収入・支出・貯蓄、就業行動、家族関係などの諸側面から明らかにすることを目的としています。1997年(500名)、2003年(836名)、2008年(636名)、2013年(672名)に新規調査対象者が追加され、現在まで調査が続いています。</abstract><sumDscr><timePrd event="start">1993</timePrd><timePrd event="end">1994</timePrd><collDate>1994</collDate><geogCover xml:lang="ja">日本</geogCover><anlyUnit xml:lang="ja">個人</anlyUnit><anlyUnit xml:lang="ja">家族</anlyUnit><anlyUnit xml:lang="ja">家族: 世帯家族</anlyUnit><anlyUnit xml:lang="ja">世帯</anlyUnit><universe xml:lang="ja">日本の24歳以上の女性</universe><dataKind xml:lang="ja">量的調査: ミクロデータ</dataKind></sumDscr></stdyInfo><method xml:lang="en"><dataColl><sampProc xml:lang="en">Mixed probability and non-probability</sampProc><collMode xml:lang="en">Self-administered questionnaire</collMode></dataColl></method><method xml:lang="ja"><dataColl><sampProc xml:lang="ja">混合確率と非確率</sampProc><collMode xml:lang="ja">自記式調査票</collMode></dataColl></method><dataAccs xml:lang="en"><setAvail><accsPlac>https://www.pdrc.keio.ac.jp/pdrc/</accsPlac><avlStatus xml:lang="en">restricted access</avlStatus></setAvail></dataAccs><dataAccs xml:lang="ja"><setAvail><accsPlac>https://www.pdrc.keio.ac.jp/pdrc/</accsPlac><avlStatus xml:lang="ja">制約付きアクセス</avlStatus></setAvail></dataAccs><othrStdyMat><relStdy ID="https://www.pdrc.keio.ac.jp/en/paneldata/datasets/"/><relPubl ID="https://www.pdrc.keio.ac.jp/jpsc/bunken/result-1994/"/></othrStdyMat></stdyDscr></codeBook></metadata></record></GetRecord></OAI-PMH>')
        _etree = etree.fromstring('<OAI-PMH xmlns="http://www.openarchives.org/OAI/2.0/" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://www.openarchives.org/OAI/2.0/ http://www.openarchives.org/OAI/2.0/OAI-PMH.xsd"><responseDate>2023-03-02T04:08:53Z</responseDate><request metadataPrefix="ddi" verb="GetRecord" identifier="oai:weko3.example.org:00000075">https://192.168.56.103/oai</request><GetRecord><record><header><identifier>oai:weko3.example.org:00000075</identifier><datestamp>2023-03-02T04:06:46Z</datestamp><setSpec>1557820086539</setSpec></header><metadata><codeBook xmlns:dc="http://purl.org/dc/terms/" xmlns:fn="http://www.w3.org/2005/xpath-functions" xmlns:saxon="http://xml.apache.org/xslt" xmlns:xhtml="http://www.w3.org/1999/xhtml" xmlns:xs="http://www.w3.org/2001/XMLSchema" xmlns="ddi:codebook:2_5" xsi:schemaLocation="https://ddialliance.org/Specification/DDI-Codebook/2.5/XMLSchema/codebook.xsd"><stdyDscr><citation xml:lang="ja"><titlStmt><titl xml:lang="ja">test ddi full item</titl><altTitl xml:lang="ja">other ddi title</altTitl><IDNo agency="test_id_agency" xml:lang="ja">test_study_id</IDNo></titlStmt><prodStmt><producer xml:lang="ja">test_publisher</producer><copyright xml:lang="ja">test_rights</copyright><fundAg ID="test_found_ageny" xml:lang="ja">test_founder_name</fundAg><grantNo>test_grant_no</grantNo></prodStmt><distStmt><distrbtr URI="https://test.distributor.affiliation" abbr="TDN" xml:lang="ja" affiliation="Test Distributor Affiliation">Test Distributor Name</distrbtr></distStmt><serStmt><serName xml:lang="ja">test_series</serName></serStmt><verStmt><version date="2023-03-07" xml:lang="ja">1.2</version></verStmt><biblCit xml:lang="ja">test.input.content</biblCit><holdings URI="https://192.168.56.103/records/75" /></citation><stdyInfo xml:lang="ja"><subject><topcClas vocab="test_topic_vocab" vocabURI="http://test.topic.vocab" xml:lang="ja">Test Topic</topcClas><topcClas vocab="CESSDA Topic Classification" vocabURI="https://vocabularies.cessda.eu/urn/urn:ddi:int.cessda.cv:TopicClassification" xml:lang="ja">人口</topcClas></subject><sumDscr><timePrd event="start">2023-03-01</timePrd><timePrd event="end">2023-03-03</timePrd><collDate event="start">2023-03-01</collDate><collDate event="end">2023-03-06</collDate><geogCover xml:lang="ja">test_geographic_coverage</geogCover><anlyUnit xml:lang="ja">個人</anlyUnit><universe xml:lang="ja">test parent set</universe><dataKind xml:lang="ja">量的調査</dataKind></sumDscr></stdyInfo><stdyInfo xml:lang="en"><subject><topcClas vocab="CESSDA Topic Classification" vocabURI="https://vocabularies.cessda.eu/urn/urn:ddi:int.cessda.cv:TopicClassification" xml:lang="en">Demography</topcClas></subject><abstract xml:lang="en">this is description for ddi item. this is description for ddi item.</abstract><sumDscr><timePrd event="start">2023-03-01</timePrd><timePrd event="end">2023-03-03</timePrd><collDate event="start">2023-03-01</collDate><collDate event="end">2023-03-06</collDate><anlyUnit xml:lang="en">test_unit_of_analysis</anlyUnit><anlyUnit xml:lang="en">Individual</anlyUnit><dataKind xml:lang="en">quantatitive research</dataKind></sumDscr></stdyInfo><method xml:lang="ja"><dataColl><sampProc xml:lang="ja">test sampling procedure</sampProc><sampProc xml:lang="ja">母集団/ 全数調査</sampProc><collMode xml:lang="ja">test collection method</collMode><collMode xml:lang="ja">インタビュー</collMode></dataColl><anlyInfo><respRate xml:lang="ja">test sampling procedure_sampling_rate</respRate></anlyInfo></method><method xml:lang="en"><dataColl><sampProc xml:lang="en">Total universe/Complete enumeration</sampProc><collMode xml:lang="en">Interview</collMode></dataColl><anlyInfo /></method><dataAccs xml:lang="jp"><setAvail><avlStatus xml:lang="jp">オープンアクセス</avlStatus></setAvail><notes>jpn</notes></dataAccs><dataAccs xml:lang="en"><setAvail><avlStatus xml:lang="en">open access</avlStatus></setAvail><notes>jpn</notes></dataAccs><othrStdyMat xml:lang="ja"><relStdy ID="test_related_study_identifier" xml:lang="ja">test_related_study_title</relStdy><relPubl ID="test_related_publication_identifier" xml:lang="ja">test_related_publication_title</relPubl></othrStdyMat></stdyDscr></codeBook></metadata></record></GetRecord></OAI-PMH>')
        _records = _etree.findall('./GetRecord/record', namespaces=_etree.nsmap)
        _counter = {}
>       res = process_item(_records[0], harvest_setting[1], _counter, None)

tests/test_tasks.py:272: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
invenio_oaiharvester/tasks.py:318: in process_item
    first_ver.publish()
../weko-deposit/weko_deposit/api.py:677: in publish
    deposit = self.publish_without_commit(pid, id_)
../weko-deposit/weko_deposit/api.py:717: in publish_without_commit
    self.indexer.update_relation_version_is_last(relations_ver)
../weko-deposit/weko_deposit/api.py:203: in update_relation_version_is_last
    body=body, ignore=[400, 404]
.tox/c1/lib/python3.6/site-packages/elasticsearch/client/utils.py:76: in _wrapped
    return func(*args, params=params, **kwargs)
.tox/c1/lib/python3.6/site-packages/elasticsearch/client/__init__.py:528: in update
    doc_type, id, '_update'), params=params, body=body)
.tox/c1/lib/python3.6/site-packages/elasticsearch/transport.py:314: in perform_request
    status, headers_response, data = connection.perform_request(method, url, params, body, headers=headers, ignore=ignore, timeout=timeout)
.tox/c1/lib/python3.6/site-packages/elasticsearch/connection/http_requests.py:90: in perform_request
    self._raise_error(response.status_code, raw_data)
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = <RequestsHttpConnection: http://elasticsearch:9200>, status_code = 403
raw_data = '{"error":{"root_cause":[{"type":"cluster_block_exception","reason":"blocked by: [FORBIDDEN/12/index read-only / allow...":"cluster_block_exception","reason":"blocked by: [FORBIDDEN/12/index read-only / allow delete (api)];"},"status":403}'

    def _raise_error(self, status_code, raw_data):
        """ Locate appropriate exception and raise it. """
        error_message = raw_data
        additional_info = None
        try:
            if raw_data:
                additional_info = json.loads(raw_data)
                error_message = additional_info.get('error', error_message)
                if isinstance(error_message, dict) and 'type' in error_message:
                    error_message = error_message['type']
        except (ValueError, TypeError) as err:
            logger.warning('Undecodable raw error response from server: %s', err)
    
>       raise HTTP_EXCEPTIONS.get(status_code, TransportError)(status_code, error_message, additional_info)
E       elasticsearch.exceptions.AuthorizationException: TransportError(403, 'cluster_block_exception', 'blocked by: [FORBIDDEN/12/index read-only / allow delete (api)];')

.tox/c1/lib/python3.6/site-packages/elasticsearch/connection/base.py:125: AuthorizationException
------------------------------ Captured log setup ------------------------------
WARNING  flask.app:ext.py:255 JSONSCHEMAS_HOST is set to localhost
------------------------------ Captured log call -------------------------------
WARNING  elasticsearch:base.py:97 POST http://elasticsearch:9200/test-weko/item-v1.0.0/a2ca7757-2945-40ed-9a4a-19909ae7b92e/_update [status:403 request:0.005s]
_____________________________ test_run_harvesting ______________________________

self = <sqlalchemy.engine.base.Connection object at 0x7f680e37c128>
dialect = <sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f680da34a58>
constructor = <bound method DefaultExecutionContext._init_compiled of <class 'sqlalchemy.dialects.postgresql.psycopg2.PGExecutionContext_psycopg2'>>
statement = 'INSERT INTO harvest_logs (harvest_setting_id, start_time, end_time, status, errmsg, requrl, counter, setting) VALUES ... %(start_time)s, %(end_time)s, %(status)s, %(errmsg)s, %(requrl)s, %(counter)s, %(setting)s) RETURNING harvest_logs.id'
parameters = {'counter': '{"processed_items": 0, "created_items": 0, "updated_items": 0, "deleted_items": 0, "error_items": 0}', 'end_time': None, 'errmsg': None, 'harvest_setting_id': 1, ...}
args = (<sqlalchemy.dialects.postgresql.psycopg2.PGCompiler_psycopg2 object at 0x7f680e37c198>, [{'counter': {'created_items'...ms': 0, 'error_items': 0, 'processed_items': 0, ...}, 'end_time': None, 'errmsg': None, 'harvest_setting_id': 1, ...}])
conn = <sqlalchemy.pool._ConnectionFairy object at 0x7f680e382b38>
context = <sqlalchemy.dialects.postgresql.psycopg2.PGExecutionContext_psycopg2 object at 0x7f680e37c1d0>

    def _execute_context(
        self, dialect, constructor, statement, parameters, *args
    ):
        """Create an :class:`.ExecutionContext` and execute, returning
        a :class:`.ResultProxy`."""
    
        try:
            try:
                conn = self.__connection
            except AttributeError:
                # escape "except AttributeError" before revalidating
                # to prevent misleading stacktraces in Py3K
                conn = None
            if conn is None:
                conn = self._revalidate_connection()
    
            context = constructor(dialect, self, conn, *args)
        except BaseException as e:
            self._handle_dbapi_exception(
                e, util.text_type(statement), parameters, None, None
            )
    
        if context.compiled:
            context.pre_exec()
    
        cursor, statement, parameters = (
            context.cursor,
            context.statement,
            context.parameters,
        )
    
        if not context.executemany:
            parameters = parameters[0]
    
        if self._has_events or self.engine._has_events:
            for fn in self.dispatch.before_cursor_execute:
                statement, parameters = fn(
                    self,
                    cursor,
                    statement,
                    parameters,
                    context,
                    context.executemany,
                )
    
        if self._echo:
            self.engine.logger.info(statement)
            self.engine.logger.info(
                "%r", sql_util._repr_params(parameters, batches=10)
            )
    
        evt_handled = False
        try:
            if context.executemany:
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_executemany:
                        if fn(cursor, statement, parameters, context):
                            evt_handled = True
                            break
                if not evt_handled:
                    self.dialect.do_executemany(
                        cursor, statement, parameters, context
                    )
            elif not parameters and context.no_parameters:
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_execute_no_params:
                        if fn(cursor, statement, context):
                            evt_handled = True
                            break
                if not evt_handled:
                    self.dialect.do_execute_no_params(
                        cursor, statement, context
                    )
            else:
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_execute:
                        if fn(cursor, statement, parameters, context):
                            evt_handled = True
                            break
                if not evt_handled:
                    self.dialect.do_execute(
>                       cursor, statement, parameters, context
                    )

.tox/c1/lib/python3.6/site-packages/sqlalchemy/engine/base.py:1236: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = <sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f680da34a58>
cursor = <cursor object at 0x7f680d28c140; closed: -1>
statement = 'INSERT INTO harvest_logs (harvest_setting_id, start_time, end_time, status, errmsg, requrl, counter, setting) VALUES ... %(start_time)s, %(end_time)s, %(status)s, %(errmsg)s, %(requrl)s, %(counter)s, %(setting)s) RETURNING harvest_logs.id'
parameters = {'counter': '{"processed_items": 0, "created_items": 0, "updated_items": 0, "deleted_items": 0, "error_items": 0}', 'end_time': None, 'errmsg': None, 'harvest_setting_id': 1, ...}
context = <sqlalchemy.dialects.postgresql.psycopg2.PGExecutionContext_psycopg2 object at 0x7f680e37c1d0>

    def do_execute(self, cursor, statement, parameters, context=None):
>       cursor.execute(statement, parameters)
E       psycopg2.IntegrityError: duplicate key value violates unique constraint "pk_harvest_logs"
E       DETAIL:  Key (id)=(1) already exists.

.tox/c1/lib/python3.6/site-packages/sqlalchemy/engine/default.py:536: IntegrityError

The above exception was the direct cause of the following exception:

app = <Flask 'testapp'>
db = <SQLAlchemy engine=postgresql+psycopg2://invenio:***@postgresql:5432/wekotest>
mocker = <pytest_mock.plugin.MockerFixture object at 0x7f680da4c0f0>

    @responses.activate
    def test_run_harvesting(app, db,mocker):
        mocker.patch("invenio_oaiharvester.tasks.send_run_status_mail")
        index = Index()
        db.session.add(index)
        db.session.commit()
        # result with resumptiontoken
        body1 = \
            '<OAI-PMH xmlns="http://www.openarchives.org/OAI/2.0/" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://www.openarchives.org/OAI/2.0/ http://www.openarchives.org/OAI/2.0/OAI-PMH.xsd">'\
            '<responseDate>2023-03-01T10:54:40Z</responseDate>'\
            '<request verb="ListRecords" metadataPrefix="jpcoar_1.0">https://192.168.56.103/oai</request>'\
            '<ListRecords>'\
            '<resumptionToken>test_token</resumptionToken>'\
            '<record>test_record1</record>'\
            '<record>test_record2</record>'\
            '</ListRecords>'\
            '</OAI-PMH>'
        # result without resummptiontoken
        body2 = \
            '<OAI-PMH xmlns="http://www.openarchives.org/OAI/2.0/" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://www.openarchives.org/OAI/2.0/ http://www.openarchives.org/OAI/2.0/OAI-PMH.xsd">'\
            '<responseDate>2023-03-01T10:54:40Z</responseDate>'\
            '<request verb="ListRecords" metadataPrefix="jpcoar_1.0">https://192.168.56.103/oai</request>'\
            '<ListRecords>'\
            '<record>test_record3</record>'\
            '<record>test_record4</record>'\
            '</ListRecords>'\
            '</OAI-PMH>'
        responses.add(
            responses.GET,
            "http://export.arxiv.org/oai2/?verb=ListRecords&from=2022-10-01&until=2022-10-02&metadataPrefix=jpcoar_1.0",
            body=body1,
            content_type='text/xml'
        )
        responses.add(
            responses.GET,
            "http://export.arxiv.org/oai2/?verb=ListRecords&metadataPrefix=jpcoar_1.0&resumptionToken=test_token",
            body=body2,
            content_type='text/xml'
        )
        body3 = \
        '<OAI-PMH xmlns="http://www.openarchives.org/OAI/2.0/" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://www.openarchives.org/OAI/2.0/ http://www.openarchives.org/OAI/2.0/OAI-PMH.xsd">'\
            '<request verb="ListSets">https://192.168.56.103/oai</request>'\
            '<ListSets>'\
                '<set>'\
                    '<setSpec>test_repo3</setSpec>'\
                '</set>'\
                '<set>'\
                    '<setSpec>test_repo4</setSpec>'\
                '</set>'\
            '</ListSets>'\
        '</OAI-PMH>'
        responses.add(
            responses.GET,
            "http://export.arxiv.org/oai2/?verb=ListSets",
            body=body3,
            content_type='text/xml'
        )
    
        jpcoar_setting1 = HarvestSettings(
            id=1,
            repository_name="jpcoar_test1",
            base_url="http://export.arxiv.org/oai2/",
            from_date=datetime(2022, 10, 1),
            until_date=datetime(2022, 10, 2),
            metadata_prefix="jpcoar_1.0",
            index_id=1,
            update_style="0",
            auto_distribution="1"
        )
        jpcoar_setting2 = HarvestSettings(
            id=2,
            repository_name="jpcoar_test2",
            base_url="http://export.arxiv.org/oai2/",
            from_date=datetime(2022, 10, 1),
            until_date=datetime(2022, 10, 2),
            metadata_prefix="jpcoar_1.0",
            index_id=1,
            update_style="0",
            auto_distribution="0",
            resumption_token="test_token"
        )
        logs = HarvestLogs(
            id=1,
            harvest_setting_id=2
        )
        with db.session.begin_nested():
            db.session.add(jpcoar_setting1)
            db.session.add(jpcoar_setting2)
            db.session.add(logs)
        db.session.commit()
    
        # is_harvest_running is True
        with patch('invenio_oaiharvester.tasks.is_harvest_running', return_value=True):
            res = run_harvesting(1, '2022-10-01T00:00:00', '2022-10-01T23:59:59', {})
            assert res == ({"task_state":"SUCCESS","task_id":None},"2022-10-01T23:59:59")
            #assert res==({'task_state': 'SUCCESS', 'start_time': '2022-10-01T00:00:00', 'end_time': res[0]['end_time'], 'total_records': 0, 'execution_time': res[0]['execution_time'], 'task_name': 'harvest', 'repository_name': 'weko', 'task_id': None}, '2022-10-01T23:59:59')
    
        with patch('invenio_oaiharvester.tasks.is_harvest_running', return_value=False):
            with patch("invenio_oaiharvester.tasks.process_item"):
>               res = run_harvesting(1, '2022-10-01T00:00:00', '2022-10-01T23:59:59', {})

tests/test_tasks.py:542: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.tox/c1/lib/python3.6/site-packages/celery/local.py:191: in __call__
    return self._get_current_object()(*a, **kw)
.tox/c1/lib/python3.6/site-packages/celery/app/task.py:393: in __call__
    return self.run(*args, **kwargs)
invenio_oaiharvester/tasks.py:426: in run_harvesting
    db.session.commit()
.tox/c1/lib/python3.6/site-packages/sqlalchemy/orm/scoping.py:162: in do
    return getattr(self.registry(), name)(*args, **kwargs)
.tox/c1/lib/python3.6/site-packages/sqlalchemy/orm/session.py:1023: in commit
    self.transaction.commit()
.tox/c1/lib/python3.6/site-packages/sqlalchemy/orm/session.py:487: in commit
    self._prepare_impl()
.tox/c1/lib/python3.6/site-packages/sqlalchemy/orm/session.py:466: in _prepare_impl
    self.session.flush()
.tox/c1/lib/python3.6/site-packages/sqlalchemy/orm/session.py:2446: in flush
    self._flush(objects)
.tox/c1/lib/python3.6/site-packages/sqlalchemy/orm/session.py:2584: in _flush
    transaction.rollback(_capture_exception=True)
.tox/c1/lib/python3.6/site-packages/sqlalchemy/util/langhelpers.py:67: in __exit__
    compat.reraise(exc_type, exc_value, exc_tb)
.tox/c1/lib/python3.6/site-packages/sqlalchemy/util/compat.py:277: in reraise
    raise value
.tox/c1/lib/python3.6/site-packages/sqlalchemy/orm/session.py:2544: in _flush
    flush_context.execute()
.tox/c1/lib/python3.6/site-packages/sqlalchemy/orm/unitofwork.py:416: in execute
    rec.execute(self)
.tox/c1/lib/python3.6/site-packages/sqlalchemy/orm/unitofwork.py:583: in execute
    uow,
.tox/c1/lib/python3.6/site-packages/sqlalchemy/orm/persistence.py:245: in save_obj
    insert,
.tox/c1/lib/python3.6/site-packages/sqlalchemy/orm/persistence.py:1116: in _emit_insert_statements
    statement, params
.tox/c1/lib/python3.6/site-packages/sqlalchemy/engine/base.py:980: in execute
    return meth(self, multiparams, params)
.tox/c1/lib/python3.6/site-packages/sqlalchemy/sql/elements.py:273: in _execute_on_connection
    return connection._execute_clauseelement(self, multiparams, params)
.tox/c1/lib/python3.6/site-packages/sqlalchemy/engine/base.py:1099: in _execute_clauseelement
    distilled_params,
.tox/c1/lib/python3.6/site-packages/sqlalchemy/engine/base.py:1240: in _execute_context
    e, statement, parameters, cursor, context
.tox/c1/lib/python3.6/site-packages/sqlalchemy/engine/base.py:1458: in _handle_dbapi_exception
    util.raise_from_cause(sqlalchemy_exception, exc_info)
.tox/c1/lib/python3.6/site-packages/sqlalchemy/util/compat.py:296: in raise_from_cause
    reraise(type(exception), exception, tb=exc_tb, cause=cause)
.tox/c1/lib/python3.6/site-packages/sqlalchemy/util/compat.py:276: in reraise
    raise value.with_traceback(tb)
.tox/c1/lib/python3.6/site-packages/sqlalchemy/engine/base.py:1236: in _execute_context
    cursor, statement, parameters, context
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = <sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f680da34a58>
cursor = <cursor object at 0x7f680d28c140; closed: -1>
statement = 'INSERT INTO harvest_logs (harvest_setting_id, start_time, end_time, status, errmsg, requrl, counter, setting) VALUES ... %(start_time)s, %(end_time)s, %(status)s, %(errmsg)s, %(requrl)s, %(counter)s, %(setting)s) RETURNING harvest_logs.id'
parameters = {'counter': '{"processed_items": 0, "created_items": 0, "updated_items": 0, "deleted_items": 0, "error_items": 0}', 'end_time': None, 'errmsg': None, 'harvest_setting_id': 1, ...}
context = <sqlalchemy.dialects.postgresql.psycopg2.PGExecutionContext_psycopg2 object at 0x7f680e37c1d0>

    def do_execute(self, cursor, statement, parameters, context=None):
>       cursor.execute(statement, parameters)
E       sqlalchemy.exc.IntegrityError: (psycopg2.IntegrityError) duplicate key value violates unique constraint "pk_harvest_logs"
E       DETAIL:  Key (id)=(1) already exists.
E        [SQL: 'INSERT INTO harvest_logs (harvest_setting_id, start_time, end_time, status, errmsg, requrl, counter, setting) VALUES (%(harvest_setting_id)s, %(start_time)s, %(end_time)s, %(status)s, %(errmsg)s, %(requrl)s, %(counter)s, %(setting)s) RETURNING harvest_logs.id'] [parameters: {'harvest_setting_id': 1, 'start_time': datetime.datetime(2023, 11, 3, 8, 39, 31, 949778), 'end_time': None, 'status': 'Running', 'errmsg': None, 'requrl': None, 'counter': '{"processed_items": 0, "created_items": 0, "updated_items": 0, "deleted_items": 0, "error_items": 0}', 'setting': '{"repository_name": "jpcoar_test1", "base_url": "http://export.arxiv.org/oai2/", "from_date": "2022-10-01", "until_date": "2022-10-02", "set_spec": null, "metadata_prefix": "jpcoar_1.0", "target_index": "", "update_style": "0", "auto_distribution": "1"}'}] (Background on this error at: http://sqlalche.me/e/gkpj)

.tox/c1/lib/python3.6/site-packages/sqlalchemy/engine/default.py:536: IntegrityError
------------------------------ Captured log setup ------------------------------
WARNING  flask.app:ext.py:255 JSONSCHEMAS_HOST is set to localhost
=============================== warnings summary ===============================
.tox/c1/lib/python3.6/site-packages/blinker/base.py:110
  /code/modules/invenio-oaiharvester/.tox/c1/lib/python3.6/site-packages/blinker/base.py:110: DeprecationWarning: invalid escape sequence \*
    """

.tox/c1/lib/python3.6/site-packages/blinker/base.py:180
  /code/modules/invenio-oaiharvester/.tox/c1/lib/python3.6/site-packages/blinker/base.py:180: DeprecationWarning: invalid escape sequence \*
    """

.tox/c1/lib/python3.6/site-packages/blinker/base.py:252
  /code/modules/invenio-oaiharvester/.tox/c1/lib/python3.6/site-packages/blinker/base.py:252: DeprecationWarning: invalid escape sequence \*
    """

.tox/c1/lib/python3.6/site-packages/pygments/lexers/html.py:223
  /code/modules/invenio-oaiharvester/.tox/c1/lib/python3.6/site-packages/pygments/lexers/html.py:223: DeprecationWarning: invalid escape sequence \s
    ('\s+', Text),

.tox/c1/lib/python3.6/site-packages/pygments/lexers/html.py:316
  /code/modules/invenio-oaiharvester/.tox/c1/lib/python3.6/site-packages/pygments/lexers/html.py:316: DeprecationWarning: invalid escape sequence \]
    (r'(/)(\[' + _dot + '*?\])(' + _dot + r'*\n)',

.tox/c1/lib/python3.6/site-packages/pygments/lexers/html.py:333
  /code/modules/invenio-oaiharvester/.tox/c1/lib/python3.6/site-packages/pygments/lexers/html.py:333: DeprecationWarning: invalid escape sequence \}
    (r'\{(,\n|' + _dot + ')*?\}', using(RubyLexer)),

.tox/c1/lib/python3.6/site-packages/pygments/lexers/html.py:334
  /code/modules/invenio-oaiharvester/.tox/c1/lib/python3.6/site-packages/pygments/lexers/html.py:334: DeprecationWarning: invalid escape sequence \]
    (r'\[' + _dot + '*?\]', using(RubyLexer)),

.tox/c1/lib/python3.6/site-packages/pygments/lexers/html.py:343
  /code/modules/invenio-oaiharvester/.tox/c1/lib/python3.6/site-packages/pygments/lexers/html.py:343: DeprecationWarning: invalid escape sequence \}
    (r'(#\{)(' + _dot + '*?)(\})',

.tox/c1/lib/python3.6/site-packages/pygments/lexers/html.py:376
  /code/modules/invenio-oaiharvester/.tox/c1/lib/python3.6/site-packages/pygments/lexers/html.py:376: DeprecationWarning: invalid escape sequence \}
    (r'(#\{)(' + _dot + '*?)(\})',

.tox/c1/lib/python3.6/site-packages/pygments/lexers/html.py:425
  /code/modules/invenio-oaiharvester/.tox/c1/lib/python3.6/site-packages/pygments/lexers/html.py:425: DeprecationWarning: invalid escape sequence \]
    (r'(/)(\[' + _dot + '*?\])(' + _dot + r'*\n)',

.tox/c1/lib/python3.6/site-packages/pygments/lexers/html.py:445
  /code/modules/invenio-oaiharvester/.tox/c1/lib/python3.6/site-packages/pygments/lexers/html.py:445: DeprecationWarning: invalid escape sequence \}
    (r'\{(,\n|' + _dot + ')*?\}', using(ScalaLexer)),

.tox/c1/lib/python3.6/site-packages/pygments/lexers/html.py:446
  /code/modules/invenio-oaiharvester/.tox/c1/lib/python3.6/site-packages/pygments/lexers/html.py:446: DeprecationWarning: invalid escape sequence \]
    (r'\[' + _dot + '*?\]', using(ScalaLexer)),

.tox/c1/lib/python3.6/site-packages/pygments/lexers/html.py:455
  /code/modules/invenio-oaiharvester/.tox/c1/lib/python3.6/site-packages/pygments/lexers/html.py:455: DeprecationWarning: invalid escape sequence \}
    (r'(#\{)(' + _dot + '*?)(\})',

.tox/c1/lib/python3.6/site-packages/pygments/lexers/html.py:488
  /code/modules/invenio-oaiharvester/.tox/c1/lib/python3.6/site-packages/pygments/lexers/html.py:488: DeprecationWarning: invalid escape sequence \}
    (r'(#\{)(' + _dot + '*?)(\})',

.tox/c1/lib/python3.6/site-packages/pygments/lexers/html.py:533
  /code/modules/invenio-oaiharvester/.tox/c1/lib/python3.6/site-packages/pygments/lexers/html.py:533: DeprecationWarning: invalid escape sequence \]
    (r'(/)(\[' + _dot + '*?\])(' + _dot + r'*\n)',

.tox/c1/lib/python3.6/site-packages/pygments/lexers/html.py:554
  /code/modules/invenio-oaiharvester/.tox/c1/lib/python3.6/site-packages/pygments/lexers/html.py:554: DeprecationWarning: invalid escape sequence \}
    (r'\{(,\n|' + _dot + ')*?\}', using(ScalaLexer)),

.tox/c1/lib/python3.6/site-packages/pygments/lexers/html.py:555
  /code/modules/invenio-oaiharvester/.tox/c1/lib/python3.6/site-packages/pygments/lexers/html.py:555: DeprecationWarning: invalid escape sequence \]
    (r'\[' + _dot + '*?\]', using(ScalaLexer)),

.tox/c1/lib/python3.6/site-packages/pygments/lexers/html.py:564
  /code/modules/invenio-oaiharvester/.tox/c1/lib/python3.6/site-packages/pygments/lexers/html.py:564: DeprecationWarning: invalid escape sequence \}
    (r'(#\{)(' + _dot + '*?)(\})',

.tox/c1/lib/python3.6/site-packages/pygments/lexers/html.py:597
  /code/modules/invenio-oaiharvester/.tox/c1/lib/python3.6/site-packages/pygments/lexers/html.py:597: DeprecationWarning: invalid escape sequence \}
    (r'(#\{)(' + _dot + '*?)(\})',

.tox/c1/lib/python3.6/site-packages/pygments/lexers/javascript.py:538
  /code/modules/invenio-oaiharvester/.tox/c1/lib/python3.6/site-packages/pygments/lexers/javascript.py:538: DeprecationWarning: invalid escape sequence \s
    if re.search('^(import.+(from\s+)?["\']|'

.tox/c1/lib/python3.6/site-packages/pygments/lexers/javascript.py:539
  /code/modules/invenio-oaiharvester/.tox/c1/lib/python3.6/site-packages/pygments/lexers/javascript.py:539: DeprecationWarning: invalid escape sequence \s
    '(export\s*)?(interface|class|function)\s+)',

.tox/c1/lib/python3.6/site-packages/pygments/lexers/javascript.py:1018
  /code/modules/invenio-oaiharvester/.tox/c1/lib/python3.6/site-packages/pygments/lexers/javascript.py:1018: DeprecationWarning: invalid escape sequence \s
    if re.search('^\s*@import\s+[<"]', text, re.MULTILINE):

.tox/c1/lib/python3.6/site-packages/pygments/lexers/jvm.py:260
  /code/modules/invenio-oaiharvester/.tox/c1/lib/python3.6/site-packages/pygments/lexers/jvm.py:260: DeprecationWarning: invalid escape sequence \d
    letter_letter_digit = u'%s(?:%s|\d)*' % (letter, letter)

.tox/c1/lib/python3.6/site-packages/pygments/lexers/jvm.py:692
  /code/modules/invenio-oaiharvester/.tox/c1/lib/python3.6/site-packages/pygments/lexers/jvm.py:692: DeprecationWarning: invalid escape sequence \w
    u'(?![\w!:?])', Name.Function),

.tox/c1/lib/python3.6/site-packages/pygments/lexers/jvm.py:1261
  /code/modules/invenio-oaiharvester/.tox/c1/lib/python3.6/site-packages/pygments/lexers/jvm.py:1261: DeprecationWarning: invalid escape sequence \w
    ('`?[a-zA-Z_][\w$]*', Name),

.tox/c1/lib/python3.6/site-packages/pygments/lexers/ruby.py:406
  /code/modules/invenio-oaiharvester/.tox/c1/lib/python3.6/site-packages/pygments/lexers/ruby.py:406: DeprecationWarning: invalid escape sequence \(
    _prompt_re = re.compile('irb\([a-zA-Z_]\w*\):\d{3}:\d+[>*"\'] '

.tox/c1/lib/python3.6/site-packages/pygments/lexers/ruby.py:407
  /code/modules/invenio-oaiharvester/.tox/c1/lib/python3.6/site-packages/pygments/lexers/ruby.py:407: DeprecationWarning: invalid escape sequence \?
    '|>> |\?> ')

.tox/c1/lib/python3.6/site-packages/pygments/lexers/ruby.py:501
  /code/modules/invenio-oaiharvester/.tox/c1/lib/python3.6/site-packages/pygments/lexers/ruby.py:501: DeprecationWarning: invalid escape sequence \w
    ('[A-Z]\w*', Name.Constant),

.tox/c1/lib/python3.6/site-packages/pygments/lexers/ruby.py:502
  /code/modules/invenio-oaiharvester/.tox/c1/lib/python3.6/site-packages/pygments/lexers/ruby.py:502: DeprecationWarning: invalid escape sequence \w
    ('@[a-zA-Z_]\w*', Name.Variable.Instance),

.tox/c1/lib/python3.6/site-packages/pygments/lexers/ruby.py:503
  /code/modules/invenio-oaiharvester/.tox/c1/lib/python3.6/site-packages/pygments/lexers/ruby.py:503: DeprecationWarning: invalid escape sequence \w
    ('@@[a-zA-Z_]\w*', Name.Variable.Class),

.tox/c1/lib/python3.6/site-packages/pygments/lexers/ruby.py:505
  /code/modules/invenio-oaiharvester/.tox/c1/lib/python3.6/site-packages/pygments/lexers/ruby.py:505: DeprecationWarning: invalid escape sequence \w
    ('[a-zA-Z_]\w*', Name),

.tox/c1/lib/python3.6/site-packages/pygments/lexers/actionscript.py:128
  /code/modules/invenio-oaiharvester/.tox/c1/lib/python3.6/site-packages/pygments/lexers/actionscript.py:128: DeprecationWarning: invalid escape sequence \.
    typeidentifier = identifier + '(?:\.<\w+>)?'

.tox/c1/lib/python3.6/site-packages/pygments/lexers/actionscript.py:235
  /code/modules/invenio-oaiharvester/.tox/c1/lib/python3.6/site-packages/pygments/lexers/actionscript.py:235: DeprecationWarning: invalid escape sequence \s
    ('\s+', Text),

.tox/c1/lib/python3.6/site-packages/pygments/lexers/php.py:176
  /code/modules/invenio-oaiharvester/.tox/c1/lib/python3.6/site-packages/pygments/lexers/php.py:176: DeprecationWarning: invalid escape sequence \}
    (r'\$\{\$+' + _ident_inner + '\}', Name.Variable),

.tox/c1/lib/python3.6/site-packages/pygments/lexers/php.py:217
  /code/modules/invenio-oaiharvester/.tox/c1/lib/python3.6/site-packages/pygments/lexers/php.py:217: DeprecationWarning: invalid escape sequence \[
    (r'\$' + _ident_inner + '(\[\S+?\]|->' + _ident_inner + ')?',

.tox/c1/lib/python3.6/site-packages/pygments/lexers/webmisc.py:441
  /code/modules/invenio-oaiharvester/.tox/c1/lib/python3.6/site-packages/pygments/lexers/webmisc.py:441: DeprecationWarning: invalid escape sequence \(
    (r'(' + qname + ')(\()?', bygroups(Name, Punctuation), 'operator'),

.tox/c1/lib/python3.6/site-packages/pygments/lexers/webmisc.py:646
  /code/modules/invenio-oaiharvester/.tox/c1/lib/python3.6/site-packages/pygments/lexers/webmisc.py:646: DeprecationWarning: invalid escape sequence \*
    (ncname + ':\*', Name, 'operator'),

.tox/c1/lib/python3.6/site-packages/pygments/lexers/webmisc.py:647
  /code/modules/invenio-oaiharvester/.tox/c1/lib/python3.6/site-packages/pygments/lexers/webmisc.py:647: DeprecationWarning: invalid escape sequence \*
    ('\*:'+ncname, Name.Tag, 'operator'),

.tox/c1/lib/python3.6/site-packages/pygments/lexers/webmisc.py:648
  /code/modules/invenio-oaiharvester/.tox/c1/lib/python3.6/site-packages/pygments/lexers/webmisc.py:648: DeprecationWarning: invalid escape sequence \*
    ('\*', Name.Tag, 'operator'),

.tox/c1/lib/python3.6/site-packages/pygments/lexers/webmisc.py:875
  /code/modules/invenio-oaiharvester/.tox/c1/lib/python3.6/site-packages/pygments/lexers/webmisc.py:875: DeprecationWarning: invalid escape sequence \`
    """

.tox/c1/lib/python3.6/site-packages/pygments/lexers/lisp.py:142
  /code/modules/invenio-oaiharvester/.tox/c1/lib/python3.6/site-packages/pygments/lexers/lisp.py:142: DeprecationWarning: invalid escape sequence \(
    ("(?<=\()(%s)" % '|'.join(re.escape(entry) + ' ' for entry in builtins),

.tox/c1/lib/python3.6/site-packages/pygments/lexers/lisp.py:324
  /code/modules/invenio-oaiharvester/.tox/c1/lib/python3.6/site-packages/pygments/lexers/lisp.py:324: DeprecationWarning: invalid escape sequence \s
    (r'#+nil' + terminated + '\s*\(', Comment.Preproc, 'commented-form'),

.tox/c1/lib/python3.6/site-packages/pygments/lexers/lisp.py:336
  /code/modules/invenio-oaiharvester/.tox/c1/lib/python3.6/site-packages/pygments/lexers/lisp.py:336: DeprecationWarning: invalid escape sequence \*
    (r'\*' + symbol + '\*', Name.Variable.Global),

.tox/c1/lib/python3.6/site-packages/pygments/lexers/lisp.py:2157
  /code/modules/invenio-oaiharvester/.tox/c1/lib/python3.6/site-packages/pygments/lexers/lisp.py:2157: DeprecationWarning: invalid escape sequence \*
    (r'\*' + symbol + '\*', Name.Variable.Global),

.tox/c1/lib/python3.6/site-packages/pygments/lexers/python.py:183
  /code/modules/invenio-oaiharvester/.tox/c1/lib/python3.6/site-packages/pygments/lexers/python.py:183: DeprecationWarning: invalid escape sequence \w
    ('[a-zA-Z_]\w*', Name),

.tox/c1/lib/python3.6/site-packages/pygments/lexers/python.py:187
  /code/modules/invenio-oaiharvester/.tox/c1/lib/python3.6/site-packages/pygments/lexers/python.py:187: DeprecationWarning: invalid escape sequence \w
    ('[a-zA-Z_]\w*', Name.Function, '#pop'),

.tox/c1/lib/python3.6/site-packages/pygments/lexers/python.py:191
  /code/modules/invenio-oaiharvester/.tox/c1/lib/python3.6/site-packages/pygments/lexers/python.py:191: DeprecationWarning: invalid escape sequence \w
    ('[a-zA-Z_]\w*', Name.Class, '#pop')

.tox/c1/lib/python3.6/site-packages/pygments/lexers/python.py:268
  /code/modules/invenio-oaiharvester/.tox/c1/lib/python3.6/site-packages/pygments/lexers/python.py:268: DeprecationWarning: invalid escape sequence \w
    '((\w+)((\.\w+)|(\[[^\]]+\]))*)?'  # field name

.tox/c1/lib/python3.6/site-packages/pygments/lexers/python.py:269
  /code/modules/invenio-oaiharvester/.tox/c1/lib/python3.6/site-packages/pygments/lexers/python.py:269: DeprecationWarning: invalid escape sequence \!
    '(\![sra])?'                       # conversion

.tox/c1/lib/python3.6/site-packages/pygments/lexers/python.py:270
  /code/modules/invenio-oaiharvester/.tox/c1/lib/python3.6/site-packages/pygments/lexers/python.py:270: DeprecationWarning: invalid escape sequence \:
    '(\:(.?[<>=\^])?[-+ ]?#?0?(\d+)?,?(\.\d+)?[E-GXb-gnosx%]?)?'

.tox/c1/lib/python3.6/site-packages/pygments/lexers/python.py:271
  /code/modules/invenio-oaiharvester/.tox/c1/lib/python3.6/site-packages/pygments/lexers/python.py:271: DeprecationWarning: invalid escape sequence \}
    '\}', String.Interpol),

.tox/c1/lib/python3.6/site-packages/pygments/lexers/python.py:674
  /code/modules/invenio-oaiharvester/.tox/c1/lib/python3.6/site-packages/pygments/lexers/python.py:674: DeprecationWarning: invalid escape sequence \w
    ('[a-zA-Z_]\w*', Name),

.tox/c1/lib/python3.6/site-packages/pygments/lexers/python.py:677
  /code/modules/invenio-oaiharvester/.tox/c1/lib/python3.6/site-packages/pygments/lexers/python.py:677: DeprecationWarning: invalid escape sequence \w
    ('[a-zA-Z_]\w*', Name.Function, '#pop')

.tox/c1/lib/python3.6/site-packages/pygments/lexers/python.py:694
  /code/modules/invenio-oaiharvester/.tox/c1/lib/python3.6/site-packages/pygments/lexers/python.py:694: DeprecationWarning: invalid escape sequence \w
    ('[a-zA-Z_]\w*', Name.Class, '#pop')

.tox/c1/lib/python3.6/site-packages/pygments/lexers/perl.py:211
  /code/modules/invenio-oaiharvester/.tox/c1/lib/python3.6/site-packages/pygments/lexers/perl.py:211: DeprecationWarning: invalid escape sequence \s
    if re.search('(?:my|our)\s+[$@%(]', text):

.tox/c1/lib/python3.6/site-packages/pygments/lexers/perl.py:229
  /code/modules/invenio-oaiharvester/.tox/c1/lib/python3.6/site-packages/pygments/lexers/perl.py:229: DeprecationWarning: invalid escape sequence \w
    PERL6_IDENTIFIER_RANGE = "['\w:-]"

.tox/c1/lib/python3.6/site-packages/pygments/lexers/perl.py:498
  /code/modules/invenio-oaiharvester/.tox/c1/lib/python3.6/site-packages/pygments/lexers/perl.py:498: DeprecationWarning: invalid escape sequence \s
    (r'(regex|token|rule)(?!' + PERL6_IDENTIFIER_RANGE + ')(\s*' + PERL6_IDENTIFIER_RANGE + '+)?',

.tox/c1/lib/python3.6/site-packages/pygments/lexers/perl.py:594
  /code/modules/invenio-oaiharvester/.tox/c1/lib/python3.6/site-packages/pygments/lexers/perl.py:594: DeprecationWarning: invalid escape sequence \s
    if re.search("(?:my|our|has)\s+(?:" + Perl6Lexer.PERL6_IDENTIFIER_RANGE +

.tox/c1/lib/python3.6/site-packages/pygments/lexers/perl.py:595
  /code/modules/invenio-oaiharvester/.tox/c1/lib/python3.6/site-packages/pygments/lexers/perl.py:595: DeprecationWarning: invalid escape sequence \s
    "+\s+)?[$@%&(]", text):

.tox/c1/lib/python3.6/site-packages/pygments/lexers/perl.py:601
  /code/modules/invenio-oaiharvester/.tox/c1/lib/python3.6/site-packages/pygments/lexers/perl.py:601: DeprecationWarning: invalid escape sequence \s
    if re.match('^\s*$', line):

.tox/c1/lib/python3.6/site-packages/pygments/lexers/perl.py:605
  /code/modules/invenio-oaiharvester/.tox/c1/lib/python3.6/site-packages/pygments/lexers/perl.py:605: DeprecationWarning: invalid escape sequence \s
    if re.match('^\s*(?:use\s+)?v6(?:\.\d(?:\.\d)?)?;', line):

.tox/c1/lib/python3.6/site-packages/pygments/lexers/perl.py:608
  /code/modules/invenio-oaiharvester/.tox/c1/lib/python3.6/site-packages/pygments/lexers/perl.py:608: DeprecationWarning: invalid escape sequence \s
    class_decl = re.match('^\s*(?:(?P<scope>my|our)\s+)?(?:module|class|role|enum|grammar)', line)

.tox/c1/lib/python3.6/site-packages/pygments/lexers/iolang.py:52
  /code/modules/invenio-oaiharvester/.tox/c1/lib/python3.6/site-packages/pygments/lexers/iolang.py:52: DeprecationWarning: invalid escape sequence \w
    ('[a-zA-Z_]\w*', Name),

.tox/c1/lib/python3.6/site-packages/pygments/lexers/scripting.py:107
  /code/modules/invenio-oaiharvester/.tox/c1/lib/python3.6/site-packages/pygments/lexers/scripting.py:107: DeprecationWarning: invalid escape sequence \(
    ('\(', Punctuation, '#pop'),

.tox/c1/lib/python3.6/site-packages/pygments/lexers/scripting.py:699
  /code/modules/invenio-oaiharvester/.tox/c1/lib/python3.6/site-packages/pygments/lexers/scripting.py:699: DeprecationWarning: invalid escape sequence \(
    ('\(\*', Comment.Multiline, '#push'),

.tox/c1/lib/python3.6/site-packages/pygments/lexers/scripting.py:700
  /code/modules/invenio-oaiharvester/.tox/c1/lib/python3.6/site-packages/pygments/lexers/scripting.py:700: DeprecationWarning: invalid escape sequence \*
    ('\*\)', Comment.Multiline, '#pop'),

.tox/c1/lib/python3.6/site-packages/babel/core.py:1130
  /code/modules/invenio-oaiharvester/.tox/c1/lib/python3.6/site-packages/babel/core.py:1130: DeprecationWarning: invalid escape sequence \s
    """

.tox/c1/lib/python3.6/site-packages/babel/dates.py:1158
  /code/modules/invenio-oaiharvester/.tox/c1/lib/python3.6/site-packages/babel/dates.py:1158: DeprecationWarning: invalid escape sequence \d
    numbers = re.findall('(\d+)', string)

.tox/c1/lib/python3.6/site-packages/babel/dates.py:1201
  /code/modules/invenio-oaiharvester/.tox/c1/lib/python3.6/site-packages/babel/dates.py:1201: DeprecationWarning: invalid escape sequence \d
    numbers = re.findall('(\d+)', string)

.tox/c1/lib/python3.6/site-packages/babel/localtime/_unix.py:103
  /code/modules/invenio-oaiharvester/.tox/c1/lib/python3.6/site-packages/babel/localtime/_unix.py:103: DeprecationWarning: invalid escape sequence \s
    zone_re = re.compile('\s*ZONE\s*=\s*\"')

.tox/c1/lib/python3.6/site-packages/babel/localtime/_unix.py:104
  /code/modules/invenio-oaiharvester/.tox/c1/lib/python3.6/site-packages/babel/localtime/_unix.py:104: DeprecationWarning: invalid escape sequence \s
    timezone_re = re.compile('\s*TIMEZONE\s*=\s*\"')

.tox/c1/lib/python3.6/site-packages/arrow/parser.py:24
  /code/modules/invenio-oaiharvester/.tox/c1/lib/python3.6/site-packages/arrow/parser.py:24: DeprecationWarning: invalid escape sequence \[
    _ESCAPE_RE = re.compile('\[[^\[\]]*\]')

.tox/c1/lib/python3.6/site-packages/arrow/parser.py:26
  /code/modules/invenio-oaiharvester/.tox/c1/lib/python3.6/site-packages/arrow/parser.py:26: DeprecationWarning: invalid escape sequence \d
    _ONE_OR_MORE_DIGIT_RE = re.compile('\d+')

.tox/c1/lib/python3.6/site-packages/arrow/parser.py:27
  /code/modules/invenio-oaiharvester/.tox/c1/lib/python3.6/site-packages/arrow/parser.py:27: DeprecationWarning: invalid escape sequence \d
    _ONE_OR_TWO_DIGIT_RE = re.compile('\d{1,2}')

.tox/c1/lib/python3.6/site-packages/arrow/parser.py:28
  /code/modules/invenio-oaiharvester/.tox/c1/lib/python3.6/site-packages/arrow/parser.py:28: DeprecationWarning: invalid escape sequence \d
    _FOUR_DIGIT_RE = re.compile('\d{4}')

.tox/c1/lib/python3.6/site-packages/arrow/parser.py:29
  /code/modules/invenio-oaiharvester/.tox/c1/lib/python3.6/site-packages/arrow/parser.py:29: DeprecationWarning: invalid escape sequence \d
    _TWO_DIGIT_RE = re.compile('\d{2}')

.tox/c1/lib/python3.6/site-packages/arrow/parser.py:30
  /code/modules/invenio-oaiharvester/.tox/c1/lib/python3.6/site-packages/arrow/parser.py:30: DeprecationWarning: invalid escape sequence \-
    _TZ_RE = re.compile('[+\-]?\d{2}:?(\d{2})?')

.tox/c1/lib/python3.6/site-packages/arrow/parser.py:31
  /code/modules/invenio-oaiharvester/.tox/c1/lib/python3.6/site-packages/arrow/parser.py:31: DeprecationWarning: invalid escape sequence \w
    _TZ_NAME_RE = re.compile('\w[\w+\-/]+')

.tox/c1/lib/python3.6/site-packages/arrow/parser.py:49
  /code/modules/invenio-oaiharvester/.tox/c1/lib/python3.6/site-packages/arrow/parser.py:49: DeprecationWarning: invalid escape sequence \d
    'X': re.compile('\d+'),

.tox/c1/lib/python3.6/site-packages/arrow/parser.py:310
  /code/modules/invenio-oaiharvester/.tox/c1/lib/python3.6/site-packages/arrow/parser.py:310: DeprecationWarning: invalid escape sequence \-
    _TZINFO_RE = re.compile('([+\-])?(\d\d):?(\d\d)?')

.tox/c1/lib/python3.6/site-packages/passlib/context.py:231
  /code/modules/invenio-oaiharvester/.tox/c1/lib/python3.6/site-packages/passlib/context.py:231: DeprecationWarning: invalid escape sequence \;
    elif any(c in source for c in "\n\r\t") or not source.strip(" \t./\;:"):

.tox/c1/lib/python3.6/site-packages/passlib/context.py:2240
  /code/modules/invenio-oaiharvester/.tox/c1/lib/python3.6/site-packages/passlib/context.py:2240: DeprecationWarning: invalid escape sequence \*
    """

.tox/c1/lib/python3.6/site-packages/passlib/context.py:2323
  /code/modules/invenio-oaiharvester/.tox/c1/lib/python3.6/site-packages/passlib/context.py:2323: DeprecationWarning: invalid escape sequence \*
    """

.tox/c1/lib/python3.6/site-packages/passlib/context.py:2406
  /code/modules/invenio-oaiharvester/.tox/c1/lib/python3.6/site-packages/passlib/context.py:2406: DeprecationWarning: invalid escape sequence \*
    """

.tox/c1/lib/python3.6/site-packages/elasticsearch_dsl/document.py:215
  /code/modules/invenio-oaiharvester/.tox/c1/lib/python3.6/site-packages/elasticsearch_dsl/document.py:215: DeprecationWarning: invalid escape sequence \s
    """

../invenio-indexer/invenio_indexer/cli.py:166
  /code/modules/invenio-indexer/invenio_indexer/cli.py:166: DeprecationWarning: 'resultcallback' has been renamed to 'result_callback'. The old name will be removed in Click 8.1.
    @queue.resultcallback()

.tox/c1/lib/python3.6/site-packages/flask_caching/__init__.py:801
  /code/modules/invenio-oaiharvester/.tox/c1/lib/python3.6/site-packages/flask_caching/__init__.py:801: DeprecationWarning: invalid escape sequence \*
    """

.tox/c1/lib/python3.6/site-packages/elementpath/tdop_parser.py:434
  /code/modules/invenio-oaiharvester/.tox/c1/lib/python3.6/site-packages/elementpath/tdop_parser.py:434: DeprecationWarning: invalid escape sequence \s
    s.replace(r'\ ', '\s+')

.tox/c1/lib/python3.6/site-packages/elementpath/tdop_parser.py:441
  /code/modules/invenio-oaiharvester/.tox/c1/lib/python3.6/site-packages/elementpath/tdop_parser.py:441: DeprecationWarning: invalid escape sequence \s
    s = '%s\s*%s' % (s[:-4], s[-4:])

.tox/c1/lib/python3.6/site-packages/elementpath/tdop_parser.py:439
  /code/modules/invenio-oaiharvester/.tox/c1/lib/python3.6/site-packages/elementpath/tdop_parser.py:439: DeprecationWarning: invalid escape sequence \s
    s = '%s\s*%s' % (s[:-2], s[-2:])

.tox/c1/lib/python3.6/site-packages/elementpath/xpath1_parser.py:32
  /code/modules/invenio-oaiharvester/.tox/c1/lib/python3.6/site-packages/elementpath/xpath1_parser.py:32: DeprecationWarning: invalid escape sequence \-
    XML_NCNAME_PATTERN = u"[{0}][\-.0-9\u00B7\u0300-\u036F\u203F-\u2040{0}]*".format(XML_NAME_CHARACTER)

.tox/c1/lib/python3.6/site-packages/elementpath/xpath1_parser.py:115
  /code/modules/invenio-oaiharvester/.tox/c1/lib/python3.6/site-packages/elementpath/xpath1_parser.py:115: DeprecationWarning: invalid escape sequence \s
    axis_pattern_template = '\\b%s(?=\s*\\:\\:|\s*\\(\\:.*\\:\\)\s*\\:\\:)'

.tox/c1/lib/python3.6/site-packages/elementpath/xpath1_parser.py:169
  /code/modules/invenio-oaiharvester/.tox/c1/lib/python3.6/site-packages/elementpath/xpath1_parser.py:169: DeprecationWarning: invalid escape sequence \s
    function_pattern_template = '\\b%s(?=\s*\\(|\s*\\(\\:.*\\:\\)\\()'

.tox/c1/lib/python3.6/site-packages/elementpath/xpath2_parser.py:1045
  /code/modules/invenio-oaiharvester/.tox/c1/lib/python3.6/site-packages/elementpath/xpath2_parser.py:1045: DeprecationWarning: invalid escape sequence \s
    pattern='\\battribute(?=\s*\\:\\:|\s*\\(\\:.*\\:\\)\s*\\:\\:|\s*\\(|\s*\\(\\:.*\\:\\)\\()')

.tox/c1/lib/python3.6/site-packages/xmlschema/regex.py:39
  /code/modules/invenio-oaiharvester/.tox/c1/lib/python3.6/site-packages/xmlschema/regex.py:39: DeprecationWarning: invalid escape sequence \-
    u"\-.0-9:A-Z_a-z\u00B7\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u037D\u037F-\u1FFF\u200C-"

.tox/c1/lib/python3.6/site-packages/xmlschema/codepoints.py:31
  /code/modules/invenio-oaiharvester/.tox/c1/lib/python3.6/site-packages/xmlschema/codepoints.py:31: DeprecationWarning: invalid escape sequence \%
    return u'\%s' % unicode_chr(cp)

.tox/c1/lib/python3.6/site-packages/xmlschema/codepoints.py:35
  /code/modules/invenio-oaiharvester/.tox/c1/lib/python3.6/site-packages/xmlschema/codepoints.py:35: DeprecationWarning: invalid escape sequence \%
    start_char = u'\%s' % unicode_chr(cp[0])

.tox/c1/lib/python3.6/site-packages/xmlschema/codepoints.py:40
  /code/modules/invenio-oaiharvester/.tox/c1/lib/python3.6/site-packages/xmlschema/codepoints.py:40: DeprecationWarning: invalid escape sequence \%
    end_char = u'\%s' % unicode_chr(cp[1])

.tox/c1/lib/python3.6/site-packages/validators/url.py:5
  /code/modules/invenio-oaiharvester/.tox/c1/lib/python3.6/site-packages/validators/url.py:5: DeprecationWarning: invalid escape sequence \.
    ip_middle_octet = u"(?:\.(?:1?\d{1,2}|2[0-4]\d|25[0-5]))"

.tox/c1/lib/python3.6/site-packages/validators/url.py:6
  /code/modules/invenio-oaiharvester/.tox/c1/lib/python3.6/site-packages/validators/url.py:6: DeprecationWarning: invalid escape sequence \.
    ip_last_octet = u"(?:\.(?:[1-9]\d?|1\d\d|2[0-4]\d|25[0-4]))"

.tox/c1/lib/python3.6/site-packages/validators/url.py:13
  /code/modules/invenio-oaiharvester/.tox/c1/lib/python3.6/site-packages/validators/url.py:13: DeprecationWarning: invalid escape sequence \S
    u"(?:\S+(?::\S*)?@)?"

.tox/c1/lib/python3.6/site-packages/validators/url.py:19
  /code/modules/invenio-oaiharvester/.tox/c1/lib/python3.6/site-packages/validators/url.py:19: DeprecationWarning: invalid escape sequence \.
    u"(?:(?:169\.254|192\.168)" + ip_middle_octet + ip_last_octet + u")|"

.tox/c1/lib/python3.6/site-packages/validators/url.py:20
  /code/modules/invenio-oaiharvester/.tox/c1/lib/python3.6/site-packages/validators/url.py:20: DeprecationWarning: invalid escape sequence \.
    u"(?:172\.(?:1[6-9]|2\d|3[0-1])" + ip_middle_octet + ip_last_octet + u"))"

.tox/c1/lib/python3.6/site-packages/validators/url.py:32
  /code/modules/invenio-oaiharvester/.tox/c1/lib/python3.6/site-packages/validators/url.py:32: DeprecationWarning: invalid escape sequence \d
    u"(?:[1-9]\d?|1\d\d|2[01]\d|22[0-3])"

.tox/c1/lib/python3.6/site-packages/validators/url.py:39
  /code/modules/invenio-oaiharvester/.tox/c1/lib/python3.6/site-packages/validators/url.py:39: DeprecationWarning: invalid escape sequence \.
    u"(?:\.(?:[a-z\u00a1-\uffff0-9]-?)*[a-z\u00a1-\uffff0-9]+)*"

.tox/c1/lib/python3.6/site-packages/validators/url.py:41
  /code/modules/invenio-oaiharvester/.tox/c1/lib/python3.6/site-packages/validators/url.py:41: DeprecationWarning: invalid escape sequence \.
    u"(?:\.(?:[a-z\u00a1-\uffff]{2,}))"

.tox/c1/lib/python3.6/site-packages/validators/url.py:44
  /code/modules/invenio-oaiharvester/.tox/c1/lib/python3.6/site-packages/validators/url.py:44: DeprecationWarning: invalid escape sequence \d
    u"(?::\d{2,5})?"

.tox/c1/lib/python3.6/site-packages/validators/url.py:46
  /code/modules/invenio-oaiharvester/.tox/c1/lib/python3.6/site-packages/validators/url.py:46: DeprecationWarning: invalid escape sequence \S
    u"(?:/\S*)?"

.tox/c1/lib/python3.6/site-packages/validators/url.py:48
  /code/modules/invenio-oaiharvester/.tox/c1/lib/python3.6/site-packages/validators/url.py:48: DeprecationWarning: invalid escape sequence \?
    u"(?:\?\S*)?"

.tox/c1/lib/python3.6/site-packages/flask_oauthlib/contrib/cache.py:3
  /code/modules/invenio-oaiharvester/.tox/c1/lib/python3.6/site-packages/flask_oauthlib/contrib/cache.py:3: DeprecationWarning: 'werkzeug.contrib.cache' is deprecated as of version 0.15 and will be removed in version 1.0. It has moved to https://github.com/pallets/cachelib.
    from werkzeug.contrib.cache import NullCache, SimpleCache, FileSystemCache

.tox/c1/lib/python3.6/site-packages/jsonpath_ng/ext/string.py:18
  /code/modules/invenio-oaiharvester/.tox/c1/lib/python3.6/site-packages/jsonpath_ng/ext/string.py:18: DeprecationWarning: invalid escape sequence \(
    SUB = re.compile("sub\(/(.*)/,\s+(.*)\)")

.tox/c1/lib/python3.6/site-packages/jsonpath_ng/ext/string.py:19
  /code/modules/invenio-oaiharvester/.tox/c1/lib/python3.6/site-packages/jsonpath_ng/ext/string.py:19: DeprecationWarning: invalid escape sequence \(
    SPLIT = re.compile("split\((.),\s+(\d+),\s+(\d+|-1)\)")

.tox/c1/lib/python3.6/site-packages/jsonpath_ng/ext/string.py:20
  /code/modules/invenio-oaiharvester/.tox/c1/lib/python3.6/site-packages/jsonpath_ng/ext/string.py:20: DeprecationWarning: invalid escape sequence \(
    STR = re.compile("str\(\)")

.tox/c1/lib/python3.6/site-packages/citeproc/formatter/rst.py:8
  /code/modules/invenio-oaiharvester/.tox/c1/lib/python3.6/site-packages/citeproc/formatter/rst.py:8: DeprecationWarning: invalid escape sequence \*
    text = text.replace('*', '\*')

.tox/c1/lib/python3.6/site-packages/citeproc/formatter/rst.py:9
  /code/modules/invenio-oaiharvester/.tox/c1/lib/python3.6/site-packages/citeproc/formatter/rst.py:9: DeprecationWarning: invalid escape sequence \`
    text = text.replace('`', '\`')

.tox/c1/lib/python3.6/site-packages/citeproc/model.py:671
  /code/modules/invenio-oaiharvester/.tox/c1/lib/python3.6/site-packages/citeproc/model.py:671: DeprecationWarning: invalid escape sequence \d
    m = re.search('\d+', first)

.tox/c1/lib/python3.6/site-packages/citeproc/source/bibtex/bibtex.py:156
  /code/modules/invenio-oaiharvester/.tox/c1/lib/python3.6/site-packages/citeproc/source/bibtex/bibtex.py:156: DeprecationWarning: invalid escape sequence \d
    RE_DAY = '(?P<day>\d+)'

.tox/c1/lib/python3.6/site-packages/citeproc/source/bibtex/bibtex.py:157
  /code/modules/invenio-oaiharvester/.tox/c1/lib/python3.6/site-packages/citeproc/source/bibtex/bibtex.py:157: DeprecationWarning: invalid escape sequence \w
    RE_MONTH = '(?P<month>\w+)'

.tox/c1/lib/python3.6/site-packages/b2handle/clientcredentials.py:102
  /code/modules/invenio-oaiharvester/.tox/c1/lib/python3.6/site-packages/b2handle/clientcredentials.py:102: DeprecationWarning: invalid escape sequence \*
    '''

.tox/c1/lib/python3.6/site-packages/b2handle/handleexceptions.py:128
  /code/modules/invenio-oaiharvester/.tox/c1/lib/python3.6/site-packages/b2handle/handleexceptions.py:128: DeprecationWarning: invalid escape sequence \s
    pat = re.compile('>[\s]+<')

.tox/c1/lib/python3.6/site-packages/past/translation/__init__.py:35
  /code/modules/invenio-oaiharvester/.tox/c1/lib/python3.6/site-packages/past/translation/__init__.py:35: DeprecationWarning: the imp module is deprecated in favour of importlib; see the module's documentation for alternative uses
    import imp

.tox/c1/lib/python3.6/site-packages/past/types/oldstr.py:33
  /code/modules/invenio-oaiharvester/.tox/c1/lib/python3.6/site-packages/past/types/oldstr.py:33: DeprecationWarning: invalid escape sequence \d
    """

.tox/c1/lib/python3.6/site-packages/b2handle/handleclient.py:177
  /code/modules/invenio-oaiharvester/.tox/c1/lib/python3.6/site-packages/b2handle/handleclient.py:177: DeprecationWarning: invalid escape sequence \*
    '''

.tox/c1/lib/python3.6/site-packages/b2handle/handleclient.py:197
  /code/modules/invenio-oaiharvester/.tox/c1/lib/python3.6/site-packages/b2handle/handleclient.py:197: DeprecationWarning: invalid escape sequence \*
    '''

.tox/c1/lib/python3.6/site-packages/b2handle/handleclient.py:230
  /code/modules/invenio-oaiharvester/.tox/c1/lib/python3.6/site-packages/b2handle/handleclient.py:230: DeprecationWarning: invalid escape sequence \*
    '''

.tox/c1/lib/python3.6/site-packages/b2handle/handleclient.py:248
  /code/modules/invenio-oaiharvester/.tox/c1/lib/python3.6/site-packages/b2handle/handleclient.py:248: DeprecationWarning: invalid escape sequence \*
    '''

.tox/c1/lib/python3.6/site-packages/webassets/filter/__init__.py:51
  /code/modules/invenio-oaiharvester/.tox/c1/lib/python3.6/site-packages/webassets/filter/__init__.py:51: DeprecationWarning: invalid escape sequence \,
    """

.tox/c1/lib/python3.6/site-packages/webassets/filter/replace.py:20
  /code/modules/invenio-oaiharvester/.tox/c1/lib/python3.6/site-packages/webassets/filter/replace.py:20: DeprecationWarning: invalid escape sequence \s
    """

.tox/c1/bin/bagit.py:926
  /code/modules/invenio-oaiharvester/.tox/c1/bin/bagit.py:926: DeprecationWarning: invalid escape sequence \c
    """

.tox/c1/src/pypdf2/PyPDF2/generic.py:348
  /code/modules/invenio-oaiharvester/.tox/c1/src/pypdf2/PyPDF2/generic.py:348: DeprecationWarning: invalid escape sequence \c
    b_("c") : b_("\c"),

.tox/c1/lib/python3.6/site-packages/sickle/utils.py:20
  /code/modules/invenio-oaiharvester/.tox/c1/lib/python3.6/site-packages/sickle/utils.py:20: DeprecationWarning: invalid escape sequence \{
    return re.search('(\{.*\})', element.tag).group(1)

tests/test_admin.py: 9 warnings
tests/test_api.py: 4 warnings
tests/test_cli.py: 2 warnings
tests/test_harvester.py: 63 warnings
tests/test_harvesting.py: 9 warnings
tests/test_tasks.py: 12 warnings
tests/test_utils.py: 8 warnings
tests/test_views.py: 1 warning
  /code/modules/invenio-oaiharvester/.tox/c1/lib/python3.6/site-packages/flask_celeryext/app.py:36: UserWarning: Celery v4 installed, but detected Celery v3 configuration CELERY_ALWAYS_EAGER (use CELERY_TASK_ALWAYS_EAGER instead).
    UserWarning

tests/test_admin.py: 9 warnings
tests/test_api.py: 4 warnings
tests/test_cli.py: 2 warnings
tests/test_harvester.py: 63 warnings
tests/test_harvesting.py: 9 warnings
tests/test_tasks.py: 12 warnings
tests/test_utils.py: 8 warnings
tests/test_views.py: 1 warning
  /code/modules/invenio-oaiharvester/.tox/c1/lib/python3.6/site-packages/flask_celeryext/app.py:36: UserWarning: Celery v4 installed, but detected Celery v3 configuration CELERY_EAGER_PROPAGATES_EXCEPTIONS (use CELERY_TASK_EAGER_PROPAGATES instead).
    UserWarning

tests/test_admin.py: 9 warnings
tests/test_api.py: 4 warnings
tests/test_cli.py: 2 warnings
tests/test_harvester.py: 63 warnings
tests/test_harvesting.py: 9 warnings
tests/test_tasks.py: 12 warnings
tests/test_utils.py: 8 warnings
tests/test_views.py: 1 warning
  /code/modules/invenio-oaiharvester/.tox/c1/lib/python3.6/site-packages/flask_sqlalchemy/__init__.py:794: FSADeprecationWarning: SQLALCHEMY_TRACK_MODIFICATIONS adds significant overhead and will be disabled by default in the future.  Set it to True or False to suppress this warning.
    'SQLALCHEMY_TRACK_MODIFICATIONS adds significant overhead and '

tests/test_admin.py::test_admin
  /code/modules/invenio-oaiharvester/.tox/c1/lib/python3.6/site-packages/flask/sessions.py:208: UserWarning: "TEST_SERVER" is not a valid cookie domain, it must contain a ".". Add an entry to your hosts file, for example "TEST_SERVER.localdomain", and use that instead.
    ' "{rv}.localdomain", and use that instead.'.format(rv=rv)

tests/test_admin.py::TestHarvestSettingView::test_pause
  /code/modules/invenio-oaiharvester/.tox/c1/src/kombu/kombu/utils/compat.py:93: DeprecationWarning: SelectableGroups dict interface is deprecated. Use select.
    for ep in importlib_metadata.entry_points().get(namespace, [])

tests/test_harvester.py::TestDDIMapper::test_ddi_harvest_processing
  /code/modules/invenio-oaiharvester/.tox/c1/lib/python3.6/site-packages/bs4/__init__.py:424: MarkupResemblesLocatorWarning: "http://doi.org/test_doi" looks like a URL. Beautiful Soup is not an HTTP client. You should probably use an HTTP client like requests to get the document behind the URL, and feed that document to Beautiful Soup.
    MarkupResemblesLocatorWarning

tests/test_harvester.py::TestDDIMapper::test_ddi_harvest_processing
  /code/modules/invenio-oaiharvester/.tox/c1/lib/python3.6/site-packages/bs4/__init__.py:424: MarkupResemblesLocatorWarning: "http://hdl.handle.net/test_doi" looks like a URL. Beautiful Soup is not an HTTP client. You should probably use an HTTP client like requests to get the document behind the URL, and feed that document to Beautiful Soup.
    MarkupResemblesLocatorWarning

tests/test_harvester.py::TestDDIMapper::test_ddi_harvest_processing
  /code/modules/invenio-oaiharvester/.tox/c1/lib/python3.6/site-packages/bs4/__init__.py:424: MarkupResemblesLocatorWarning: "http://other_prefix" looks like a URL. Beautiful Soup is not an HTTP client. You should probably use an HTTP client like requests to get the document behind the URL, and feed that document to Beautiful Soup.
    MarkupResemblesLocatorWarning

-- Docs: https://docs.pytest.org/en/stable/warnings.html

---------- coverage: platform linux, python 3.6.15-final-0 -----------
Name                                Stmts   Miss Branch BrPart  Cover
---------------------------------------------------------------------
invenio_oaiharvester/__init__.py        6      0      0      0   100%
invenio_oaiharvester/admin.py         119      0     20      0   100%
invenio_oaiharvester/api.py            93      0     38      0   100%
invenio_oaiharvester/cli.py            63      0     22      0   100%
invenio_oaiharvester/config.py         15      0      0      0   100%
invenio_oaiharvester/errors.py          8      0     12      0   100%
invenio_oaiharvester/ext.py            18      0      8      0   100%
invenio_oaiharvester/harvester.py     676      4    310      4    99%
invenio_oaiharvester/models.py         57      0     16      0   100%
invenio_oaiharvester/signals.py         5      0      0      0   100%
invenio_oaiharvester/tasks.py         284     72    110     10    73%
invenio_oaiharvester/utils.py          98      0     30      0   100%
invenio_oaiharvester/version.py         3      0      0      0   100%
invenio_oaiharvester/views.py          14      0      4      0   100%
---------------------------------------------------------------------
TOTAL                                1459     76    570     14    94%
Coverage HTML written to dir htmlcov
Coverage XML written to file coverage.xml

=========================== short test summary info ============================
FAILED tests/test_harvester.py::test_add_contributor_jpcoar - AssertionError:...
FAILED tests/test_harvester.py::test_add_apc - NameError: name 'add_apc' is n...
FAILED tests/test_harvester.py::test_add_funding_reference - AssertionError: ...
FAILED tests/test_harvester.py::TestJPCOARMapper::test_map - AssertionError: ...
FAILED tests/test_harvester.py::TestDDIMapper::test_ddi_harvest_processing - ...
FAILED tests/test_tasks.py::test_process_item - elasticsearch.exceptions.Auth...
FAILED tests/test_tasks.py::test_run_harvesting - sqlalchemy.exc.IntegrityErr...
====== 7 failed, 111 passed, 2 skipped, 460 warnings in 485.72s (0:08:05) ======
ERROR: InvocationError for command /code/modules/invenio-oaiharvester/.tox/c1/bin/pytest --cov=invenio_oaiharvester tests -v --cov-branch --cov-report=term --cov-report=xml --cov-report=html --basetemp=/code/modules/invenio-oaiharvester/.tox/c1/tmp (exited with code 1)
___________________________________ summary ____________________________________
ERROR:   c1: commands failed
